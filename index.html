<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard Prévoyance + Prime (v6.7 — Plan + Simulation mensuelle + Historique)</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1220; --panel:#0f172a; --muted:#94a3b8; --text:#e5e7eb;
  --accent:#22c55e; --accent2:#3b82f6; --border:#1f2937; --warn:#f59e0b; --danger:#ef4444;
  --ok:#22c55e; --over:#3b82f6;
}
*{box-sizing:border-box}
body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto; color:var(--text); background:radial-gradient(1200px 600px at 10% -10%, rgba(59,130,246,.18), transparent 40%), radial-gradient(1000px 500px at 100% 0%, rgba(34,197,94,.15), transparent 35%), linear-gradient(180deg,#0b1220,#0f172a 60%,#0b1220)}
header{padding:22px 16px 10px}
h1{margin:0; font-size:clamp(20px,3vw,28px)}
.sub{color:var(--muted); font-size:14px}
.tabs{display:flex; gap:8px; padding:0 16px 8px; flex-wrap:wrap}
.tab{cursor:pointer; padding:10px 14px; border-radius:12px; background:rgba(15,23,42,.6); border:1px solid var(--border); user-select:none; transition:all .15s ease}
.tab:hover{transform:translateY(-1px); box-shadow:0 6px 18px rgba(0,0,0,.25)}
.tab.active{background:linear-gradient(180deg,#3b82f6,#1d4ed8); border-color:#1e3a8a}
.panel{display:none}
.panel.active{display:block}
.card{background:rgba(15,23,42,.72); backdrop-filter: blur(6px); border:1px solid var(--border); border-radius:16px; box-shadow:0 12px 40px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.03); padding:16px}
.grid{display:grid; grid-template-columns:repeat(12,1fr); gap:16px; padding:16px}
.kpi{display:flex; flex-direction:column; gap:6px; padding:14px 16px; min-width:220px}
.kpi .label{color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.08em}
.kpi .value{font-size:clamp(18px,3vw,28px); font-weight:700}
.kpi .delta{font-size:12px}
input, select, button, textarea{background:#0b1220; color:#e5e7eb; border:1px solid var(--border); border-radius:12px; padding:10px 12px; font-size:14px; outline:none}
button{cursor:pointer; font-weight:600}
.btn{border:1px solid transparent}
.btn-primary{background:linear-gradient(180deg,#16a34a,#15803d); border-color:#14532d}
.btn-ghost{background:transparent; border-color:var(--border)}
.btn-danger{background:linear-gradient(180deg,#ef4444,#b91c1c); border-color:#7f1d1d}
.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.small{font-size:12px; color:#94a3b8}
.progress{height:12px; background:#0b1220; border:1px solid var(--border); border-radius:999px; overflow:hidden}
.bar{height:100%; background:linear-gradient(90deg,#22c55e,#3b82f6); width:0%}
.right{text-align:right}
.table-wrap{overflow:auto}
table{width:100%; min-width:980px; border-collapse:separate; border-spacing:0}
th,td{padding:10px 8px; border-bottom:1px solid var(--border); font-size:14px}
thead th{position:sticky; top:0; background:#0b1220; z-index:1}
footer{color:#94a3b8; padding:16px; text-align:center; font-size:12px}
svg{width:100%; height:auto}
.chart{height:220px}
.debug{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; background:#0b1220; border:1px dashed #334155; border-radius:12px; padding:10px; color:#cbd5e1}
@media (max-width: 1080px){ .grid{grid-template-columns: 1fr} .kpi{min-width:unset} }
.badge{display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; border:1px solid var(--border); font-size:12px; color:#cbd5e1; background:rgba(2,6,23,.6)}
.hr{height:1px; background:#1f2937; margin:8px 0 12px}
.section-title{margin:0 0 6px; font-weight:700}
.note{font-size:12px; color:#9ca3af}
.details{white-space:pre-wrap; background:#0b1220; border:1px solid #334155; border-radius:12px; padding:12px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; color:#d1d5db}
.actions{display:flex; gap:8px; flex-wrap:wrap}
.badge-warn{background:rgba(245,158,11,.15); border-color:#b45309; color:#fbbf24}
.badge-ok{background:rgba(34,197,94,.15); border-color:#166534; color:#86efac}
.badge-over{background:rgba(59,130,246,.15); border-color:#1e40af; color:#93c5fd}
@media print{
  body{background:#fff; color:#000}
  .tabs, .btn, .actions, .table-wrap, .chart, footer, .debug{display:none !important}
  .card{border:1px solid #ddd; box-shadow:none; background:#fff; color:#000}
  .kpi .value{color:#000}
  a:link{color:#000}
}
</style>
</head>
<body>
<header>
  <h1>Dashboard — <span class="badge">Prévoyance</span> + <span class="badge">Calculateur</span> + <span class="badge">Global</span> + <span class="badge">Plan</span> + <span class="badge">Simulation</span> + <span class="badge">Historique</span> (v6.7)</h1>
  <div class="sub">Plan réaliste par mois • Simulation avec barèmes, surperf, qualitatif, collectif • Historique exportable</div>
</header>

<div class="tabs">
  <div class="tab active" data-tab="prev">Prévoyance
  <div class="tab" data-tab="gav">Prise en charge GAV</div>
</div>
  <div class="tab" data-tab="calc">Calculateur</div>
  <div class="tab" data-tab="global">Global</div>
  <div class="tab" data-tab="plan">Plan</div>
  <div class="tab" data-tab="av">Assurance Vie</div>
  <div class="tab" data-tab="per">PER</div>
  <div class="tab" data-tab="library">Argumentaires</div>
</div>

<div id="prev" class="panel active"></div>
<div id="calc" class="panel"></div>
<div id="global" class="panel"></div>
<div id="plan" class="panel"></div>
<div id="av" class="panel"></div>
<div id="per" class="panel"></div>
<div id="library" class="panel"></div>
<div id="gav" class="panel"></div>

<footer>CSV = hors-ligne • XLSX = connexion nécessaire (chargement de SheetJS). — v6.7</footer>

<script>
/* ===== Utils ===== */
const fmt0 = new Intl.NumberFormat('fr-FR', { style:'currency', currency:'EUR', maximumFractionDigits:0 });
const fmt = new Intl.NumberFormat('fr-FR', { style:'currency', currency:'EUR' });
const today = new Date();
function yearNow(){ return today.getFullYear(); }
function monthIndexNow(){ return today.getMonth(); } // 0..11
function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
function esc(s){ return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

/* ===== Prévoyance tab (import + charts) — base v6.5 ===== */
function buildPrevPanel(){
  const root = document.getElementById('prev');
  root.innerHTML = `
    <div class="grid">
      <section class="card" style="grid-column: span 12">
        <div class="row">
          <input class="file" type="file" accept=".csv, text/csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
          <button class="btn btn-ghost import">Importer</button>
          <button class="btn btn-ghost export">Exporter (JSON)</button>
          <button class=\"btn btn-ghost exportCSV\">Exporter (CSV combiné)</button>
          <button class="btn btn-danger clear">Réinitialiser</button>
          <span class="small">Colonnes attendues : <b>prenomPP</b>, <b>nomPP</b>, <b>offre</b>, <b>montantPeriodique</b>, <b>periodicite</b>, <b>dateSignature</b></span>
        </div>
        <div class="row" style="margin-top:10px">
          <input class="target" type="number" min="0" step="1" placeholder="Objectif annuel Prévoyance (€)" />
          <button class="btn btn-primary save">Enregistrer</button>
          <div class="actions">
            <button class="btn btn-ghost toCalc">Envoyer le CA → Calculateur</button>
            <button class="btn btn-ghost print">Exporter PDF</button>
          </div>
        </div>
        <div class="debug box">En attente d’import…</div>
      </section>

      <section class="card" style="grid-column: span 12">
        <div class="row">
          <div class="kpi card">
            <div class="label">Total annuel</div>
            <div class="value annualTotal">0 €</div>
            <div class="delta small rows">Lignes importées : 0</div>
          </div>
          <div class="kpi card">
            <div class="label">Objectif annuel</div>
            <div class="value targetVal">—</div>
            <div class="delta pct">Atteint : —</div>
            <div class="progress"><div class="bar progressBar"></div></div>
          </div>
          <div class="kpi card">
            <div class="label">CA moyen / vente (annuel)</div>
            <div class="value avg">0 €</div>
            <div class="delta small products">Produits distincts : 0</div>
          </div>
          <div class="kpi card">
            <div class="label">Ventes</div>
            <div class="value deals">0</div>
            <div class="delta small yearInfo">Année sélectionnée : —</div>
          </div>
        </div>
      </section>

      <section class="card" style="grid-column: span 6">
        <h3 class="section-title">CA annuel par mois (année sélectionnée)</h3>
        <div class="chart monthly"></div>
      </section>

      <section class="card" style="grid-column: span 6">
        <h3 class="section-title">Répartition du CA annuel par produit</h3>
        <div class="chart pie"></div>
      </section>
      <section class="card" style="grid-column: span 12">
        <h3 class="section-title">Ajout manuel</h3>
        <div class="row" style="flex-wrap:wrap; gap:8px">
          <input class="m_prenom" placeholder="Prénom" style="min-width:120px">
          <input class="m_nom" placeholder="Nom" style="min-width:120px">
          <input class="m_produit" placeholder="Produit" style="min-width:160px">
          <input class="m_montant" type="number" min="0" step="1" placeholder="Montant périodique (€)" style="width:170px">
          <select class="m_per">
            <option value="mensuel" selected>Mensuel</option>
            <option value="trimestriel">Trimestriel</option>
            <option value="semestriel">Semestriel</option>
            <option value="annuel">Annuel</option>
          </select>
          <input class="m_date" type="date" style="min-width:150px">
          <button class="btn btn-primary m_add">Ajouter</button>
        </div>
      </section>

      

      <section class="card table-wrap" style="grid-column: span 12">
        <div class="row" style="margin-bottom:8px">
          <input class="search" type="search" placeholder="Rechercher (nom, produit…)" style="min-width:260px">
          <select class="filterYear"></select>
        </div>
        <table>
          <thead><tr><th>Prénom</th><th>Nom</th><th>Produit</th><th class=\"right\">CA annuel</th><th>Date</th><th>Actions</th></tr></thead>
          <tbody class="tbody"></tbody>
        </table>
      </section>
    </div>
  `;

  const $ = sel => root.querySelector(sel);

  const els = {
    file: $('.file'), importBtn: $('.import'), exportBtn: $('.export'), clearBtn: $('.clear'),
    target: $('.target'), save: $('.save'), debug: $('.box'), toCalc: $('.toCalc'), printBtn: $('.print'),
    annualTotal: $('.annualTotal'), rows: $('.rows'),
    targetVal: $('.targetVal'), pct: $('.pct'), progressBar: $('.progressBar'),
    avg: $('.avg'), products: $('.products'), deals: $('.deals'), yearInfo: $('.yearInfo'),
    chartMonthly: $('.monthly'), chartPie: $('.pie'),
    search: $('.search'), filterYear: $('.filterYear'), tbody: $('.tbody'), m_prenom: $('.m_prenom'), m_nom: $('.m_nom'), m_produit: $('.m_produit'), m_montant: $('.m_montant'), m_per: $('.m_per'), m_date: $('.m_date'), m_add: $('.m_add'), exportCSVBtn: $('.exportCSV')
  };
let data = loadData();
  els.target.value = localStorage.getItem('prev.target') || '27000';
  renderAll();
  // --- Doublons: helpers ---
  function keyFor(r){
    const k1 = String(r.prenom||'').trim().toLowerCase();
    const k2 = String(r.nom||'').trim().toLowerCase();
    const k3 = String(r.produit||'').trim().toLowerCase();
    const k4 = String(r.date||'').slice(0,7); // YYYY-MM
    return [k1,k2,k3,k4].join('|');
  }
  function dedupeRows(rows){
    const seen = new Set(); const out = [];
    for(const r of rows){
      const k = keyFor(r);
      if(seen.has(k)) continue;
      seen.add(k); out.push(r);
    }
    return out;
  }
  function findDuplicateIndex(row){
    const k = keyFor(row);
    return data.findIndex(d => keyFor(d) === k);
  }


  
  // Default date today for manual add
  if(els.m_date){ els.m_date.value = new Date().toISOString().slice(0,10); }

  function annualFrom(amount, per){
    const a = Number(amount)||0;
    const p = String(per||'').toLowerCase();
    let monthly = a;
    if(p.includes('ann')) monthly = a/12;
    else if(p.includes('sem')) monthly = a/6;
    else if(p.includes('trim')) monthly = a/3;
    else monthly = a;
    return monthly*12;
  }

  function addManual(){
    const prenom = (els.m_prenom?.value||'').trim();
    const nom = (els.m_nom?.value||'').trim();
    const produit = (els.m_produit?.value||'').trim();
    const date = (els.m_date?.value||'') || new Date().toISOString().slice(0,10);
    const annual = annualFrom(els.m_montant?.value, els.m_per?.value);
    if(!produit || !annual){ alert('Renseigne au minimum Produit et Montant.'); return; }
    const row = { id: 'm'+Date.now().toString(36)+Math.random().toString(36).slice(2,5), prenom, nom, produit, date, annual, source:'manual' };
    const dupIdx = findDuplicateIndex(row);
    if(dupIdx !== -1){
      if(confirm('Doublon détecté (même prénom/nom/produit/mois). Remplacer l’existant ?')){
        data[dupIdx] = { ...data[dupIdx], ...row };
      }else{
        const keepBoth = confirm('Conserver les deux entrées ?');
        if(keepBoth){ data.unshift(row); } else { return; }
      }
    }else{
      data.unshift(row);
    }
    saveData();
    renderAll();
    if(els.m_prenom) els.m_prenom.value='';
    if(els.m_nom) els.m_nom.value='';
    if(els.m_produit) els.m_produit.value='';
    if(els.m_montant) els.m_montant.value='';
  }

  els.m_add && els.m_add.addEventListener('click', addManual);

  // Table actions (edit/delete) for manual rows
  els.tbody.addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const id = btn.dataset.id || btn.closest('tr')?.dataset.id;
    const idx = data.findIndex(d => String(d.id||'')===String(id));
    if(idx===-1) return;
    const row = data[idx];
    if(btn.classList.contains('del')){
      if(confirm('Supprimer cette ligne manuelle ?')){
        data.splice(idx,1);
        saveData(); renderAll();
      }
    }else if(btn.classList.contains('edit')){
      const prenom = prompt('Prénom', row.prenom||'') ?? row.prenom;
      const nom = prompt('Nom', row.nom||'') ?? row.nom;
      const produit = prompt('Produit', row.produit||'') ?? row.produit;
      const date = prompt('Date (YYYY-MM-DD)', row.date||'') ?? row.date;
      const montant = prompt('Montant périodique (€)', Math.round((row.annual||0)/12)) ?? String(Math.round((row.annual||0)/12));
      const per = prompt('Périodicité (mensuel/trimestriel/semestriel/annuel)', 'mensuel') ?? 'mensuel';
      const annual = annualFrom(montant, per);
      data[idx] = { ...row, prenom, nom, produit, date, annual, source:'manual' };
      saveData(); renderAll();
    }
  });

  // Export CSV combiné (import + manuel) — colonnes normalisées
  function exportCombinedCSV(){
    const headers = ['prenom','nom','produit','annual','date','source'];
    const lines = [headers.join(';')].concat(
      data.map(r => [r.prenom||'', r.nom||'', r.produit||'', String(Number(r.annual)||0), r.date||'', r.source||'import'].join(';'))
    );
    const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'prevoyance_combine.csv'; a.click(); URL.revokeObjectURL(url);
  }
  els.exportCSVBtn && els.exportCSVBtn.addEventListener('click', exportCombinedCSV);
els.importBtn.addEventListener('click', async () => {
    const f = els.file.files && els.file.files[0];
    if(!f){ alert('Choisis un fichier CSV/XLSX.'); return; }
    try{
      const text = await readFileToTextOrCSV(f);
      const parsed = parseCSV(text);
      let normalized = parsed.rows.map(r => normalizeRow(r)).map(r => ({...r, source:'import'}));
      const before = normalized.length; const deduped = dedupeRows(normalized);
      const removed = before - deduped.length;
      data = deduped;
      saveData();
      debug(`Import OK — ${data.length} lignes.` + (removed>0? ` (${removed} doublon(s) ignoré(s))` : '') + `
Extrait:\n` + JSON.stringify(data.slice(0,5), null, 2));
      renderAll();
    }catch(e){ debug('Erreur de lecture: ' + e); }
  });

  els.exportBtn.addEventListener('click', () => {
    const blob = new Blob([JSON.stringify({ data, settings: {
      target: localStorage.getItem('prev.target')||''
    }}, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download= 'prev_export.json'; a.click(); URL.revokeObjectURL(url);
  });

  els.clearBtn.addEventListener('click', () => {
    if(confirm('Effacer les données locales de Prévoyance ?')){ data=[]; saveData(); renderAll(); debug('Données réinitialisées.'); }
  });

  els.save.addEventListener('click', () => {
    localStorage.setItem('prev.target', (els.target.value||'').trim());
    renderAll();
  });
  [els.search, els.filterYear].forEach(el => el.addEventListener('input', renderTable));

  els.toCalc.addEventListener('click', () => {
    const totalAnnual = data.reduce((s,d)=> s + (Number(d.annual)||0), 0);
    localStorage.setItem('calc.ca_prev', String(totalAnnual));
    document.querySelector('.tab[data-tab="calc"]').click();
  });

  els.printBtn.addEventListener('click', () => window.print());

  function storageKey(){ return 'prev.data'; }
  function loadData(){ try{ const j=localStorage.getItem(storageKey()); return j? JSON.parse(j): []; }catch(e){ return []; } }
  function saveData(){ localStorage.setItem(storageKey(), JSON.stringify(data)); }
  function debug(msg){ els.debug.textContent = msg; }

  async function readFileToTextOrCSV(file){
    const ext = (file.name.split('.').pop()||'').toLowerCase();
    if(ext === 'xlsx'){
      if(typeof XLSX === 'undefined') throw new Error('Librairie XLSX non chargée (connexion internet requise).');
      const ab = await file.arrayBuffer();
      const wb = XLSX.read(ab, {type:'array'});
      const ws = wb.Sheets[wb.SheetNames[0]];
      const csv = XLSX.utils.sheet_to_csv(ws, {FS:';'});
      return csv;
    } else {
      return await file.text();
    }
  }

  function parseCSV(text){
    const firstLine = text.split(/\r?\n/).find(l=>l.trim().length>0) || '';
    const delimiter = firstLine.includes(';') && !firstLine.includes(',') ? ';' : ',';
    const lines = text.split(/\r?\n/).filter(l=>l.trim().length>0);
    const headers = (lines.shift()||'').split(delimiter).map(s=>s.trim());
    const rows = lines.map(line => {
      const out = []; let cur=''; let inQ=false;
      for(let i=0;i<line.length;i++){
        const ch = line[i];
        if(ch === '"'){ if(inQ && line[i+1] === '"'){ cur+='"'; i++; } else { inQ=!inQ; } }
        else if(ch === delimiter && !inQ){ out.push(cur); cur=''; }
        else { cur += ch; }
      }
      out.push(cur);
      const obj = {}; headers.forEach((h,idx)=> obj[h]= (out[idx]||'').trim());
      return obj;
    });
    debug('En-têtes détectées: ' + headers.join(' | '));
    return { headers, rows };
  }

  function toNum(v){
    if(v==null) return 0;
    let s = String(v).replace(/\u00a0/g,' ').replace(/[€]/g,'').replace(/['"]/g,'').replace(/\s/g,'').replace(',', '.');
    s = (s.match(/[0-9\.\-]+/g)||['0']).join('');
    const n = Number(s); return isFinite(n)? n: 0;
  }
  function toISO(v){
    const s = String(v||'').trim(); if(!s) return '';
    const m1 = s.match(/^(\d{4})[-/](\d{2})[-/](\d{2})/); if(m1) return `${m1[1]}-${m1[2]}-${m1[3]}`;
    const m2 = s.match(/^(\d{2})[/-](\d{2})[/-](\d{4})/); if(m2) return `${m2[3]}-${m2[2]}-${m2[1]}`;
    const d = new Date(s); if(!isNaN(d)) return d.toISOString().slice(0,10); return '';
  }

  function normalizeRow(r){
    const prenom = (r['prenomPP']||'').trim();
    const nom = (r['nomPP']||'').trim();
    const produit = (r['offre']||r['familleProduit']||'').trim();
    const date = toISO(r['dateSignature']);
    let amount = toNum(r['montantPeriodique']);
    const per = String(r['periodicite']||'').toLowerCase();
    let monthly = amount;
    if(per.includes('ann')) monthly = amount/12;
    else if(per.includes('sem')) monthly = amount/6;
    else if(per.includes('trim')) monthly = amount/3;
    else if(per.includes('mens')) monthly = amount;
    const annual = monthly * 12;
    return { prenom, nom, produit, date, annual };
  }

  function renderAll(){ fillYearFilter(); renderKPIs(); renderCharts(); renderTable(); }

  function fillYearFilter(){
    const years = Array.from(new Set(data.map(r => (r.date||'').slice(0,4)).filter(Boolean))).map(Number).sort((a,b)=>b-a);
    const cur = yearNow(); if(years.indexOf(cur)===-1) years.push(cur);
    els.filterYear.innerHTML = years.map(y => `<option value="${y}" ${y===cur?'selected':''}>Année ${y}</option>`).join('');
  }

  function renderKPIs(){
    const totalAnnual = data.reduce((s,d)=> s + (Number(d.annual)||0), 0);
    const target = Number(localStorage.getItem('prev.target')||0) || 0;
    els.annualTotal.textContent = fmt0.format(totalAnnual);
    els.rows.textContent = 'Lignes importées : ' + data.length;
    els.targetVal.textContent = target>0 ? fmt0.format(target) : '—';
    const pct = target>0 ? (totalAnnual/target*100) : 0;
    els.pct.innerHTML = 'Atteint : ' + (target>0 ? (Math.round(pct*10)/10)+'%' : '—') + (pct>=125 ? ' <span class="badge-over">125%+</span>' : '');
    const color = pct>=125? 'var(--over)' : pct>=100? 'var(--ok)' : pct>=80? 'var(--warn)' : 'var(--danger)';
    els.progressBar.style.width = Math.min(100, Math.round(pct)) + '%';
    els.progressBar.style.background = color;
    const avg = data.length ? totalAnnual / data.length : 0;
    els.avg.textContent = fmt0.format(avg);
    const productSet = new Set(data.map(d=> d.produit || 'Inconnu'));
    els.products.textContent = 'Produits distincts : ' + productSet.size;
    const y = Number(els.filterYear.value) || yearNow();
    const yearRowsKPI = data.filter(d => !d.date || d.date.startsWith(String(y)));
    els.deals.textContent = yearRowsKPI.length;
    els.yearInfo.textContent = 'Année sélectionnée : ' + y;
  }

  function renderCharts(){
    const y = Number(els.filterYear.value) || yearNow();
    const yearRows = data.filter(d => (d.date||'').startsWith(String(y)));
    const buckets = new Array(12).fill(0);
    yearRows.forEach(d => { if(!d.date) return; const m = Number(d.date.slice(5,7)) - 1; buckets[m] += Number(d.annual)||0; });
    els.chartMonthly.innerHTML = barChartSVG(buckets);
    const map = {}; data.forEach(d => { const key=(d.produit||'Inconnu')||'Inconnu'; map[key]=(map[key]||0)+(Number(d.annual)||0); });
    const top = Object.entries(map).sort((a,b)=> b[1]-a[1]).slice(0,8);
    els.chartPie.innerHTML = pieChartSVG(top);
  }

  function renderTable(){
    const y = Number(els.filterYear.value) || yearNow();
    const q = (els.search.value||'').toLowerCase();
    const rows = data.filter(d => {
      const txt = (d.prenom+' '+d.nom+' '+d.produit).toLowerCase();
      if(q && !txt.includes(q)) return false;
      const yearOK = !d.date || d.date.startsWith(String(y)); if(!yearOK) return false;
      return true;
    });
    rows.sort((a,b)=> (b.date||'').localeCompare(a.date||'') || (Number(b.annual)||0)-(Number(a.annual)||0));
    els.tbody.innerHTML = rows.map(r => `<tr data-id="${r.id||''}"><td>${esc(r.prenom||'')}</td><td>${esc(r.nom||'')}</td><td>${esc(r.produit||'')}</td><td class=\"right\">${fmt0.format(Number(r.annual)||0)}</td><td>${r.date || '—'}</td><td>${r.source==='manual' ? '<button class=\"btn btn-ghost edit\" data-id=\"'+(r.id||'')+'\">✏️</button> <button class=\"btn btn-danger del\" data-id=\"'+(r.id||'')+'\">🗑</button>' : '—'}</td></tr>`).join('');
  }

  function barChartSVG(values){
    const labels = ['Jan','Fév','Mar','Avr','Mai','Juin','Juil','Aoû','Sept','Oct','Nov','Déc'];
    const w=680, h=220, pad=30, max=Math.max(10, ...values);
    const bw = (w - pad*2) / values.length;
    const bars = values.map((v,i)=>{
      const x = pad + i*bw + 6;
      const bh = (v/max) * (h - pad*2);
      const y = h - pad - bh;
      const fill = v>0 ? 'url(#g)' : '#0b1220';
      return `<rect x="${x}" y="${y}" width="${bw-12}" height="${Math.max(1,bh)}" rx="6" ry="6" fill="${fill}">
        <title>${labels[i]}: ${fmt0.format(v)}</title>
      </rect>`;
    }).join('');
    const xlabels = labels.map((lab,i)=>{
      const x = pad + i*bw + bw/2;
      return `<text x="${x}" y="${h-8}" font-size="11" text-anchor="middle" fill="#9ca3af">${lab}</text>`;
    }).join('');
    const grid = [0.25,0.5,0.75,1].map(p=>{
      const y = pad + (1-p)*(h - pad*2);
      return `<line x1="${pad}" y1="${y}" x2="${w-pad}" stroke="#1f2937" stroke-width="1"/>`;
    }).join('');
    return `<svg viewBox="0 0 ${w} ${h}" role="img" aria-label="CA annuel par mois">
      <defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#22c55e"/><stop offset="100%" stop-color="#3b82f6"/></linearGradient></defs>
      ${grid}${bars}${xlabels}
    </svg>`;
  }

  function pieChartSVG(entries){
    const w=680, h=220, cx=110, cy=110, r=85;
    const total = entries.reduce((s,[_k,v])=>s+v,0) || 1;
    let a0 = -Math.PI/2;
    const colors = ['#22c55e','#3b82f6','#a855f7','#f59e0b','#10b981','#ef4444','#06b6d4','#f97316'];
    const slices = entries.map(([k,v],i)=>{
      const ang = (v/total)*Math.PI*2; const a1 = a0 + ang; const large = ang>Math.PI ? 1:0;
      const x0 = cx + r*Math.cos(a0), y0 = cy + r*Math.sin(a0);
      const x1 = cx + r*Math.cos(a1), y1 = cy + r*Math.sin(a1);
      const path = `M ${cx} ${cy} L ${x0} ${y0} A ${r} ${r} 0 ${large} 1 ${x1} ${y1} Z`;
      const color = colors[i % colors.length];
      const mid = a0 + ang/2; const lx = cx + (r+14)*Math.cos(mid), ly = cy + (r+14)*Math.sin(mid);
      a0 = a1;
      return `<path d="${path}" fill="${color}"><title>${k}: ${fmt0.format(v)}</title></path>
              <text x="${lx}" y="${ly}" font-size="11" text-anchor="${Math.cos(mid)>0? 'start':'end'}" fill="#cbd5e1">${k}</text>`;
    }).join('');
    return `<svg viewBox="0 0 ${w} ${h}" role="img" aria-label="Répartition par produit">${slices}</svg>`;
  }
}

/* ===== Calculateur tab (copie v6.5 avec save-to-history) ===== */
function buildCalcPanel(){
  const root = document.getElementById('calc');
  root.innerHTML = `
    <div class="grid">
      <section class="card" style="grid-column: span 12">
        <div class="actions" style="justify-content:flex-end; margin-bottom:8px">
          <button class="btn btn-ghost print">Exporter PDF</button>
          <button class="btn btn-ghost clear">Réinitialiser paramètres</button>
        </div>
        <h3 class="section-title">Entrées</h3>
        <div class="row">
          <span class="small">CA Prévoyance (€)</span>
          <input class="ca_prev" data-save="1" type="number" min="0" step="1" placeholder="ex. 30000" />
          <button class="btn btn-ghost pullPrev">← depuis l'onglet Prévoyance</button>
          <span class="small">Objectif Prévoyance (€)</span>
          <input class="obj_prev" data-save="1" type="number" min="0" step="1" value="27000" />
        </div>
        <div class="row">
          <span class="small">Contrats ER (nbre)</span>
          <input class="nb_er" data-save="1" type="number" min="0" step="1" placeholder="ex. 11" />
          <span class="small">Objectif ER (contrats)</span>
          <input class="obj_er" data-save="1" type="number" min="0" step="1" value="11" />
        </div>
        <div class="row">
          <span class="small">CA ER (€)</span>
          <input class="ca_er" data-save="1" type="number" min="0" step="1" placeholder="ex. 55000" />
          <span class="small">Objectif ER (CA€)</span>
          <input class="obj_er_eur" data-save="1" type="number" min="0" step="1" value="55000" />
        </div>
        <div class="hr"></div>
        <h3 class="section-title">Barèmes € par palier</h3>
        <div class="row note">Palier le plus bas ≤ votre atteinte (80,85,90,95,100,105,110,115,120,125).</div>
        <div class="row">
          <span class="small">Prévoyance :</span>
          <input class="b_prev" data-save="1" type="text" style="min-width:520px" value="80:750,85:1120,90:1490,95:1860,100:2240,105:2690,110:3030,115:3210,120:3390,125:3580">
        </div>
        <div class="row">
          <span class="small">ER Contrats :</span>
          <input class="b_er_c" data-save="1" type="text" style="min-width:520px" value="80:160,85:240,90:320,95:400,100:480,105:575,110:645,115:685,120:725,125:765">
        </div>
        <div class="row">
          <span class="small">ER CA€ :</span>
          <input class="b_er_e" data-save="1" type="text" style="min-width:520px" value="80:160,85:240,90:320,95:400,100:480,105:575,110:645,115:685,120:725,125:765">
        </div>

        <div class="hr"></div>
        <h3 class="section-title">Surperformance (au-delà de 125%)</h3>
        <div class="row">
          <span class="small">Bonus Prévoyance / tranche de +5% :</span>
          <input class="surprev" data-save="1" type="number" min="0" step="1" value="100" style="width:120px" />
          <span class="small">Bonus ER Contrats / tranche de +5% :</span>
          <input class="surer" data-save="1" type="number" min="0" step="1" value="20" style="width:120px" />
          <span class="note">Les bonus de surperf ne sont pas bonifiés par le qualitatif.</span>
        </div>

        <div class="hr"></div>
        <h3 class="section-title">Qualitatif (Néobsia & Multi)</h3>
        <div class="row">
          <span class="small">Majoration Néobsia :</span>
          <select class="q_neo" data-save="1">
            <option value="0">—</option>
            <option value="5">Palier 1 (+5%)</option>
            <option value="10">Palier 2 (+10%)</option>
            <option value="20">Palier 3 (+20%)</option>
          </select>
          <span class="small">Majoration Multi-propositions :</span>
          <select class="q_multi" data-save="1">
            <option value="0">—</option>
            <option value="5">Palier 1 (+5%)</option>
            <option value="10">Palier 2 (+10%)</option>
            <option value="20">Palier 3 (+20%)</option>
          </select>
        </div>

        <div class="hr"></div>
        <h3 class="section-title">Collectif Santé</h3>
        <div class="row">
          <span class="small">Condition : R/O ≥ 65% sur au moins un objectif (Pré, ER contrats ou ER CA€)</span>
        </div>
        <div class="row">
          <span class="small">Palier atteint :</span>
          <select class="coll_palier" data-save="1">
            <option value="0">—</option>
            <option value="1">P1 (280 €)</option>
            <option value="2">P2 (555 €)</option>
            <option value="3">P3 (885 €)</option>
          </select>
        </div>
        <div class="hr"></div>
        <div class="row actions">
          <button class="btn btn-primary calc">Calculer</button>
          <button class="btn btn-ghost savehist" title="Ajoute cette simulation à l'historique">Enregistrer dans l'historique</button>
        </div>
      </section>

      <section class="card" style="grid-column: span 12">
        <div class="row">
          <div class="kpi card">
            <div class="label">% atteinte Prévoyance</div>
            <div class="value ro_prev">0%</div>
            <div class="delta small badge badge-warn ro_prev_badge">—</div>
          </div>
          <div class="kpi card">
            <div class="label">% atteinte ER (contrats)</div>
            <div class="value ro_er_c">0%</div>
            <div class="delta small badge badge-warn ro_er_c_badge">—</div>
          </div>
          <div class="kpi card">
            <div class="label">% atteinte ER (CA€)</div>
            <div class="value ro_er_e">0%</div>
            <div class="delta small badge badge-warn ro_er_e_badge">—</div>
          </div>
          <div class="kpi card">
            <div class="label">Prime éco totale</div>
            <div class="value prime_eco">0 €</div>
            <div class="delta small">(Pré + ER contrats + ER CA€)</div>
          </div>
          <div class="kpi card">
            <div class="label">Surperformance</div>
            <div class="value prime_surperf">0 €</div>
            <div class="delta small">Prévoyance + ER contrats</div>
          </div>
          <div class="kpi card">
            <div class="label">Bonifs qualité</div>
            <div class="value prime_qual">0 €</div>
          </div>
          <div class="kpi card">
            <div class="label">Collectif Santé</div>
            <div class="value prime_coll">0 €</div>
          </div>
          <div class="kpi card">
            <div class="label">Total</div>
            <div class="value total">0 €</div>
          </div>
        </div>
        <div class="hr"></div>
        <h3 class="section-title">Détail du calcul</h3>
        <textarea class="details" rows="12" readonly>Effectue un calcul puis reviens ici : le détail s'affichera.</textarea>
      </section>
    </div>
  `;

  const $ = sel => root.querySelector(sel);
  const SAVE_PREFIX = 'v67.';

  const els = {
    printBtn: $('.print'), clearBtn: $('.clear'), saveHist: $('.savehist'),
    ca_prev: $('.ca_prev'), pullPrev: $('.pullPrev'), obj_prev: $('.obj_prev'),
    nb_er: $('.nb_er'), obj_er: $('.obj_er'),
    ca_er: $('.ca_er'), obj_er_eur: $('.obj_er_eur'),
    b_prev: $('.b_prev'), b_er_c: $('.b_er_c'), b_er_e: $('.b_er_e'),
    surprev: $('.surprev'), surer: $('.surer'),
    q_neo: $('.q_neo'), q_multi: $('.q_multi'),
    coll_palier: $('.coll_palier'),
    calc: $('.calc'),
    ro_prev: $('.ro_prev'), ro_er_c: $('.ro_er_c'), ro_er_e: $('.ro_er_e'),
    ro_prev_badge: $('.ro_prev_badge'), ro_er_c_badge: $('.ro_er_c_badge'), ro_er_e_badge: $('.ro_er_e_badge'),
    prime_eco: $('.prime_eco'), prime_surperf: $('.prime_surperf'), prime_qual: $('.prime_qual'),
    prime_coll: $('.prime_coll'), total: $('.total'),
    details: $('.details')
  };

  // Autosave / restore
  function restoreAll(){
    root.querySelectorAll('[data-save="1"]').forEach(el => {
      const key = SAVE_PREFIX + el.className.split(' ')[0];
      const val = localStorage.getItem(key);
      if(val!=null){ el.value = val; }
      const handler = ()=> localStorage.setItem(key, el.value);
      el.addEventListener('input', handler);
      el.addEventListener('change', handler);
    });
  }
  restoreAll();

  // Prefill CA prev from previous tab
  const savedCA = Number(localStorage.getItem('calc.ca_prev')||0) || 0;
  if(savedCA>0 && !els.ca_prev.value) els.ca_prev.value = Math.round(savedCA);
  els.pullPrev.addEventListener('click', () => {
    const prevData = JSON.parse(localStorage.getItem('prev.data')||'[]');
    const totalAnnual = prevData.reduce((s,d)=> s + (Number(d.annual)||0), 0);
    els.ca_prev.value = Math.round(totalAnnual);
  });

  els.printBtn.addEventListener('click', () => window.print());
  els.clearBtn.addEventListener('click', () => {
    if(confirm('Réinitialiser les paramètres sauvegardés ?')){
      root.querySelectorAll('[data-save="1"]').forEach(el => {
        const key = SAVE_PREFIX + el.className.split(' ')[0];
        localStorage.removeItem(key);
      });
      alert('Paramètres effacés. Recharge la page pour revenir aux valeurs par défaut.');
    }
  });

  els.calc.addEventListener('click', compute);
  els.saveHist.addEventListener('click', saveToHistory);

  function parseBarème(txt){
    const parts = txt.split(',').map(s=>s.trim()).filter(Boolean);
    const arr = parts.map(p => {
      const [k,v] = p.split(':').map(x=>x.trim());
      return {k: Number(k), v: Number(v)};
    }).filter(x=> !isNaN(x.k) && !isNaN(x.v)).sort((a,b)=> a.k-b.k);
    return arr;
  }
  function valueFromBarème(ro, arr){
    if(!arr.length) return 0;
    let val = 0;
    for(const it of arr){
      if(ro >= it.k) val = it.v;
      else break;
    }
    return val;
  }
  function badgeText(p){ return p>=125? 'Surperf' : p>=100? 'Objectif OK' : p>=80? 'En bonne voie' : 'À la traîne'; }
  function setBadge(el,p){
    el.textContent = badgeText(p);
    el.className = 'delta small badge ' + (p>=125? 'badge-over' : p>=100? 'badge-ok' : p>=80? 'badge-warn' : '');
  }

  function compute(){
    const caPrev = Number(els.ca_prev.value||0), objPrev = Number(els.obj_prev.value||0);
    const nbER = Number(els.nb_er.value||0), objER = Number(els.obj_er.value||0);
    const caER = Number(els.ca_er.value||0), objEREur = Number(els.obj_er_eur.value||0);

    const roPrev = objPrev>0 ? (caPrev/objPrev*100) : 0;
    const roERc = objER>0 ? (nbER/objER*100) : 0;
    const roERe = objEREur>0 ? (caER/objEREur*100) : 0;

    els.ro_prev.textContent = (Math.round(roPrev*10)/10)+'%';
    els.ro_er_c.textContent = (Math.round(roERc*10)/10)+'%';
    els.ro_er_e.textContent = (Math.round(roERe*10)/10)+'%';
    setBadge(els.ro_prev_badge, roPrev);
    setBadge(els.ro_er_c_badge, roERc);
    setBadge(els.ro_er_e_badge, roERe);

    const bPrev = parseBarème(els.b_prev.value);
    const bERc = parseBarème(els.b_er_c.value);
    const bERe = parseBarème(els.b_er_e.value);

    const pPrev = valueFromBarème(roPrev, bPrev);
    const pERc = valueFromBarème(roERc, bERc);
    const pERe = valueFromBarème(roERe, bERe);

    const primeEco = pPrev + pERc + pERe;
    els.prime_eco.textContent = fmt0.format(primeEco);

    // Surperformance (non bonifiée)
    const perPrev = Number(els.surprev.value||100);
    const perER = Number(els.surer.value||20);
    const trPrev = roPrev>125 ? Math.floor((roPrev-125)/5) : 0;
    const trER = roERc>125 ? Math.floor((roERc-125)/5) : 0;
    const primeSurperf = trPrev*perPrev + trER*perER;
    els.prime_surperf.textContent = fmt0.format(primeSurperf);

    // Qualitatif
    const qNeo = Number(els.q_neo.value||0);
    const qMul = Number(els.q_multi.value||0);
    const primeQual = Math.round(primeEco * (qNeo + qMul) / 100);
    els.prime_qual.textContent = fmt0.format(primeQual);

    // Collectif
    let primeColl = 0;
    const eligible = (roPrev>=65) || (roERc>=65) || (roERe>=65);
    if(eligible){
      const pal = Number(els.coll_palier.value||0);
      primeColl = pal===1 ? 280 : pal===2 ? 555 : pal===3 ? 885 : 0;
    }
    els.prime_coll.textContent = fmt0.format(primeColl);

    const total = primeEco + primeSurperf + primeQual + primeColl;
    els.total.textContent = fmt0.format(total);

    // Details
    const br = [];
    br.push('— Récapitulatif v6.7 —');
    br.push(`Prévoyance : CA ${fmt0.format(caPrev)} / Obj ${fmt0.format(objPrev)} → R/O ${roPrev.toFixed(1)}%`);
    br.push(`  • Barème: ${fmt0.format(pPrev)}`);
    br.push(`  • Surperf Pré: ${trPrev} × ${fmt0.format(perPrev)} = ${fmt0.format(trPrev*perPrev)}`);
    br.push(`ER Contrats : ${nbER} / Obj ${objER} → R/O ${roERc.toFixed(1)}%`);
    br.push(`  • Barème: ${fmt0.format(pERc)}`);
    br.push(`  • Surperf ER: ${trER} × ${fmt0.format(perER)} = ${fmt0.format(trER*perER)}`);
    br.push(`ER CA€ : ${fmt0.format(caER)} / Obj ${fmt0.format(objEREur)} → R/O ${roERe.toFixed(1)}%`);
    br.push(`  • Barème: ${fmt0.format(pERe)}`);
    br.push(`Qualitatif : ${(qNeo+qMul)||0}% × base ${fmt0.format(primeEco)} = ${fmt0.format(primeQual)}`);
    br.push(`Collectif Santé : ${eligible ? 'Éligible' : 'Non éligible'} → ${fmt0.format(primeColl)}`);
    br.push(`TOTAL: ${fmt0.format(total)}`);
    els.details.value = br.join('\n');

    const state = { caPrev, objPrev, nbER, objER, caER, objEREur, roPrev, roERc, roERe, primeEco, primeSurperf, primeQual, primeColl, total };
    localStorage.setItem('v67.lastCalc', JSON.stringify(state));
  }

  function saveToHistory(){
    const raw = localStorage.getItem('v67.lastCalc');
    if(!raw){ alert('Fais d’abord un calcul.'); return; }
    const st = JSON.parse(raw);
    st.ts = new Date().toISOString();
    const list = JSON.parse(localStorage.getItem('v67.history')||'[]');
    list.push(st);
    localStorage.setItem('v67.history', JSON.stringify(list));
    alert('Ajouté à l’historique ✔');
  }
}

/* ===== Global tab ===== */
function buildGlobalPanel(){
  const root = document.getElementById('global');
  root.innerHTML = `
    <div class="grid">
      <section class="card" style="grid-column: span 12">
        <div class="row" style="justify-content:space-between; width:100%">
          <h3 class="section-title">Vue globale annuelle</h3>
          <div class="actions">
            <button class="btn btn-ghost print">Exporter PDF</button>
            <button class="btn btn-ghost pull">← récupérer la dernière simulation</button>
          </div>
        </div>
        <div class="row">
          <div class="kpi card">
            <div class="label">R/O global (moyenne 3 obj.)</div>
            <div class="value ro_global">—</div>
            <div class="delta small badge ro_global_badge">—</div>
          </div>
          <div class="kpi card">
            <div class="label">CA Prévoyance</div>
            <div class="value ca_prev">—</div>
            <div class="delta small">Objectif: <span class="obj_prev">—</span></div>
          </div>
          <div class="kpi card">
            <div class="label">ER Contrats</div>
            <div class="value er_c">—</div>
            <div class="delta small">Objectif: <span class="obj_er">—</span></div>
          </div>
          <div class="kpi card">
            <div class="label">CA ER</div>
            <div class="value ca_er">—</div>
            <div class="delta small">Objectif: <span class="obj_er_eur">—</span></div>
          </div>
          <div class="kpi card">
            <div class="label">Prime totale</div>
            <div class="value prime_total">—</div>
            <div class="delta small">(éco + surperf + qualitatif + collectif)</div>
          </div>
        </div>
      </section>
    </div>
  `;

  const $ = sel => root.querySelector(sel);
  const els = {
    printBtn: $('.print'), pullBtn: $('.pull'),
    ro_global: $('.ro_global'), ro_global_badge: $('.ro_global_badge'),
    ca_prev: $('.ca_prev'), obj_prev: $('.obj_prev'),
    er_c: $('.er_c'), obj_er: $('.obj_er'),
    ca_er: $('.ca_er'), obj_er_eur: $('.obj_er_eur'),
    prime_total: $('.prime_total')
  };
  els.printBtn.addEventListener('click', ()=> window.print());
  els.pullBtn.addEventListener('click', fillFromLast);

  function badgeText(p){ return p>=125? 'Surperf' : p>=100? 'Objectif OK' : p>=80? 'En bonne voie' : 'À la traîne'; }
  function setBadge(el,p){
    el.textContent = badgeText(p);
    el.className = 'delta small badge ' + (p>=125? 'badge-over' : p>=100? 'badge-ok' : p>=80? 'badge-warn' : '');
  }

  function fillFromLast(){
    const raw = localStorage.getItem('v67.lastCalc'); if(!raw){ alert('Aucune simulation trouvée. Va dans l’onglet Calculateur.'); return; }
    const s = JSON.parse(raw);
    const roGlobal = (s.roPrev + s.roERc + s.roERe) / 3;
    els.ro_global.textContent = (Math.round(roGlobal*10)/10)+'%';
    setBadge(els.ro_global_badge, roGlobal);
    els.ca_prev.textContent = fmt0.format(s.caPrev); els.obj_prev.textContent = fmt0.format(s.objPrev);
    els.er_c.textContent = s.nbER + ' contrats'; els.obj_er.textContent = s.objER + ' contrats';
    els.ca_er.textContent = fmt0.format(s.caER); els.obj_er_eur.textContent = fmt0.format(s.objEREur);
    els.prime_total.textContent = fmt0.format(s.total);
  }
}

/* ===== Plan tab (route simple jusqu'à décembre) ===== */



function buildPlanPanel(){
  const root = document.getElementById('plan');
  // persist week mode
  try{ localStorage.setItem('plan.weekMode','iso'); }catch(e){}

  root.innerHTML = `
    <div class="grid">
      <section class="card" style="grid-column: span 12">
        <h3 class="section-title">Suivi hebdomadaire (Semaines ISO) → Objectif mensuel → Objectif annuel</h3>

        <div class="row" style="flex-wrap:wrap; gap:8px">
          <span class="small">Vue</span>
          <select class="view">
            <option value="mois">Mois</option>
            <option value="annee">Année</option>
          </select>

          <span class="small">Année</span>
          <select class="year"></select>

          <span class="small month-label">Mois</span>
          <select class="month"></select>

          <span class="small">Objectif annuel (€)</span>
          <input class="goal" type="number" min="0" step="1" placeholder="ex. 70000" />

          <span class="small">Source</span>
          <select class="mode">
            <option value="auto" selected>Auto (Prévoyance)</option>
            <option value="manual">Manuelle</option>
          </select>

          <span class="small">Objectif du mois (€)</span>
          <input class="mgoal" type="number" min="0" step="1" placeholder="ex. 6000" />

          <button class="btn btn-primary saveGoals">Enregistrer objectifs</button>

          <!-- Champs invisibles pour compat scénarios existants -->
          <input class="ytd" type="number" style="display:none" />
          <input class="basket" type="number" style="display:none" value="60" />
          <button class="btn btn-ghost toSimu" style="display:none">→ Pré-remplir l’onglet Simulation</button>
        </div>

        <div class="hr"></div>

        <div class="row" style="flex-wrap:wrap; gap:8px; align-items:flex-start">
          <h4 class="section-title" style="margin:0">Semaines ISO</h4>
          <div class="weeks" style="flex:1 1 100%"></div>
          <div class="actions">
            <button class="btn btn-ghost export">Exporter (CSV)</button>
            <button class="btn btn-danger reset">Réinitialiser</button>
          </div>
        </div>

        <div class="hr"></div>
        <div class="row" style="flex-direction:column; gap:10px; width:100%">
          <div class="kpi card">
            <div class="label">Avancement mensuel</div>
            <div class="value msum">0 €</div>
            <div class="delta small">Objectif du mois : <span class="mgoal_view">—</span> • Progression : <span class="mpct">0%</span></div>
            <div class="progress"><div class="bar mbar" style="width:0%"></div></div>
          </div>
          <div class="kpi card">
            <div class="label">Avancement annuel (YTD)</div>
            <div class="value ytdsum">0 €</div>
            <div class="delta small">Objectif annuel : <span class="goal_view">—</span> • Progression : <span class="ypct">0%</span></div>
            <div class="progress"><div class="bar ybar" style="width:0%"></div></div>
          </div>
        </div>
      </section>
    </div>
  `;

  const $ = sel => root.querySelector(sel);
  const els = {
    view: $('.view'), year: $('.year'), month: $('.month'), monthLabel: $('.month-label'),
    goal: $('.goal'), mgoal: $('.mgoal'), saveGoals: $('.saveGoals'), mode: $('.mode'),
    weeks: $('.weeks'), exportBtn: $('.export'), resetBtn: $('.reset'),
    msum: $('.msum'), mgoal_view: $('.mgoal_view'), mpct: $('.mpct'), mbar: $('.mbar'),
    ytdsum: $('.ytdsum'), goal_view: $('.goal_view'), ypct: $('.ypct'), ybar: $('.ybar'),
    ytd: $('.ytd')
  };

  // ===== Helpers =====
  function ymd(d){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
  function clone(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }
  function addDays(d, n){ const r = clone(d); r.setDate(r.getDate()+n); return r; }
  function daysInMonth(y,m){ return new Date(y, m+1, 0).getDate(); }
  function round0(x){ return Math.round(Number(x)||0); }

  // ISO week helpers
  function startOfISOWeek(d){ const r = clone(d); const day = (r.getDay()+6)%7; r.setDate(r.getDate()-day); return r; } // Monday
  function endOfISOWeek(d){ return addDays(startOfISOWeek(d),6); }
  function isoWeekYear(d){
    const r = clone(d);
    const th = addDays(r, 3 - ((r.getDay()+6)%7)); // Thursday
    return th.getFullYear();
  }
  function isoWeekNumber(d){
    const r = clone(d);
    const ws = startOfISOWeek(r);
    const th = addDays(r, 3 - ((r.getDay()+6)%7));
    const jan4 = new Date(th.getFullYear(), 0, 4);
    const w1 = startOfISOWeek(jan4);
    const diffDays = Math.round((ws - w1)/86400000);
    return Math.floor(diffDays/7) + 1;
  }

  function isoWeeksForMonth(year, monthIndex){
    const first = new Date(year, monthIndex, 1);
    const last = new Date(year, monthIndex, daysInMonth(year, monthIndex));
    const start = startOfISOWeek(first);
    const end = endOfISOWeek(last);
    const out = [];
    for(let d = clone(start); d <= end; d = addDays(d,7)){
      const s = clone(d);
      const e = endOfISOWeek(s);
      const iy = isoWeekYear(s);
      const iw = isoWeekNumber(s);
      out.push({ isoYear: iy, isoWeek: iw, start: ymd(s), end: ymd(e), key: `${iy}-W${String(iw).padStart(2,'0')}` });
    }
    return out;
  }

  function isoWeeksForYear(year){
    const jan4 = new Date(year,0,4);
    let d = startOfISOWeek(jan4); // Monday of ISO week 1
    const out = [];
    while(true){
      const iy = isoWeekYear(d);
      if(iy !== year) break;
      const s = clone(d);
      const e = endOfISOWeek(s);
      const iw = isoWeekNumber(s);
      out.push({ isoYear: iy, isoWeek: iw, start: ymd(s), end: ymd(e), key: `${iy}-W${String(iw).padStart(2,'0')}` });
      d = addDays(d,7);
    }
    return out;
  }

  // Data from Prévoyance
  function loadPrevData(){
    try{ const j = localStorage.getItem('prev.data'); return j? JSON.parse(j): []; }catch(e){ return []; }
  }

  function autoTotalsFor(weeks){
    const data = loadPrevData();
    const map = new Map();
    for(const r of data){
      const ds = (r.date||'').trim(); if(!ds) continue;
      const m = ds.match(/^(\d{4})-(\d{2})-(\d{2})$/); if(!m) continue;
      const d = new Date(Number(m[1]), Number(m[2])-1, Number(m[3]));
      const iy = isoWeekYear(d); const iw = isoWeekNumber(d);
      const key = `${iy}-W${String(iw).padStart(2,'0')}`;
      map.set(key, (map.get(key)||0) + (Number(r.annual)||0));
    }
    // Round each weekly total to nearest euro
    return weeks.map(w => round0(map.get(w.key)||0));
  }

  // YTD helpers
  function sumAnnualInMonth(data, year, month){ // month 0..11
    const ym = `${year}-${String(month+1).padStart(2,'0')}`;
    // Round monthly sums as integers too
    const s = data.reduce((s,d)=> s + ((d.date||'').startsWith(ym) ? (Number(d.annual)||0) : 0), 0);
    return round0(s);
  }

  // Storage helpers
  function kAnnual(){ return 'plan.annual.goal'; }
  function kMGoal(ym){ return 'plan.month.goal.'+ym; }
  function kWeeksMonth(ym){ return 'plan.month.weeks.'+ym; }
  function kWeeksYear(y){ return 'plan.year.weeks.'+y; }

  function loadAnnual(){ return round0(localStorage.getItem(kAnnual())||0); }
  function saveAnnual(v){ localStorage.setItem(kAnnual(), String(round0(v))); }
  function loadMGoal(ym){ return round0(localStorage.getItem(kMGoal(ym))||0); }
  function saveMGoal(ym,v){ localStorage.setItem(kMGoal(ym), String(round0(v))); }
  function loadWeeksMonth(ym){ try{ const j=localStorage.getItem(kWeeksMonth(ym)); return j? JSON.parse(j).map(round0): []; }catch(e){ return []; } }
  function saveWeeksMonth(ym, arr){ localStorage.setItem(kWeeksMonth(ym), JSON.stringify(arr.map(round0))); }
  function loadWeeksYear(y){ try{ const j=localStorage.getItem(kWeeksYear(y)); return j? JSON.parse(j).map(round0): []; }catch(e){ return []; } }
  function saveWeeksYear(y, arr){ localStorage.setItem(kWeeksYear(y), JSON.stringify(arr.map(round0))); }

  // Selectors init (persisted)
  const now = new Date();
  const curYear = now.getFullYear();
  const curMonth = now.getMonth(); // 0..11

  const savedView = localStorage.getItem('plan.view') || 'mois';
  els.view.value = (savedView==='annee'?'annee':'mois');

  // Year list: +/- 3 years around current + any years from data
  const years = (()=>{
    const set = new Set([curYear-1, curYear, curYear+1, curYear+2]);
    const d = loadPrevData();
    d.forEach(r => { const y = (r.date||'').slice(0,4); if(y) set.add(Number(y)); });
    return Array.from(set).sort((a,b)=>a-b);
  })();
  els.year.innerHTML = years.map(y=> `<option value="${y}">${y}</option>`).join('');
  const savedYear = Number(localStorage.getItem('plan.year')||curYear) || curYear;
  if(years.includes(savedYear)) els.year.value = String(savedYear); else els.year.value = String(curYear);

  function fillMonthSelect(){
    const y = Number(els.year.value)||curYear;
    const opts = Array.from({length:12},(_,i)=>{
      const ym = `${y}-${String(i+1).padStart(2,'0')}`;
      return `<option value="${ym}">${ym}</option>`;
    }).join('');
    els.month.innerHTML = opts;
    const savedMonth = localStorage.getItem('plan.month') || `${curYear}-${String(curMonth+1).padStart(2,'0')}`;
    const targetYM = savedMonth.startsWith(String(y)) ? savedMonth : `${y}-01`;
    els.month.value = targetYM;
  }
  fillMonthSelect();

  // Goals init
  const ym0 = els.month.value;
  const aGoal = loadAnnual();
  const mGoal = loadMGoal(ym0) || round0((aGoal||0)/12);
  if(aGoal>0) els.goal.value = aGoal;
  if(mGoal>0) els.mgoal.value = mGoal;

  // Render UI
  function renderWeeks(){
    const view = els.view.value;
    const mode = els.mode.value;
    const yearSel = Number(els.year.value)||curYear;
    const ym = els.month.value;
    const [ySel, mSel] = ym.split('-').map(Number);
    const wdefs = view==='mois' ? isoWeeksForMonth(ySel, mSel-1) : isoWeeksForYear(yearSel);

    let vals = [];
    if(mode==='auto'){
      vals = autoTotalsFor(wdefs);
    }else{
      if(view==='mois'){
        vals = loadWeeksMonth(ym);
        while(vals.length < wdefs.length) vals.push(0);
      }else{
        vals = loadWeeksYear(yearSel);
        while(vals.length < wdefs.length) vals.push(0);
      }
    }

    const rows = wdefs.map((w,idx)=>{
      const v = round0(vals[idx]||0);
      const input = mode==='auto'
        ? `<input data-week="${idx}" type="number" min="0" step="1" value="${v}" style="width:160px" disabled />`
        : `<input data-week="${idx}" type="number" min="0" step="1" value="${v}" style="width:160px" />`;
      return `<div class="row" style="gap:12px; align-items:center">
        <span class="small" style="width:320px">${w.isoYear}-W${String(w.isoWeek).padStart(2,'0')} : ${w.start} → ${w.end}</span>
        ${input}<span class="small">€</span>
      </div>`;
    }).join('');
    els.weeks.innerHTML = rows;

    if(mode!=='auto'){
      els.weeks.querySelectorAll('input[type="number"]').forEach(inp=>{
        inp.addEventListener('input', ()=>{
          const current = Array.from(els.weeks.querySelectorAll('input')).map(x=> round0(x.value||0));
          if(view==='mois'){ saveWeeksMonth(ym, current); } else { saveWeeksYear(yearSel, current); }
          recalc(); // update KPIs
        });
      });
    }
  }

  // Recalculate KPIs (rounded)
  function colorFor(pct){ return pct>=125? 'var(--over)' : pct>=100? 'var(--ok)' : pct>=80? 'var(--warn)' : 'var(--danger)'; }
  function fmt0eur(x){ return new Intl.NumberFormat('fr-FR', {style:'currency', currency:'EUR', maximumFractionDigits:0}).format(round0(x||0)); }

  function recalc(){
    const view = els.view.value;
    const mode = els.mode.value;
    const ym = els.month.value;
    const [ySel, mSel] = ym.split('-').map(Number);
    const yearSel = Number(els.year.value)||ySel;

    const wdefs = view==='mois' ? isoWeeksForMonth(ySel, mSel-1) : isoWeeksForYear(yearSel);
    const valsRaw = (mode==='auto')
      ? autoTotalsFor(wdefs)
      : (view==='mois' ? loadWeeksMonth(ym).slice(0, wdefs.length) : loadWeeksYear(yearSel).slice(0, wdefs.length));
    const vals = valsRaw.map(round0);

    // Monthly KPIs only meaningful for Vue "Mois"
    const msum = vals.reduce((s,x)=> s+(Number(x)||0), 0);
    const mgoal = round0( Number(els.mgoal.value||0) || loadMGoal(ym) || round0((Number(els.goal.value||0) || loadAnnual())/12) );
    els.mgoal.value = mgoal;
    els.msum.textContent = fmt0eur(msum);
    els.mgoal_view.textContent = fmt0eur(mgoal);
    const mpct = mgoal>0 ? (msum/mgoal*100) : 0;
    els.mpct.textContent = (Math.round(mpct*10)/10)+'%';
    els.mbar.style.width = Math.min(100, Math.round(mpct))+'%';
    els.mbar.style.background = colorFor(mpct);
    // Show/hide monthly KPI based on view
    const monthlyCard = els.msum.closest('.kpi');
    monthlyCard.style.display = (view==='mois') ? '' : 'none';

    // YTD
    let ytd = 0;
    if(mode==='auto'){
      const data = loadPrevData();
      for(let mm=0; mm <= (view==='mois' ? (mSel-1) : 11); mm++){
        ytd += sumAnnualInMonth(data, yearSel, mm);
      }
    }else{
      if(view==='mois'){
        for(let mm=1; mm<=mSel; mm++){
          const ymx = `${yearSel}-${String(mm).padStart(2,'0')}`;
          ytd += loadWeeksMonth(ymx).map(round0).reduce((s,x)=> s+(Number(x)||0),0);
        }
      }else{
        ytd = vals.reduce((s,x)=> s+(Number(x)||0),0);
      }
    }
    ytd = round0(ytd);
    const agoal = round0(Number(els.goal.value||0) || loadAnnual());
    els.ytd.value = ytd;
    els.ytdsum.textContent = fmt0eur(ytd);
    els.goal_view.textContent = fmt0eur(agoal);
    const ypct = agoal>0 ? (ytd/agoal*100) : 0;
    els.ypct.textContent = (Math.round(ypct*10)/10)+'%';
    els.ybar.style.width = Math.min(100, Math.round(ypct))+'%';
    els.ybar.style.background = colorFor(ypct);
  }

  // Export CSV (rounded)
  els.exportBtn.addEventListener('click', ()=>{
    const view = els.view.value;
    const mode = els.mode.value;
    const ym = els.month.value;
    const [ySel, mSel] = ym.split('-').map(Number);
    const yearSel = Number(els.year.value)||ySel;
    const wdefs = view==='mois' ? isoWeeksForMonth(ySel, mSel-1) : isoWeeksForYear(yearSel);
    const valsRaw = (mode==='auto') ? autoTotalsFor(wdefs)
                                 : (view==='mois' ? loadWeeksMonth(ym).slice(0, wdefs.length) : loadWeeksYear(yearSel).slice(0, wdefs.length));
    const vals = valsRaw.map(round0);

    const headers = ['year','isoWeek','weekStart','weekEnd','amount','monthShown','mode'];
    const lines = [headers.join(';')].concat(
      wdefs.map((w,i)=>[w.isoYear, String(w.isoWeek).padStart(2,'0'), w.start, w.end, round0(vals[i]||0),
                        (view==='mois'? ym : ''), mode].join(';'))
    );
    const blob = new Blob([lines.join('\\n')], {type:'text/csv;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = (view==='mois' ? `plan_${ym}.csv` : `plan_${yearSel}.csv`);
    a.click(); URL.revokeObjectURL(a.href);
  });

  // Reset
  els.resetBtn.addEventListener('click', ()=>{
    const view = els.view.value;
    const ym = els.month.value;
    const yearSel = Number(els.year.value)||new Date().getFullYear();
    if(view==='mois'){
      if(confirm(`Réinitialiser les semaines (manuel) pour ${ym} ?`)){ saveWeeksMonth(ym, []); renderWeeks(); recalc(); }
    }else{
      if(confirm(`Réinitialiser les semaines (manuel) pour l'année ${yearSel} ?`)){ saveWeeksYear(yearSel, []); renderWeeks(); recalc(); }
    }
  });

  // Goals save
  els.saveGoals.addEventListener('click', ()=>{
    const ym = els.month.value;
    saveAnnual(els.goal.value);
    saveMGoal(ym, els.mgoal.value);
    recalc();
  });

  // Reactivity
  function onViewChange(){
    const v = els.view.value;
    els.month.style.display = (v==='mois') ? '' : 'none';
    els.monthLabel.style.display = (v==='mois') ? '' : 'none';
    localStorage.setItem('plan.view', v);
    renderWeeks(); recalc();
  }
  els.view.addEventListener('change', onViewChange);

  els.year.addEventListener('change', ()=>{
    localStorage.setItem('plan.year', els.year.value);
    fillMonthSelect();
    renderWeeks(); recalc();
  });

  els.month.addEventListener('change', ()=>{
    localStorage.setItem('plan.month', els.month.value);
    const mg = loadMGoal(els.month.value) || round0((loadAnnual()||0)/12);
    els.mgoal.value = mg>0 ? mg : '';
    renderWeeks(); recalc();
  });

  els.mode.addEventListener('change', ()=>{ renderWeeks(); recalc(); });

  // Initial render
  onViewChange(); // sets visibility + render
}

/* ===== Prise en charge GAV — Module embarqué (iframe) ===== */

/* ===== Prise en charge GAV — Module embarqué (INLINE, single-file) ===== */
function buildGAVPanel(){
  const root = document.getElementById('gav');
  root.innerHTML = `
    <div class="grid">
      <section class="card" style="grid-column: span 12">
        <h3 class="section-title">Prise en charge GAV</h3>
        <div class="small" style="opacity:.8;margin-bottom:8px">
          Version <b>tout-en-un</b> : module embarqué en data URL (base64), aucun fichier externe requis.
        </div>
        <div style="height:980px; border:1px solid var(--border); border-radius:12px; overflow:hidden; background:#0b1020">
          <iframe id="gav-frame" title="Prise en charge GAV" style="width:100%; height:100%; border:0; background:transparent"></iframe>
        </div>
      </section>
    </div>`;

  const frame = document.getElementById('gav-frame');
  const dataUrl = "data:text/html;base64,PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImZyIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xIiAvPgogIFwxUHJpc2UgZW4gY2hhcmdlIEdBVlwzCiAgPHN0eWxlPgogICAgLyogRGVtbyBob3N0IGJhY2tncm91bmQgc28gdGhlIGF1dG8tc2tpbiBwaWNrcyBhIGRhcmsgcGFsZXR0ZS4KICAgICAgIFJlbW92ZSBvciBjaGFuZ2UgdGhlc2UgaG9zdCBzdHlsZXMgdG8gbWF0Y2ggeW91ciBkYXNoYm9hcmQuICovCiAgICBodG1sLCBib2R5IHsgaGVpZ2h0OiAxMDAlOyB9CiAgICBib2R5IHsKICAgICAgbWFyZ2luOiAwOwogICAgICBwYWRkaW5nOiAxNnB4OwogICAgICBiYWNrZ3JvdW5kOiAjMGIxMjIwOwogICAgICBjb2xvcjogI2U1ZTdlYjsKICAgICAgZm9udC1mYW1pbHk6IEludGVyLCBzeXN0ZW0tdWksIC1hcHBsZS1zeXN0ZW0sIFNlZ29lIFVJLCBSb2JvdG8sIEhlbHZldGljYSwgQXJpYWwsICJBcHBsZSBDb2xvciBFbW9qaSIsICJTZWdvZSBVSSBFbW9qaSIsICJTZWdvZSBVSSBTeW1ib2wiLCBzYW5zLXNlcmlmOwogICAgfQogIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+Cgo8IS0tID09PT09IE1vZHVsZSAiUHJpc2UgRW4gR0FWIiAoUHLDqnQgw6AgY29sbGVyKSA9PT09PSAtLT4KPHNlY3Rpb24gaWQ9InRhYi1wcmlzZS1nYXYiIGNsYXNzPSJnYXYtd3JhcCIgZGF0YS1tb2R1bGU9InByaXNlLWdhdiI+CiAgPHN0eWxlPgogICAgLyogdjEuOCDigJQgVGhlbWUtYWRhcHRpdmUsIHrDqXJvIGTDqXBlbmRhbmNlIGV4dGVybmUsIENTUC1mcmllbmRseSAqLwogICAgLmdhdi13cmFwe2ZvbnQtZmFtaWx5OmluaGVyaXQ7Y29sb3I6dmFyKC0tdGV4dCxpbmhlcml0KTtiYWNrZ3JvdW5kOmluaGVyaXR9CiAgICAuZ2F2LWNvbnRhaW5lcnttYXgtd2lkdGg6MTIwMHB4O21hcmdpbjowIGF1dG87cGFkZGluZzoxNnB4fQogICAgLmdhdi1oZWFkZXJ7ZGlzcGxheTpmbGV4O2dhcDoxMnB4O2ZsZXgtd3JhcDp3cmFwO2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbn0KICAgIC5nYXYtdGl0bGV7Zm9udC1zaXplOjEuNXJlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tdGV4dCwjZTVlN2ViKTtkaXNwbGF5OmZsZXg7Z2FwOjEwcHg7YWxpZ24taXRlbXM6Y2VudGVyfQogICAgLmdhdi10aXRsZSAuZW1vaml7Zm9udC1zaXplOjEuNnJlbX0KCiAgICAvKiBJbnB1dHMgKi8KICAgIC5nYXYtc2VsZWN0LC5nYXYtaW5wdXR7YXBwZWFyYW5jZTpub25lO2JvcmRlcjoxcHggc29saWQgdmFyKC0tYm9yZGVyLCMxZjI5MzcpO2JhY2tncm91bmQ6dmFyKC0tYmcsIzBiMTIyMCk7Y29sb3I6dmFyKC0tdGV4dCwjZTVlN2ViKTtib3JkZXItcmFkaXVzOjEycHg7cGFkZGluZzoxMHB4IDEycHg7Zm9udC13ZWlnaHQ6NjAwfQogICAgLmdhdi1zZWxlY3Q6Zm9jdXMsLmdhdi1pbnB1dDpmb2N1c3tvdXRsaW5lOm5vbmU7Ym94LXNoYWRvdzowIDAgMCAycHggcmdiYSg1OSwxMzAsMjQ2LC4yNSl9CgogICAgLyogQmFkZ2VzICYgY2hpcHMgKi8KICAgIC5nYXYtYmFkZ2V7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDtwYWRkaW5nOjRweCAxMHB4O2JvcmRlci1yYWRpdXM6OTk5cHg7Zm9udC1zaXplOi44cmVtO2ZvbnQtd2VpZ2h0OjcwMDtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWJvcmRlciwjMWYyOTM3KTtiYWNrZ3JvdW5kOnZhcigtLWJnLCB0cmFuc3BhcmVudCk7Y29sb3I6dmFyKC0tdGV4dCwjZTVlN2ViKX0KICAgIC5nYXYtY2hpcHtkaXNwbGF5OmlubGluZS1mbGV4O2dhcDo2cHg7YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6NHB4IDhweDtib3JkZXItcmFkaXVzOjk5OXB4O2ZvbnQtc2l6ZTouNzVyZW07Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1ib3JkZXIsIzFmMjkzNyk7YmFja2dyb3VuZDp2YXIoLS1iZywgdHJhbnNwYXJlbnQpO2NvbG9yOnZhcigtLW11dGVkLCM5NGEzYjgpfQogICAgLmdhdi1waWxse2Rpc3BsYXk6aW5saW5lLWJsb2NrO3BhZGRpbmc6MnB4IDhweDtib3JkZXItcmFkaXVzOjk5OXB4O2JhY2tncm91bmQ6cmdiYSg1OSwxMzAsMjQ2LC4xNSk7Y29sb3I6IzkzYzVmZDtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOi43NXJlbTtib3JkZXI6MXB4IHNvbGlkIHJnYmEoMzAsNjQsMTc1LC42KX0KCiAgICAvKiBMYXlvdXQgKi8KICAgIC5nYXYtZ3JpZHtkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOnJlcGVhdCgxMiwxZnIpO2dhcDoxNHB4O21hcmdpbi10b3A6MTZweH0KICAgIC5nYXYtY2FyZHtncmlkLWNvbHVtbjpzcGFuIDEyO2JhY2tncm91bmQ6dmFyKC0tcGFuZWwsIHZhcigtLWNhcmQtYmcsIHRyYW5zcGFyZW50KSk7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1ib3JkZXIsIzFmMjkzNyk7Ym9yZGVyLXJhZGl1czoxNnB4O3BhZGRpbmc6MTRweDtib3gtc2hhZG93OjAgMTJweCA0MHB4IHJnYmEoMCwwLDAsLjI4KSwgaW5zZXQgMCAxcHggMCByZ2JhKDI1NSwyNTUsMjU1LC4wMyk7dHJhbnNpdGlvbjp0cmFuc2Zvcm0gLjEycyBlYXNlLCBib3gtc2hhZG93IC4xMnMgZWFzZX0KICAgIC5nYXYtY2FyZDpob3Zlcnt0cmFuc2Zvcm06dHJhbnNsYXRlWSgtMXB4KTtib3gtc2hhZG93OjAgMTZweCA0NHB4IHJnYmEoMCwwLDAsLjM0KX0KICAgIEBtZWRpYShtaW4td2lkdGg6NzIwcHgpey5nYXYtY2FyZHtncmlkLWNvbHVtbjpzcGFuIDZ9fQogICAgQG1lZGlhKG1pbi13aWR0aDoxMDQwcHgpey5nYXYtY2FyZHtncmlkLWNvbHVtbjpzcGFuIDR9fQoKICAgIC5nYXYtY2FyZC1oZWFke2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtnYXA6MTJweDthbGlnbi1pdGVtczpmbGV4LXN0YXJ0fQogICAgLmdhdi1jYXJkLXRpdGxle2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS10ZXh0LCNlNWU3ZWIpfQogICAgLmdhdi10YWdze2Rpc3BsYXk6ZmxleDtnYXA6NnB4O2ZsZXgtd3JhcDp3cmFwO21hcmdpbi10b3A6NnB4fQogICAgLmdhdi1tb25leXtmb250LXNpemU6MS4yNXJlbTtmb250LXdlaWdodDo5MDA7Y29sb3I6dmFyKC0tYWNjZW50MiwjM2I4MmY2KX0KICAgIC5nYXYtbXV0ZWR7Y29sb3I6dmFyKC0tbXV0ZWQsIzk0YTNiOCk7Zm9udC1zaXplOi45cmVtfQoKICAgIC8qIENvbXBhcmUgYmFyICovCiAgICAuZ2F2LWNvbXBhcmV7bWFyZ2luLXRvcDo4cHh9CiAgICAuZ2F2LWJhcntoZWlnaHQ6MTBweDtib3JkZXItcmFkaXVzOjEwcHg7YmFja2dyb3VuZDp2YXIoLS1iZywjMGIxMjIwKTtwb3NpdGlvbjpyZWxhdGl2ZTtvdmVyZmxvdzpoaWRkZW47Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1ib3JkZXIsIzFmMjkzNyl9CiAgICAuZ2F2LWJhciAubGVmdHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOjA7aGVpZ2h0OjEwMCU7YmFja2dyb3VuZDp2YXIoLS1iYXJMZWZ0LCMzMzQxNTUpfQogICAgLmdhdi1iYXIgLnJpZ2h0e3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDtoZWlnaHQ6MTAwJTtiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCg5MGRlZyx2YXIoLS1hY2NlbnQsIzIyYzU1ZSksdmFyKC0tYWNjZW50MiwjM2I4MmY2KSk7b3BhY2l0eTouOX0KICAgIC5nYXYtZmlndXJlc3tkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47Zm9udC1zaXplOi44cmVtO21hcmdpbi10b3A6NnB4O2NvbG9yOnZhcigtLW11dGVkLCM5NGEzYjgpfQoKICAgIC8qIEFjdGlvbnMgLyBidXR0b25zICovCiAgICAuZ2F2LWFjdGlvbnN7ZGlzcGxheTpmbGV4O2dhcDo4cHg7bWFyZ2luLXRvcDoxMHB4O2ZsZXgtd3JhcDp3cmFwfQogICAgLmdhdi1idG57Y3Vyc29yOnBvaW50ZXI7Ym9yZGVyOjFweCBzb2xpZCB0cmFuc3BhcmVudDtiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCgxODBkZWcsdmFyKC0tYWNjZW50MiwjM2I4MmY2KSwjMWQ0ZWQ4KTtjb2xvcjojZmZmO2ZvbnQtd2VpZ2h0OjgwMDtib3JkZXItcmFkaXVzOjEycHg7cGFkZGluZzo5cHggMTJweH0KICAgIC5nYXYtYnRuLnNlY3tiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O2NvbG9yOnZhcigtLXRleHQsI2U1ZTdlYik7Ym9yZGVyLWNvbG9yOnZhcigtLWJvcmRlciwjMWYyOTM3KX0KCiAgICAvKiBEZXRhaWxzICYgZXhwbGFpbmVycyAqLwogICAgLmdhdi1kZXRhaWxze2Rpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjEwcHg7Ym9yZGVyLXRvcDoxcHggZGFzaGVkIHZhcigtLWJvcmRlciwjMWYyOTM3KTtwYWRkaW5nLXRvcDoxMHB4O2ZvbnQtc2l6ZTouOTVyZW07Y29sb3I6dmFyKC0tdGV4dCwjZTVlN2ViKX0KICAgIC5nYXYtZXhwbGFpbnttYXJnaW4tdG9wOjEwcHg7YmFja2dyb3VuZDp2YXIoLS1wYW5lbCwgdmFyKC0tY2FyZC1iZywgdHJhbnNwYXJlbnQpKTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWJvcmRlciwjMWYyOTM3KTtib3JkZXItcmFkaXVzOjEycHg7cGFkZGluZzoxMnB4O2Rpc3BsYXk6bm9uZX0KICAgIC5nYXYtZXhwbGFpbiBoNHttYXJnaW46MCAwIDhweCAwO2ZvbnQtc2l6ZTouOTVyZW19CiAgICAuZ2F2LWV4cGxhaW4gdWx7bWFyZ2luOjAgMCA4cHggMTZweDtwYWRkaW5nOjB9CiAgICAuZ2F2LWV4cGxhaW4gbGl7bWFyZ2luOjRweCAwfQoKICAgIC8qIFRhYmxlICJRdWkgcGFpZSBxdW9pID8iICovCiAgICAuZ2F2LXRhYmxle2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MmZyIDFmciAxZnIgMWZyO2dhcDo2cHg7Zm9udC1zaXplOi44NXJlbTthbGlnbi1pdGVtczpjZW50ZXJ9CiAgICAuZ2F2LXRhYmxlIC50aHtmb250LXdlaWdodDo4MDB9CiAgICAuZ2F2LXRhYmxlIGRpdntwYWRkaW5nOjZweCA4cHg7YmFja2dyb3VuZDp2YXIoLS1iZywjMGIxMjIwKTtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWJvcmRlciwjMWYyOTM3KTtib3JkZXItcmFkaXVzOjhweDtjb2xvcjp2YXIoLS10ZXh0LCNlNWU3ZWIpfQogICAgLmdhdi10YWJsZSAubXV0ZWR7Y29sb3I6dmFyKC0tbXV0ZWQsIzk0YTNiOCk7Zm9udC13ZWlnaHQ6NjAwfQogICAgLmdhdi1sZWdlbmR7Zm9udC1zaXplOi43NXJlbTtjb2xvcjp2YXIoLS1tdXRlZCwjOTRhM2I4KTttYXJnaW4tdG9wOjZweH0KCiAgICAvKiBFbXB0eSAqLwogICAgLmdhdi1lbXB0eXtwYWRkaW5nOjI4cHg7YmFja2dyb3VuZDp0cmFuc3BhcmVudDtib3JkZXI6MXB4IGRhc2hlZCB2YXIoLS1ib3JkZXIsIzFmMjkzNyk7Ym9yZGVyLXJhZGl1czoxNnB4O3RleHQtYWxpZ246Y2VudGVyO2NvbG9yOnZhcigtLW11dGVkLCM5NGEzYjgpfQoKICAgIC8qIENvcHkgZmFsbGJhY2sgKi8KICAgIC5nYXYtY29weXBhbmVse21hcmdpbi10b3A6MTBweDtiYWNrZ3JvdW5kOnZhcigtLXBhbmVsLCB2YXIoLS1jYXJkLWJnLCB0cmFuc3BhcmVudCkpO2JvcmRlcjoxcHggc29saWQgdmFyKC0tYm9yZGVyLCMxZjI5MzcpO2JvcmRlci1yYWRpdXM6MTJweDtwYWRkaW5nOjEycHg7ZGlzcGxheTpub25lfQogICAgLmdhdi1jb3B5cGFuZWwgaDR7bWFyZ2luOjAgMCA4cHggMDtmb250LXNpemU6Ljk1cmVtfQogICAgLmdhdi1jb3B5dGV4dGFyZWF7d2lkdGg6MTAwJTttaW4taGVpZ2h0OjgwcHg7Ym9yZGVyOjFweCBkYXNoZWQgdmFyKC0tYm9yZGVyLCMxZjI5MzcpO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6OHB4O2ZvbnQtZmFtaWx5OnVpLW1vbm9zcGFjZSwgU0ZNb25vLVJlZ3VsYXIsIE1lbmxvLCBNb25hY28sIENvbnNvbGFzLCAiTGliZXJhdGlvbiBNb25vIiwgIkNvdXJpZXIgTmV3IiwgbW9ub3NwYWNlO2JhY2tncm91bmQ6dmFyKC0tYmcsIzBiMTIyMCk7Y29sb3I6dmFyKC0tdGV4dCwjZTVlN2ViKX0KICAgIC5nYXYtY29weWFjdGlvbnN7ZGlzcGxheTpmbGV4O2dhcDo4cHg7bWFyZ2luLXRvcDo4cHg7ZmxleC13cmFwOndyYXB9CgogICAgLyogVG9hc3QgKi8KICAgIC5nYXYtdG9hc3R7cG9zaXRpb246Zml4ZWQ7cmlnaHQ6MTJweDtib3R0b206MTJweDtiYWNrZ3JvdW5kOnZhcigtLWFjY2VudDIsIzNiODJmNik7Y29sb3I6I2ZmZjtwYWRkaW5nOjEwcHggMTJweDtib3JkZXItcmFkaXVzOjEycHg7Zm9udC13ZWlnaHQ6ODAwO2JveC1zaGFkb3c6MCAxMHB4IDMwcHggcmdiYSgyLDYsMjMsLjIpO3otaW5kZXg6OTk5OX0KICA8L3N0eWxlPgoKICA8ZGl2IGNsYXNzPSJnYXYtY29udGFpbmVyIj4KICAgIDxkaXYgY2xhc3M9Imdhdi1oZWFkZXIiPgogICAgICA8ZGl2IGNsYXNzPSJnYXYtdGl0bGUiIGlkPSJ0aXRyZS1wcmlzZS1nYXYiPjxzcGFuIGNsYXNzPSJlbW9qaSI+8J+boe+4jzwvc3Bhbj5QcmlzZSBlbiA8c3BhbiBjbGFzcz0iZ2F2LXBpbGwiPkdBVjwvc3Bhbj48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iZ2F2LWNvbnRyb2xzIj4KICAgICAgICA8c2VsZWN0IGlkPSJnYXYtcHJvZHVpdCIgY2xhc3M9Imdhdi1zZWxlY3QiIGFyaWEtbGFiZWw9IlByb2R1aXQiPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iR0FWIiBzZWxlY3RlZD5Qcm9kdWl0IDogR0FWPC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJPQlNFUVVFUyI+T2Jzw6hxdWVzIChiaWVudMO0dCk8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkRFQ0VTIj5DYXBpdGFsIETDqWPDqHMgKGJpZW50w7R0KTwvb3B0aW9uPgogICAgICAgIDwvc2VsZWN0PgogICAgICAgIDxzZWxlY3QgaWQ9Imdhdi1jaWJsZSIgY2xhc3M9Imdhdi1zZWxlY3QiIGFyaWEtbGFiZWw9IkNpYmxlIj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlRPVVMiIHNlbGVjdGVkPvCfjq8gQ2libGUgOiBUb3V0ZXM8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkZhbWlsbGUiPkZhbWlsbGU8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlNlbmlvciI+U2VuaW9yPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgPHNlbGVjdCBpZD0iZ2F2LXR5cGUiIGNsYXNzPSJnYXYtc2VsZWN0IiBhcmlhLWxhYmVsPSJUeXBlIGQnYWNjaWRlbnQiPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iVE9VUyIgc2VsZWN0ZWQ+8J+Pt++4jyBUeXBlIDogVG91czwvb3B0aW9uPgogICAgICAgIDwvc2VsZWN0PgogICAgICAgIDxpbnB1dCBpZD0iZ2F2LXNlYXJjaCIgY2xhc3M9Imdhdi1pbnB1dCIgcGxhY2Vob2xkZXI9IvCflI4gUmVjaGVyY2hlciAobW90cy1jbMOpcynigKYiLz4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGlkPSJnYXYtZ3JpZCIgY2xhc3M9Imdhdi1ncmlkIiByb2xlPSJsaXN0Ij48L2Rpdj4KICAgIDxkaXYgaWQ9Imdhdi1kZWJ1ZyIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjEwcHg7cGFkZGluZzoxMHB4O2JvcmRlci1yYWRpdXM6MTJweDtiYWNrZ3JvdW5kOiNmZmY3ZWQ7Ym9yZGVyOjFweCBzb2xpZCAjZmVkN2FhO2NvbG9yOiM5YTM0MTI7Zm9udC1zaXplOjEycHg7d2hpdGUtc3BhY2U6cHJlLXdyYXA7Zm9udC1mYW1pbHk6dWktbW9ub3NwYWNlLCBTRk1vbm8tUmVndWxhciwgTWVubG8sIE1vbmFjbywgQ29uc29sYXMsICdMaWJlcmF0aW9uIE1vbm8nLCAnQ291cmllciBOZXcnLCBtb25vc3BhY2UiPjwvZGl2PgogICAgPGRpdiBpZD0iZ2F2LWVtcHR5IiBjbGFzcz0iZ2F2LWVtcHR5IiBzdHlsZT0iZGlzcGxheTpub25lIj5BdWN1biBjYXMgbmUgY29ycmVzcG9uZCDDoCB2b3MgZmlsdHJlcy48L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJnYXYtZm9vdCIgc3R5bGU9Im1hcmdpbi10b3A6MTJweDtjb2xvcjp2YXIoLS1tdXRlZCwjOTRhM2I4KTtmb250LXNpemU6Ljg1cmVtIj4KICAgICAgPGRpdj7wn5KhIEFzdHVjZSBSRFYgOiB1dGlsaXNleiDCqyBDb3BpZXIgbOKAmWFyZ3VtZW50YWlyZSDCuyBwb3VyIGNvbGxlciB1bmUgcHVuY2hsaW5lIGFkYXB0w6llIGF1IHByb2ZpbC48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iZ2F2LXNlcCIgc3R5bGU9ImhlaWdodDo4cHgiPjwvZGl2PgogICAgICA8ZGl2PkJhcsOobWVzIGlzc3VzIGRlIHZvcyBDRyBHQVYgKEFJUFAg4omlIDUgJSwgdmFsZXVyIGR1IHBvaW50LCArNTAgJSBzaSB0aWVyY2UgcGVyc29ubmUsIGFiYXR0ZW1lbnQgPiA3MCBhbnMsIHNvdWZmcmFuY2VzL2VzdGjDqXRpcXVlIDAsNeKGkjcsIGhvc3BpIDUwIOKCrC9qb3VyLCBldGMuKS4gTW9udGFudHMgaWxsdXN0cmF0aWZzIG1haXMgY29ow6lyZW50cy4gQWRhcHRleiBzZWxvbiBleHBlcnRpc2VzLjwvZGl2PgogICAgPC9kaXY+CiAgPC9kaXY+CgogIDxzY3JpcHQ+CiAgKGZ1bmN0aW9uKCl7CiAgICAndXNlIHN0cmljdCc7CiAgICBmdW5jdGlvbiBkYmdFbCgpeyByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhdi1kZWJ1ZycpOyB9CiAgICBmdW5jdGlvbiBkYmcobSl7IHRyeXsgdmFyIGVsPWRiZ0VsKCk7IGlmKCFlbCkgcmV0dXJuOyBlbC5zdHlsZS5kaXNwbGF5PSdibG9jayc7IHZhciB0PW5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCdmci1GUicpOyBlbC50ZXh0Q29udGVudCArPSAnXG5bJyt0KyddICcrbTsgfWNhdGNoKGUpe30gfQogICAgZGJnKCdJbml0IG1vZHVsZSBQcmlzZUdBVuKApicpOwoKICAgIC8vIC0tLSBBdXRvLXNraW4gcG91ciBzJ2ludMOpZ3JlciBhdSB0aMOobWUgaMO0dGUgKGTDqXRlY3RlIGZvbmQgY2xhaXIvc29tYnJlKQogICAgdmFyIFJPT1QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLXByaXNlLWdhdicpOwogICAgZnVuY3Rpb24gcGFyc2VSR0Ioc3RyKXsgdHJ5eyB2YXIgaW5zaWRlPShzdHJ8fCcnKS5zcGxpdCgnKCcpWzFdOyBpZighaW5zaWRlKSByZXR1cm4gWzE1LDIzLDQyXTsgaW5zaWRlPWluc2lkZS5zcGxpdCgnKScpWzBdOyB2YXIgcD1pbnNpZGUuc3BsaXQoJywnKTsgcmV0dXJuIFtwYXJzZUludChwWzBdLDEwKXx8MTUsIHBhcnNlSW50KHBbMV0sMTApfHwyMywgcGFyc2VJbnQocFsyXSwxMCl8fDQyXTsgfWNhdGNoKGUpeyByZXR1cm4gWzE1LDIzLDQyXTsgfSB9CiAgICBmdW5jdGlvbiBsdW1pbmFuY2UocixnLGIpeyByLz0yNTU7IGcvPTI1NTsgYi89MjU1OyB2YXIgYT1bcixnLGJdLm1hcChmdW5jdGlvbih2KXsgcmV0dXJuIHY8PTAuMDM5Mjg/IHYvMTIuOTIgOiBNYXRoLnBvdygodiswLjA1NSkvMS4wNTUsMi40KTsgfSk7IHJldHVybiAwLjIxMjYqYVswXSswLjcxNTIqYVsxXSswLjA3MjIqYVsyXTsgfQogICAgZnVuY3Rpb24gYXBwbHlBdXRvU2tpbigpewogICAgICB0cnl7CiAgICAgICAgaWYoIVJPT1QpIHJldHVybjsKICAgICAgICAvLyAxKSBTaSBsJ2jDtHRlIGZvdXJuaXQgZGVzIHRva2Vucywgb24gZW4gaMOpcml0ZSBldCBvbiBuZSBmb3JjZSByaWVuCiAgICAgICAgdmFyIGNzUm9vdCA9IGdldENvbXB1dGVkU3R5bGUoUk9PVCk7CiAgICAgICAgdmFyIGhhc0hvc3RUb2tlbnMgPSBbJy0tdGV4dCcsJy0tbXV0ZWQnLCctLXBhbmVsJywnLS1ib3JkZXInXS5zb21lKGZ1bmN0aW9uKHQpewogICAgICAgICAgcmV0dXJuIChjc1Jvb3QuZ2V0UHJvcGVydHlWYWx1ZSh0KXx8JycpLnRyaW0oKTsKICAgICAgICB9KTsKICAgICAgICBpZihoYXNIb3N0VG9rZW5zICYmICFST09ULmdldEF0dHJpYnV0ZSgnZGF0YS1mb3JjZS1za2luJykpewogICAgICAgICAgUk9PVC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2tpbicsJ2hvc3QnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIDIpIFBhbGV0dGVzIGRlIHNlY291cnMgY2xhaXIvc29tYnJlCiAgICAgICAgdmFyIGxpZ2h0ID0geyctLXRleHQnOicjMGYxNzJhJywnLS1tdXRlZCc6JyM0NzU1NjknLCctLWJnJzondHJhbnNwYXJlbnQnLCctLXBhbmVsJzondmFyKC0tY2FyZC1iZywgdHJhbnNwYXJlbnQpJywnLS1ib3JkZXInOidyZ2JhKDE1LDIzLDQyLDAuMDgpJywnLS1hY2NlbnQnOicjMjJjNTVlJywnLS1hY2NlbnQyJzonIzI1NjNlYicsJy0tYmFyTGVmdCc6JyNlMmU4ZjAnfTsKICAgICAgICB2YXIgZGFyayAgPSB7Jy0tdGV4dCc6JyNlNWU3ZWInLCctLW11dGVkJzonIzk0YTNiOCcsJy0tYmcnOid0cmFuc3BhcmVudCcsJy0tcGFuZWwnOid2YXIoLS1jYXJkLWJnLCByZ2JhKDE1LDIzLDQyLC45KSknLCctLWJvcmRlcic6JyMxZjI5MzcnLCctLWFjY2VudCc6JyMyMmM1NWUnLCctLWFjY2VudDInOicjM2I4MmY2JywnLS1iYXJMZWZ0JzonIzMzNDE1NSd9OwoKICAgICAgICB2YXIgZm9yY2VkID0gUk9PVC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZm9yY2Utc2tpbicpOwogICAgICAgIGlmKGZvcmNlZD09PSdsaWdodCcgfHwgZm9yY2VkPT09J2RhcmsnKXsKICAgICAgICAgIHZhciBwZiA9IGZvcmNlZD09PSdsaWdodCc/IGxpZ2h0IDogZGFyazsKICAgICAgICAgIGZvcih2YXIgZmsgaW4gcGYpeyBST09ULnN0eWxlLnNldFByb3BlcnR5KGZrLCBwZltma10pOyB9CiAgICAgICAgICBST09ULnNldEF0dHJpYnV0ZSgnZGF0YS1za2luJywgZm9yY2VkKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIDMpIETDqXRlY3Rpb24gYXV0byBzdXIgPGJvZHk+CiAgICAgICAgdmFyIGNzQm9keSA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuYm9keSk7CiAgICAgICAgdmFyIGJnID0gY3NCb2R5LmJhY2tncm91bmRDb2xvcnx8Jyc7CiAgICAgICAgdmFyIHRleHRDb2wgPSBjc0JvZHkuY29sb3J8fCcnOwogICAgICAgIGZ1bmN0aW9uIF9wYXJzZVJHQihzdHIpeyB0cnl7IHZhciBpbnNpZGU9KHN0cnx8JycpLnNwbGl0KCcoJylbMV07IGlmKCFpbnNpZGUpIHJldHVybiBbMTUsMjMsNDJdOyBpbnNpZGU9aW5zaWRlLnNwbGl0KCcpJylbMF07IHZhciBwPWluc2lkZS5zcGxpdCgnLCcpOyByZXR1cm4gW3BhcnNlSW50KHBbMF0sMTApfHwxNSwgcGFyc2VJbnQocFsxXSwxMCl8fDIzLCBwYXJzZUludChwWzJdLDEwKXx8NDJdOyB9Y2F0Y2goZSl7IHJldHVybiBbMTUsMjMsNDJdOyB9IH0KICAgICAgICBmdW5jdGlvbiBfbHVtKHIsZyxiKXsgci89MjU1OyBnLz0yNTU7IGIvPTI1NTsgdmFyIGE9W3IsZyxiXS5tYXAoZnVuY3Rpb24odil7IHJldHVybiB2PD0wLjAzOTI4PyB2LzEyLjkyIDogTWF0aC5wb3coKHYrMC4wNTUpLzEuMDU1LDIuNCk7IH0pOyByZXR1cm4gMC4yMTI2KmFbMF0rMC43MTUyKmFbMV0rMC4wNzIyKmFbMl07IH0KICAgICAgICB2YXIgcmdiPV9wYXJzZVJHQihiZyk7IHZhciBMPV9sdW0ocmdiWzBdLHJnYlsxXSxyZ2JbMl0pOwogICAgICAgIHZhciBwYWwgPSAoTD4wLjYpPyBsaWdodCA6IGRhcms7CiAgICAgICAgdmFyIGJnU3RyPShiZysnJykudG9Mb3dlckNhc2UoKTsKICAgICAgICB2YXIgaXNUcmFucyA9IGJnU3RyLmluZGV4T2YoJ3RyYW5zcGFyZW50Jyk+LTEgfHwgKGJnU3RyLmluZGV4T2YoJ3JnYmEnKT4tMSAmJiBiZ1N0ci50cmltKCkuZW5kc1dpdGgoJywgMCknKSk7CiAgICAgICAgaWYoaXNUcmFucyB8fCAhYmcpeyB2YXIgdHI9X3BhcnNlUkdCKHRleHRDb2wpOyB2YXIgTHQ9X2x1bSh0clswXSx0clsxXSx0clsyXSk7IHBhbCA9IChMdDwwLjUpPyBsaWdodCA6IGRhcms7IH0KCiAgICAgICAgZm9yKHZhciBrIGluIHBhbCl7IFJPT1Quc3R5bGUuc2V0UHJvcGVydHkoaywgcGFsW2tdKTsgfQogICAgICAgIFJPT1Quc2V0QXR0cmlidXRlKCdkYXRhLXNraW4nLCBwYWw9PT1saWdodD8nbGlnaHQnOidkYXJrJyk7CiAgICAgIH1jYXRjaChlKXt9CiAgICB9CiAgICBhcHBseUF1dG9Ta2luKCk7CiAgICB0cnl7IHZhciBtcWw9d2luZG93Lm1hdGNoTWVkaWEmJndpbmRvdy5tYXRjaE1lZGlhKCcocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspJyk7IGlmKG1xbCYmbXFsLmFkZEV2ZW50TGlzdGVuZXIpeyBtcWwuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKXsgYXBwbHlBdXRvU2tpbigpOyB9KTsgfSB9Y2F0Y2goZSl7fQogICAgdHJ5eyB2YXIgbW89bmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24oKXsgYXBwbHlBdXRvU2tpbigpOyB9KTsgbW8ub2JzZXJ2ZShkb2N1bWVudC5ib2R5LHthdHRyaWJ1dGVzOnRydWUsYXR0cmlidXRlRmlsdGVyOlsnY2xhc3MnLCdzdHlsZSddfSk7IH1jYXRjaChlKXt9CgogICAgZnVuY3Rpb24gZXVybyhuKXsgcmV0dXJuIE51bWJlcihufHwwKS50b0xvY2FsZVN0cmluZygnZnItRlInLHtzdHlsZTonY3VycmVuY3knLGN1cnJlbmN5OidFVVInfSk7IH0KCiAgICAvLyAtLS0gRG9ubsOpZXMgZGVzIDEwIGNhcyAoRmFtaWxsZSB4NSwgU2VuaW9yIHg1KSAtLS0KICAgIHZhciBDQVNFUyA9IFsKICAgICAge2lkOidGMScsIGNpYmxlOidGYW1pbGxlJywgdGl0cmU6J0VuZmFudCDigJMgYnLDu2x1cmUgZWF1IGJvdWlsbGFudGUnLCBlbW9qaTon8J+UpScsIHR5cGU6WydCcsO7bHVyZScsJ0VuZmFudCddLCByZXN1bWU6J0Jyw7tsdXJlcyAyZSBkZWdyw6kgcHJvZm9uZCwgZ3JlZmZlLCBjaWNhdHJpY2VzLicsIHNhbnM6e3Jlc3RlTWVkaWNhbDowLCBwZXJ0ZXNSZXZlbnVzOjAsIGFubmV4ZXM6NTAwfSwgZ2F2OntpcDp7dGF1eDo4LCBtb250YW50OjI5NDQwfSwgc291ZmY6NjUwMCwgZXN0aDo2NTAwLCBob3NwaUo6MTQsIGhvc3BpOjcwMCwgcGVydGVzUmV2ZW51czowLCBwcm90aGVzZTowLCBsb2dlbWVudDowLCBmYXV0ZXVpbDowLCBhdXRyZXM6MH0sIHRhZ3M6WydIw7RwaXRhbCAxNCBqJywnQ2ljYXRyaWNlcyBpbXBvcnRhbnRlcyddfSwKICAgICAge2lkOidGMicsIGNpYmxlOidGYW1pbGxlJywgdGl0cmU6J1BhcmVudCDigJMgY2h1dGUgZOKAmcOpY2hlbGxlIChicmljb2xhZ2UpJywgZW1vamk6J/CfqpwnLCB0eXBlOlsnQ2h1dGUnLCdBZHVsdGUnXSwgcmVzdW1lOidGcmFjdHVyZSBsb21iYWlyZSArIGphbWJlLCBzw6lxdWVsbGVzIGRvcywgYXJyw6p0IDYgbW9pcy4nLCBzYW5zOntyZXN0ZU1lZGljYWw6MCwgcGVydGVzUmV2ZW51czo0MDAwLCBhbm5leGVzOjB9LCBnYXY6e2lwOnt0YXV4OjIwLCBtb250YW50OjczNjAwfSwgc291ZmY6NjUwMCwgZXN0aDowLCBob3NwaUo6MTAsIGhvc3BpOjUwMCwgcGVydGVzUmV2ZW51czo0MDAwLCBwcm90aGVzZTowLCBsb2dlbWVudDowLCBmYXV0ZXVpbDowLCBhdXRyZXM6MH0sIHRhZ3M6WydSw6nDqWR1YycsJ0FycsOqdCA2IG1vaXMnXX0sCiAgICAgIHtpZDonRjMnLCBjaWJsZTonRmFtaWxsZScsIHRpdHJlOidBZG8g4oCTIHJ1cHR1cmUgTENBIChzcG9ydCDDoCByaXNxdWUpJywgZW1vamk6J/CfpYonLCB0eXBlOlsnU3BvcnQnLCdBZG8nXSwgcmVzdW1lOidDaGlydXJnaWUgKyByw6nDqWR1YzsgYW5uw6llIHNjb2xhaXJlIHBlcmR1ZS4nLCBzYW5zOntyZXN0ZU1lZGljYWw6MCwgcGVydGVzUmV2ZW51czowLCBhbm5leGVzOjkyMH0sIGdhdjp7aXA6e3RhdXg6OCwgbW9udGFudDoyOTQ0MH0sIHNvdWZmOjQwMDAsIGVzdGg6MCwgaG9zcGlKOjQsIGhvc3BpOjIwMCwgcGVydGVzUmV2ZW51czowLCBwcm90aGVzZTowLCBsb2dlbWVudDowLCBmYXV0ZXVpbDowLCBhdXRyZXM6OTIwfSwgdGFnczpbJ1BlcnRlIGFubsOpZSBzY29sYWlyZScsJ0hvc3BpIDQgaiddfSwKICAgICAge2lkOidGNCcsIGNpYmxlOidGYW1pbGxlJywgdGl0cmU6J1Ryb3R0aW5ldHRlIMOpbGVjdHJpcXVlIOKAkyA0IGluY2lzaXZlcyBjYXNzw6llcycsIGVtb2ppOifwn5u0JywgdHlwZTpbJ0VEUCcsJ0RlbnRhaXJlJ10sIHJlc3VtZTonQ291cm9ubmVzIGRlbnRhaXJlcyBjb8O7dGV1c2VzLicsIHNhbnM6e3Jlc3RlTWVkaWNhbDowLCBwZXJ0ZXNSZXZlbnVzOjAsIGFubmV4ZXM6MTk3MH0sIGdhdjp7aXA6e3RhdXg6NiwgbW9udGFudDoyMjA4MH0sIHNvdWZmOjIwMDAsIGVzdGg6MCwgaG9zcGlKOjAsIGhvc3BpOjAsIHBlcnRlc1JldmVudXM6MCwgcHJvdGhlc2U6MTk3MCwgbG9nZW1lbnQ6MCwgZmF1dGV1aWw6MCwgYXV0cmVzOjB9LCB0YWdzOlsnUHJvdGjDqHNlIGRlbnRhaXJlJywnRURQIG1vdG9yaXPDqSddfSwKICAgICAge2lkOidGNScsIGNpYmxlOidGYW1pbGxlJywgdGl0cmU6J1BhcmVudCDigJMgc2VjdGlvbiB0ZW5kb24gKGN1aXNpbmUpJywgZW1vamk6J/CflKonLCB0eXBlOlsnQ291cHVyZScsJ0FkdWx0ZSddLCByZXN1bWU6J0NoaXJ1cmdpZSBtYWluLCBwZXJ0ZSBkZSBmb3JjZSwgYXJyw6p0IDIgbW9pcy4nLCBzYW5zOntyZXN0ZU1lZGljYWw6MCwgcGVydGVzUmV2ZW51czoxNTAwLCBhbm5leGVzOjB9LCBnYXY6e2lwOnt0YXV4OjcsIG1vbnRhbnQ6MjU3NjB9LCBzb3VmZjo1MDAwLCBlc3RoOjAsIGhvc3BpSjozLCBob3NwaToxNTAsIHBlcnRlc1JldmVudXM6MTUwMCwgcHJvdGhlc2U6MCwgbG9nZW1lbnQ6MCwgZmF1dGV1aWw6MCwgYXV0cmVzOjB9LCB0YWdzOlsnTWFpbiBkb21pbmFudGUnLCdSw6nDqWR1YyddfSwKICAgICAge2lkOidTMScsIGNpYmxlOidTZW5pb3InLCB0aXRyZTonNzUgYW5zIOKAkyBmcmFjdHVyZSBjb2wgZsOpbXVyJywgZW1vamk6J/CfprQnLCB0eXBlOlsnQ2h1dGUnLCdIYW5jaGUnXSwgcmVzdW1lOidQcm90aMOoc2UsIGJvaXRlcmllLCBhZGFwdGF0aW9uIGRvdWNoZS4nLCBzYW5zOntyZXN0ZU1lZGljYWw6MCwgcGVydGVzUmV2ZW51czowLCBhbm5leGVzOjE1MDB9LCBnYXY6e2lwOnt0YXV4OjEwLCBtb250YW50OjI3NjAwfSwgc291ZmY6NDAwMCwgZXN0aDoxMDAwLCBob3NwaUo6MjEsIGhvc3BpOjEwNTAsIHBlcnRlc1JldmVudXM6MCwgcHJvdGhlc2U6MCwgbG9nZW1lbnQ6NTAwLCBmYXV0ZXVpbDowLCBhdXRyZXM6MH0sIHRhZ3M6WydSw6nDqWR1YycsJ0Ftw6luYWdlbWVudCBsb2d0J119LAogICAgICB7aWQ6J1MyJywgY2libGU6J1NlbmlvcicsIHRpdHJlOic3MiBhbnMg4oCTIHBvbHl0cmF1bWEgKyBhaWRlIGh1bWFpbmUnLCBlbW9qaTon4pm/JywgdHlwZTpbJ0NodXRlJywnUG9seXRyYXVtYSddLCByZXN1bWU6J1BhcmFwbMOpZ2llIGluY29tcGzDqHRlLCBmYXV0ZXVpbCwgZ3JvcyB0cmF2YXV4LicsIHNhbnM6e3Jlc3RlTWVkaWNhbDowLCBwZXJ0ZXNSZXZlbnVzOjAsIGFubmV4ZXM6MzUwMDB9LCBnYXY6e2lwOnt0YXV4OjcwLCBtb250YW50OjYzNzg3NSwgYm9udXM6J3RpZXJjZSBwZXJzb25uZSArNTAlJ30sIHNvdWZmOjMxMDAwLCBlc3RoOjAsIGhvc3BpSjozNSwgaG9zcGk6MTUwMCwgcGVydGVzUmV2ZW51czowLCBwcm90aGVzZTo1MDAwLCBsb2dlbWVudDozMDAwMCwgZmF1dGV1aWw6MCwgYXV0cmVzOjB9LCB0YWdzOlsnVGllcmNlIHBlcnNvbm5lJywnR3JvcyB0cmF2YXV4JywnUGxhZm9uZHMgw6lsZXbDqXMnXX0sCiAgICAgIHtpZDonUzMnLCBjaWJsZTonU2VuaW9yJywgdGl0cmU6JzcwIGFucyDigJMgZnJhY3R1cmUgaHVtw6lydXMnLCBlbW9qaTon8J+SqicsIHR5cGU6WydDaHV0ZScsJ0JyYXMnXSwgcmVzdW1lOidDaGlydXJnaWUsIG1vYmlsaXTDqSByw6lkdWl0ZS4nLCBzYW5zOntyZXN0ZU1lZGljYWw6MCwgcGVydGVzUmV2ZW51czowLCBhbm5leGVzOjB9LCBnYXY6e2lwOnt0YXV4OjgsIG1vbnRhbnQ6Mjk0NDB9LCBzb3VmZjo0MDAwLCBlc3RoOjAsIGhvc3BpSjo1LCBob3NwaToyNTAsIHBlcnRlc1JldmVudXM6MCwgcHJvdGhlc2U6MCwgbG9nZW1lbnQ6MCwgZmF1dGV1aWw6MCwgYXV0cmVzOjB9LCB0YWdzOlsnSG9zcGkgNSBqJ119LAogICAgICB7aWQ6J1M0JywgY2libGU6J1NlbmlvcicsIHRpdHJlOic4MCBhbnMg4oCTIGNodXRlLCDDqWRlbnRhdGlvbiAocHJvdGjDqHNlKScsIGVtb2ppOifwn6a3JywgdHlwZTpbJ0NodXRlJywnRGVudGFpcmUnXSwgcmVzdW1lOidQcm90aMOoc2VzIGRlbnRhaXJlcyBvbsOpcmV1c2VzLicsIHNhbnM6e3Jlc3RlTWVkaWNhbDowLCBwZXJ0ZXNSZXZlbnVzOjAsIGFubmV4ZXM6MTUwMH0sIGdhdjp7aXA6e3RhdXg6NSwgbW9udGFudDo5MjAwfSwgc291ZmY6MjAwMCwgZXN0aDowLCBob3NwaUo6MCwgaG9zcGk6MCwgcGVydGVzUmV2ZW51czowLCBwcm90aGVzZToxNTAwLCBsb2dlbWVudDowLCBmYXV0ZXVpbDowLCBhdXRyZXM6MH0sIHRhZ3M6WydQcm90aMOoc2UgZGVudGFpcmUnXX0sCiAgICAgIHtpZDonUzUnLCBjaWJsZTonU2VuaW9yJywgdGl0cmU6JzY4IGFucyDigJMgYWdyZXNzaW9uLCBmcmFjdHVyZSBvcmJpdGFpcmUnLCBlbW9qaTon8J+aqCcsIHR5cGU6WydBZ3Jlc3Npb24nLCdWaXNhZ2UnXSwgcmVzdW1lOidDaWNhdHJpY2UgZmFjaWFsZSwgc8OpcXVlbGxlcyBlc3Row6l0aXF1ZXMuJywgc2Fuczp7cmVzdGVNZWRpY2FsOjAsIHBlcnRlc1JldmVudXM6MCwgYW5uZXhlczowfSwgZ2F2OntpcDp7dGF1eDo2LCBtb250YW50OjIyMDgwfSwgc291ZmY6MTAwMDAsIGVzdGg6MTI1MDAsIGhvc3BpSjo0LCBob3NwaToyMDAsIHBlcnRlc1JldmVudXM6MCwgcHJvdGhlc2U6MCwgbG9nZW1lbnQ6MCwgZmF1dGV1aWw6MCwgYXV0cmVzOjB9LCB0YWdzOlsnUHLDqWp1ZGljZSBlc3Row6l0aXF1ZScsJ0hvc3BpIDQgaiddfQogICAgXTsKCiAgICAvLyAtLS0gU8OpbGVjdGV1cnMgRE9NIC0tLQogICAgdmFyIGVscyA9IHsKICAgICAgZ3JpZDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhdi1ncmlkJyksCiAgICAgIGVtcHR5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2F2LWVtcHR5JyksCiAgICAgIGNpYmxlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2F2LWNpYmxlJyksCiAgICAgIHR5cGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYXYtdHlwZScpLAogICAgICBwcm9kdWl0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2F2LXByb2R1aXQnKSwKICAgICAgc2VhcmNoOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2F2LXNlYXJjaCcpCiAgICB9OwogICAgZGJnKCdSZWZzIERPTSBvazogJytPYmplY3Qua2V5cyhlbHMpLm1hcChmdW5jdGlvbihrKXtyZXR1cm4gaysnOicrKCEhZWxzW2tdKTt9KS5qb2luKCcsICcpKTsKCiAgICB2YXIgcmVxdWlyZWQgPSBbJ2dyaWQnLCdlbXB0eScsJ2NpYmxlJywndHlwZScsJ3Byb2R1aXQnLCdzZWFyY2gnXTsKICAgIGZvcih2YXIgaT0wO2k8cmVxdWlyZWQubGVuZ3RoO2krKyl7IHZhciBrPXJlcXVpcmVkW2ldOyBpZighZWxzW2tdKXsgY29uc29sZS5lcnJvcignW1ByaXNlR0FWXSDDiWzDqW1lbnQgbWFucXVhbnQ6Jywgayk7IGRiZygnw4lsw6ltZW50IG1hbnF1YW50OiAnK2spOyB9IH0KCiAgICBpZihlbHMucHJvZHVpdCl7IGVscy5wcm9kdWl0LnZhbHVlPSdHQVYnOyBkYmcoJ1Byb2R1aXQgZm9yY8OpOiAnK2Vscy5wcm9kdWl0LnZhbHVlKTsgfQogICAgaWYoZWxzLmNpYmxlKSBlbHMuY2libGUudmFsdWU9J1RPVVMnOwogICAgaWYoZWxzLnR5cGUpIGVscy50eXBlLnZhbHVlPSdUT1VTJzsKCiAgICAvLyBSZW1wbGl0IGxlIGZpbHRyZSBUeXBlIGR5bmFtaXF1ZW1lbnQgKHVuaXF1ZSkKICAgIHRyeXsKICAgICAgdmFyIHR5cGVTZXQgPSB7fTsKICAgICAgZm9yKGk9MDtpPENBU0VTLmxlbmd0aDtpKyspeyB2YXIgdGFycj1DQVNFU1tpXS50eXBlfHxbXTsgZm9yKHZhciBqPTA7ajx0YXJyLmxlbmd0aDtqKyspeyB0eXBlU2V0W3RhcnJbal1dID0gdHJ1ZTsgfSB9CiAgICAgIHZhciBBTExfVFlQRVMgPSBPYmplY3Qua2V5cyh0eXBlU2V0KTsKICAgICAgaWYoZWxzLnR5cGUgJiYgZWxzLnR5cGUub3B0aW9ucy5sZW5ndGggPD0gMSl7CiAgICAgICAgZm9yKGk9MDtpPEFMTF9UWVBFUy5sZW5ndGg7aSsrKXsgdmFyIG89ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7IG8udmFsdWU9QUxMX1RZUEVTW2ldOyBvLnRleHRDb250ZW50PUFMTF9UWVBFU1tpXTsgZWxzLnR5cGUuYXBwZW5kQ2hpbGQobyk7IH0KICAgICAgICBkYmcoJ1R5cGVzIGluamVjdMOpczogJytBTExfVFlQRVMuam9pbignLCAnKSk7CiAgICAgIH0KICAgIH1jYXRjaChlKXsgY29uc29sZS53YXJuKCdbUHJpc2VHQVZdIHR5cGUgb3B0aW9ucycsIGUpOyBkYmcoJ1R5cGUgb3B0aW9ucyBlcnJvcjogJysoZSAmJiBlLm1lc3NhZ2U/IGUubWVzc2FnZSA6IGUpKTsgfQoKICAgIGZ1bmN0aW9uIGZpbHRlcmVkKCl7CiAgICAgIHZhciBjaWJsZSA9IChlbHMuY2libGUgJiYgZWxzLmNpYmxlLnZhbHVlKSA/IGVscy5jaWJsZS52YWx1ZSA6ICdUT1VTJzsKICAgICAgdmFyIHR5cGUgPSAoZWxzLnR5cGUgJiYgZWxzLnR5cGUudmFsdWUpID8gZWxzLnR5cGUudmFsdWUgOiAnVE9VUyc7CiAgICAgIHZhciBxID0gKGVscy5zZWFyY2ggJiYgZWxzLnNlYXJjaC52YWx1ZSA/IGVscy5zZWFyY2gudmFsdWUgOiAnJykudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgICAgIHJldHVybiBDQVNFUy5maWx0ZXIoZnVuY3Rpb24oYyl7CiAgICAgICAgaWYoY2libGUhPT0nVE9VUycgJiYgYy5jaWJsZSE9PWNpYmxlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYodHlwZSE9PSdUT1VTJyAmJiAhKGMudHlwZXx8W10pLmluY2x1ZGVzKHR5cGUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYocSl7CiAgICAgICAgICB2YXIgaGF5ID0gW2MuaWQsYy50aXRyZSxjLnJlc3VtZSxjLmNpYmxlXS5jb25jYXQoYy50YWdzfHxbXSkuY29uY2F0KGMudHlwZXx8W10pLmpvaW4oJyAnKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgaWYoaGF5LmluZGV4T2YocSkgPT09IC0xKSByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb21wdXRlQmFycyhjKXsKICAgICAgdmFyIHNhbnNUb3RhbCA9IChjLnNhbnMucmVzdGVNZWRpY2FsfHwwKSsoYy5zYW5zLnBlcnRlc1JldmVudXN8fDApKyhjLnNhbnMuYW5uZXhlc3x8MCk7CiAgICAgIHZhciBnPWMuZ2F2fHx7fTsgdmFyIGdhdlRvdGFsID0gKGcuaXAmJmcuaXAubW9udGFudHx8MCkrKGcuc291ZmZ8fDApKyhnLmVzdGh8fDApKyhnLmhvc3BpfHwwKSsoZy5wZXJ0ZXNSZXZlbnVzfHwwKSsoZy5wcm90aGVzZXx8MCkrKGcubG9nZW1lbnR8fDApKyhnLmZhdXRldWlsfHwwKSsoZy5hdXRyZXN8fDApOwogICAgICB2YXIgbWF4ID0gTWF0aC5tYXgoMSwgc2Fuc1RvdGFsLCBnYXZUb3RhbCk7CiAgICAgIHZhciBsZWZ0VyA9IE1hdGgucm91bmQoKHNhbnNUb3RhbC9tYXgpKjEwMCk7CiAgICAgIHZhciByaWdodFcgPSBNYXRoLnJvdW5kKChnYXZUb3RhbC9tYXgpKjEwMCk7CiAgICAgIHJldHVybiB7c2Fuc1RvdGFsOnNhbnNUb3RhbCwgZ2F2VG90YWw6Z2F2VG90YWwsIGxlZnRXOmxlZnRXLCByaWdodFc6cmlnaHRXfTsKICAgIH0KCiAgICBmdW5jdGlvbiBmbXRCcmVha2Rvd24oZyl7CiAgICAgIHZhciBwYXJ0cz1bXTsKICAgICAgaWYoZy5pcCkgcGFydHMucHVzaCgnSVAgJytnLmlwLnRhdXgrJyU6ICcrZXVybyhnLmlwLm1vbnRhbnQpKyhnLmlwLmJvbnVzPygnICgnK2cuaXAuYm9udXMrJyknKTonJykpOwogICAgICBpZihnLnNvdWZmKSBwYXJ0cy5wdXNoKCdTb3VmZnJhbmNlczogJytldXJvKGcuc291ZmYpKTsKICAgICAgaWYoZy5lc3RoKSBwYXJ0cy5wdXNoKCdFc3Row6l0aXF1ZTogJytldXJvKGcuZXN0aCkpOwogICAgICBpZihnLnBlcnRlc1JldmVudXMpIHBhcnRzLnB1c2goJ1BlcnRlcyBkZSByZXZlbnVzOiAnK2V1cm8oZy5wZXJ0ZXNSZXZlbnVzKSk7CiAgICAgIGlmKGcuaG9zcGkpIHBhcnRzLnB1c2goJ0hvc3BpICgnKyhnLmhvc3BpSnx8Jz8nKSsnIGopOiAnK2V1cm8oZy5ob3NwaSkpOwogICAgICBpZihnLnByb3RoZXNlIHx8IGcuZmF1dGV1aWwpIHBhcnRzLnB1c2goJ1Byb3Row6hzZS9mYXV0ZXVpbDogJytldXJvKChnLnByb3RoZXNlfHwwKSsoZy5mYXV0ZXVpbHx8MCkpKTsKICAgICAgaWYoZy5sb2dlbWVudCkgcGFydHMucHVzaCgnTG9nZW1lbnQgYWRhcHTDqTogJytldXJvKGcubG9nZW1lbnQpKTsKICAgICAgaWYoZy5hdXRyZXMpIHBhcnRzLnB1c2goJ0F1dHJlczogJytldXJvKGcuYXV0cmVzKSk7CiAgICAgIHJldHVybiBwYXJ0cy5qb2luKCcg4oCiICcpOwogICAgfQoKICAgIGZ1bmN0aW9uIHBpdGNoKGMpewogICAgICB2YXIgc3VtcyA9IGNvbXB1dGVCYXJzKGMpOwogICAgICByZXR1cm4gJyInK2MudGl0cmUrJyIgKCcrYy5jaWJsZSsnKSDigJQgU2FucyBHQVY6ICcrZXVybyhzdW1zLnNhbnNUb3RhbCkrJyDDoCBzdXBwb3J0ZXIuIEF2ZWMgR0FWOiBpbmRlbW5pc2F0aW9uIH4gJytldXJvKHN1bXMuZ2F2VG90YWwpKycgKGRvbnQgJytmbXRCcmVha2Rvd24oYy5nYXYpKycpLic7CiAgICB9CgogICAgZnVuY3Rpb24gbWsodGFnLCBjbHMsIHRleHQpeyB2YXIgZWw9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOyBpZihjbHMpIGVsLmNsYXNzTmFtZT1jbHM7IGlmKHRleHQhPW51bGwpIGVsLnRleHRDb250ZW50PXRleHQ7IHJldHVybiBlbDsgfQoKICAgIGZ1bmN0aW9uIGNhcmQoYyl7CiAgICAgIHZhciBzdW1zID0gY29tcHV0ZUJhcnMoYyk7CiAgICAgIHZhciBhcnRpY2xlID0gbWsoJ2FydGljbGUnLCdnYXYtY2FyZCcpOyBhcnRpY2xlLnNldEF0dHJpYnV0ZSgncm9sZScsJ2xpc3RpdGVtJyk7CgogICAgICAvLyBIZWFkCiAgICAgIHZhciBoZWFkID0gbWsoJ2RpdicsJ2dhdi1jYXJkLWhlYWQnKTsKICAgICAgdmFyIGxlZnQgPSBtaygnZGl2JywnJyk7CiAgICAgIHZhciB0aXRsZSA9IG1rKCdkaXYnLCdnYXYtY2FyZC10aXRsZScsIChjLmVtb2ppP2MuZW1vamkrJyAnOicnKStjLnRpdHJlKTsKICAgICAgbGVmdC5hcHBlbmRDaGlsZCh0aXRsZSk7CiAgICAgIHZhciB0YWdzID0gbWsoJ2RpdicsJ2dhdi10YWdzJyk7CiAgICAgIHZhciBjaGlwQ2libGUgPSBtaygnc3BhbicsJ2dhdi1jaGlwJywgYy5jaWJsZSk7IHRhZ3MuYXBwZW5kQ2hpbGQoY2hpcENpYmxlKTsKICAgICAgdmFyIHR5cGVzID0gYy50eXBlfHxbXTsgZm9yKHZhciBpPTA7aTx0eXBlcy5sZW5ndGg7aSsrKXsgdGFncy5hcHBlbmRDaGlsZChtaygnc3BhbicsJ2dhdi1jaGlwJywgdHlwZXNbaV0pKTsgfQogICAgICBsZWZ0LmFwcGVuZENoaWxkKHRhZ3MpOwogICAgICB2YXIgcmlnaHQgPSBtaygnZGl2JywnJyk7IHJpZ2h0LnN0eWxlLnRleHRBbGlnbj0ncmlnaHQnOwogICAgICByaWdodC5hcHBlbmRDaGlsZChtaygnZGl2JywnZ2F2LW1vbmV5JywgZXVybyhzdW1zLmdhdlRvdGFsKSkpOwogICAgICByaWdodC5hcHBlbmRDaGlsZChtaygnZGl2JywnZ2F2LW11dGVkJywnSW5kZW1uaXNhdGlvbiBHQVYgZXN0aW3DqWUnKSk7CiAgICAgIGhlYWQuYXBwZW5kQ2hpbGQobGVmdCk7IGhlYWQuYXBwZW5kQ2hpbGQocmlnaHQpOwogICAgICBhcnRpY2xlLmFwcGVuZENoaWxkKGhlYWQpOwoKICAgICAgLy8gUmVzdW1lCiAgICAgIHZhciByZXN1bWUgPSBtaygnZGl2JywnZ2F2LW11dGVkJywgYy5yZXN1bWUpOyByZXN1bWUuc3R5bGUubWFyZ2luVG9wPSc2cHgnOyBhcnRpY2xlLmFwcGVuZENoaWxkKHJlc3VtZSk7CgogICAgICAvLyBDb21wYXJlIGJhcgogICAgICB2YXIgY29tcGFyZSA9IG1rKCdkaXYnLCdnYXYtY29tcGFyZScpOwogICAgICB2YXIgYmFyID0gbWsoJ2RpdicsJ2dhdi1iYXInKTsKICAgICAgdmFyIGxlZnRCYXIgPSBtaygnZGl2JywnbGVmdCcpOyBsZWZ0QmFyLnN0eWxlLndpZHRoID0gU3RyaW5nKHN1bXMubGVmdFcpKyclJzsKICAgICAgdmFyIHJpZ2h0QmFyID0gbWsoJ2RpdicsJ3JpZ2h0Jyk7IHJpZ2h0QmFyLnN0eWxlLndpZHRoID0gU3RyaW5nKHN1bXMucmlnaHRXKSsnJSc7CiAgICAgIGJhci5hcHBlbmRDaGlsZChsZWZ0QmFyKTsgYmFyLmFwcGVuZENoaWxkKHJpZ2h0QmFyKTsKICAgICAgY29tcGFyZS5hcHBlbmRDaGlsZChiYXIpOwogICAgICB2YXIgZmlncyA9IG1rKCdkaXYnLCdnYXYtZmlndXJlcycpOwogICAgICB2YXIgZjEgPSBtaygnZGl2JyxudWxsLCdTYW5zIEdBViA6ICcpOyB2YXIgc3Ryb25nMSA9IG1rKCdzdHJvbmcnLG51bGwsZXVybyhzdW1zLnNhbnNUb3RhbCkpOyBmMS5hcHBlbmRDaGlsZChzdHJvbmcxKTsKICAgICAgdmFyIGYyID0gbWsoJ2RpdicsbnVsbCwnQXZlYyBHQVYgOiAnKTsgdmFyIHN0cm9uZzIgPSBtaygnc3Ryb25nJyxudWxsLGV1cm8oc3Vtcy5nYXZUb3RhbCkpOyBmMi5hcHBlbmRDaGlsZChzdHJvbmcyKTsKICAgICAgZmlncy5hcHBlbmRDaGlsZChmMSk7IGZpZ3MuYXBwZW5kQ2hpbGQoZjIpOwogICAgICBjb21wYXJlLmFwcGVuZENoaWxkKGZpZ3MpOwogICAgICBhcnRpY2xlLmFwcGVuZENoaWxkKGNvbXBhcmUpOwoKICAgICAgLy8gQWN0aW9ucwogICAgICB2YXIgYWN0aW9ucyA9IG1rKCdkaXYnLCdnYXYtYWN0aW9ucycpOwogICAgICB2YXIgYnRuRGV0ID0gbWsoJ2J1dHRvbicsJ2dhdi1idG4nLCdWb2lyIGxlIGTDqXRhaWwnKTsgYnRuRGV0LnNldEF0dHJpYnV0ZSgnZGF0YS1hY3QnLCdkZXRhaWxzJyk7CiAgICAgIHZhciBidG5Db3B5ID0gbWsoJ2J1dHRvbicsJ2dhdi1idG4gc2VjJywnQ29waWVyIGzigJlhcmd1bWVudGFpcmUnKTsgYnRuQ29weS5zZXRBdHRyaWJ1dGUoJ2RhdGEtYWN0JywnY29weScpOwogICAgICB2YXIgYnRuRXhwID0gbWsoJ2J1dHRvbicsJ2dhdi1idG4gc2VjJywnUGx1cyBk4oCZZXhwbGljYXRpb25zJyk7IGJ0bkV4cC5zZXRBdHRyaWJ1dGUoJ2RhdGEtYWN0JywnZXhwbGFpbicpOyBidG5FeHAuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywnZmFsc2UnKTsKICAgICAgYWN0aW9ucy5hcHBlbmRDaGlsZChidG5EZXQpOyBhY3Rpb25zLmFwcGVuZENoaWxkKGJ0bkNvcHkpOyBhY3Rpb25zLmFwcGVuZENoaWxkKGJ0bkV4cCk7CiAgICAgIGFydGljbGUuYXBwZW5kQ2hpbGQoYWN0aW9ucyk7CgogICAgICAvLyBEZXRhaWxzCiAgICAgIHZhciBkZXRhaWxzID0gbWsoJ2RpdicsJ2dhdi1kZXRhaWxzJyk7CiAgICAgIHZhciBzYW5zTGluZSA9IG1rKCdkaXYnLG51bGwsJycpOwogICAgICB2YXIgc2Fuc0JhZGdlID0gbWsoJ3NwYW4nLCdnYXYtYmFkZ2UnLCfwn6e+IFNhbnMgR0FWJyk7IHNhbnNMaW5lLmFwcGVuZENoaWxkKHNhbnNCYWRnZSk7CiAgICAgIHNhbnNMaW5lLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcgUmVzdGUgbcOpZGljYWwgOiAnKSk7CiAgICAgIHZhciBzMSA9IG1rKCdzdHJvbmcnLG51bGwsZXVybyhjLnNhbnMucmVzdGVNZWRpY2FsfHwwKSk7IHNhbnNMaW5lLmFwcGVuZENoaWxkKHMxKTsKICAgICAgc2Fuc0xpbmUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyDigKIgUGVydGVzIGRlIHJldmVudXMgOiAnKSk7CiAgICAgIHZhciBzMiA9IG1rKCdzdHJvbmcnLG51bGwsZXVybyhjLnNhbnMucGVydGVzUmV2ZW51c3x8MCkpOyBzYW5zTGluZS5hcHBlbmRDaGlsZChzMik7CiAgICAgIHNhbnNMaW5lLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcg4oCiIEFubmV4ZXMgOiAnKSk7CiAgICAgIHZhciBzMyA9IG1rKCdzdHJvbmcnLG51bGwsZXVybyhjLnNhbnMuYW5uZXhlc3x8MCkpOyBzYW5zTGluZS5hcHBlbmRDaGlsZChzMyk7CiAgICAgIHNhbnNMaW5lLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcg4oaSIFRvdGFsOiAnKSk7CiAgICAgIHZhciBzVG90ID0gbWsoJ3N0cm9uZycsbnVsbCxldXJvKHN1bXMuc2Fuc1RvdGFsKSk7IHNhbnNMaW5lLmFwcGVuZENoaWxkKHNUb3QpOwogICAgICBkZXRhaWxzLmFwcGVuZENoaWxkKHNhbnNMaW5lKTsKCiAgICAgIHZhciBnYXZMaW5lID0gbWsoJ2RpdicsbnVsbCwnJyk7CiAgICAgIHZhciBnYXZCYWRnZSA9IG1rKCdzcGFuJywnZ2F2LWJhZGdlJywn8J+StiBBdmVjIEdBVicpOyBnYXZMaW5lLmFwcGVuZENoaWxkKGdhdkJhZGdlKTsKICAgICAgZ2F2TGluZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICcrZm10QnJlYWtkb3duKGMuZ2F2KSsnIOKGkiAnKSk7CiAgICAgIHZhciBnVG90ID0gbWsoJ3N0cm9uZycsbnVsbCxldXJvKHN1bXMuZ2F2VG90YWwpKTsgZ2F2TGluZS5hcHBlbmRDaGlsZChnVG90KTsKICAgICAgZGV0YWlscy5hcHBlbmRDaGlsZChnYXZMaW5lKTsKCiAgICAgIGlmKGMudGFncyAmJiBjLnRhZ3MubGVuZ3RoKXsKICAgICAgICB2YXIgdGFnc1dyYXAgPSBtaygnZGl2JywnZ2F2LXRhZ3MnKTsgdGFnc1dyYXAuc3R5bGUubWFyZ2luVG9wID0gJzhweCc7CiAgICAgICAgZm9yKGk9MDtpPGMudGFncy5sZW5ndGg7aSsrKXsgdGFnc1dyYXAuYXBwZW5kQ2hpbGQobWsoJ3NwYW4nLCdnYXYtY2hpcCcsIGMudGFnc1tpXSkpOyB9CiAgICAgICAgZGV0YWlscy5hcHBlbmRDaGlsZCh0YWdzV3JhcCk7CiAgICAgIH0KCiAgICAgIC8vIEJsb2MgcMOpZGFnb2dpcXVlCiAgICAgIHZhciBleHBsYWluID0gbWsoJ2RpdicsJ2dhdi1leHBsYWluJyk7CiAgICAgIHZhciBoNCA9IG1rKCdoNCcsbnVsbCwnRXhwbGljYXRpb24gZGVzIHByaXNlcyBlbiBjaGFyZ2UnKTsKICAgICAgZXhwbGFpbi5hcHBlbmRDaGlsZChoNCk7CiAgICAgIHZhciB1bCA9IG1rKCd1bCcsbnVsbCwnJyk7CiAgICAgIHZhciBidWxsZXRzID0gWwogICAgICAgICdTw6ljdXJpdMOpIHNvY2lhbGUgKEFNTykgOiByZW1ib3Vyc2Ugc2Vsb24gZGVzIHRhcmlmcyBkZSByZXNwb25zYWJpbGl0w6kgKGV4LiBob3NwaXRhbGlzYXRpb24gODAgJSBkdSB0YXJpZiA7IGxlIGZvcmZhaXQgam91cm5hbGllciBlc3Qgc291dmVudCBwcmlzIGVuIGNoYXJnZSBwYXIgbGEgbXV0dWVsbGUpLicsCiAgICAgICAgJ011dHVlbGxlIMKrIGNsYXNzaXF1ZSDCuyAxMDAgJSBCUiA6IGNvbXBsw6h0ZSBsZSB0aWNrZXQgbW9kw6lyYXRldXIgbWFpcyBuZSBjb3V2cmUgcGFzIGxlcyBkw6lwYXNzZW1lbnRzIGTigJlob25vcmFpcmVzLCBpbXBsYW50cy9jb3Vyb25uZXMgaGF1dCBkZSBnYW1tZSwgYW3DqW5hZ2VtZW50IGR1IGxvZ2VtZW50LCBwZXJ0ZSBkZSByZXZlbnVzLCBuaSBsZXMgcHLDqWp1ZGljZXMgZXh0cmEtcGF0cmltb25pYXV4LicsCiAgICAgICAgJ0xhIEdBViBpbmRlbW5pc2UgbGVzIGNvbnPDqXF1ZW5jZXMgZGUgbOKAmWFjY2lkZW50IDogSW5jYXBhY2l0w6kgUGVybWFuZW50ZSAoQUlQUCkgdmlhIGJhcsOobWUsIHNvdWZmcmFuY2VzIGVuZHVyw6llcywgcHLDqWp1ZGljZSBlc3Row6l0aXF1ZSwgYWlkZSBodW1haW5lLCBhbcOpbmFnZW1lbnRzLCBhcHBhcmVpbGxhZ2VzLCBwZXJ0ZXMgZGUgcmV2ZW51cyByw6lzaWR1ZWxsZXMsIGV0Yy4nCiAgICAgIF07CiAgICAgIGZvcihpPTA7aTxidWxsZXRzLmxlbmd0aDtpKyspeyB2YXIgbGk9bWsoJ2xpJyxudWxsLGJ1bGxldHNbaV0pOyB1bC5hcHBlbmRDaGlsZChsaSk7IH0KICAgICAgZXhwbGFpbi5hcHBlbmRDaGlsZCh1bCk7CgogICAgICB2YXIgaDRiID0gbWsoJ2g0JyxudWxsLCdRdWkgcGFpZSBxdW9pID8nKTsKICAgICAgZXhwbGFpbi5hcHBlbmRDaGlsZChoNGIpOwogICAgICB2YXIgdGJsID0gbWsoJ2RpdicsJ2dhdi10YWJsZScpOwogICAgICB2YXIgaGVhZGVycyA9IFsnUG9zdGUnLCdBTU8nLCdNdXR1ZWxsZScsJ0dBViddOyBmb3IoaT0wO2k8aGVhZGVycy5sZW5ndGg7aSsrKXsgdmFyIGQ9bWsoJ2RpdicsJ3RoJyxoZWFkZXJzW2ldKTsgdGJsLmFwcGVuZENoaWxkKGQpOyB9CiAgICAgIHZhciByb3dzID0gWwogICAgICAgIFsnU29pbnMgLyBob3NwaXRhbGlzYXRpb24nLCfinJMnLCfinJMnLCfiiLwnXSwKICAgICAgICBbJ0TDqXBhc3NlbWVudHMgLyBkZW50YWlyZSBvbsOpcmV1eCcsJ+KclycsJ+KIvCcsJ+KckyddLAogICAgICAgIFsnUGVydGVzIGRlIHJldmVudXMnLCfiiLwnLCfinJcnLCfinJMnXSwKICAgICAgICBbJ0luY2FwYWNpdMOpIFBlcm1hbmVudGUgKEFJUFApJywn4pyXJywn4pyXJywn4pyTJ10sCiAgICAgICAgWydTb3VmZnJhbmNlcyBlbmR1csOpZXMnLCfinJcnLCfinJcnLCfinJMnXSwKICAgICAgICBbJ1Byw6lqdWRpY2UgZXN0aMOpdGlxdWUnLCfinJcnLCfinJcnLCfinJMnXSwKICAgICAgICBbJ0FpZGUgaHVtYWluZSAvIFRpZXJjZSBwZXJzb25uZScsJ+KclycsJ+KclycsJ+KckyddLAogICAgICAgIFsnQW3DqW5hZ2VtZW50IGxvZ2VtZW50L3bDqWhpY3VsZScsJ+KclycsJ+KclycsJ+KckyddLAogICAgICAgIFsnQXBwYXJlaWxzIHNww6ljaWF1eCAvIGZhdXRldWlsJywn4pyXJywn4pyXJywn4pyTJ10KICAgICAgXTsKICAgICAgZm9yKGk9MDtpPHJvd3MubGVuZ3RoO2krKyl7IGZvcih2YXIgaj0wO2o8cm93c1tpXS5sZW5ndGg7aisrKXsgdmFyIGNlbGwgPSBtaygnZGl2Jywgaj09PTA/ICdtdXRlZCcgOiAnJywgcm93c1tpXVtqXSk7IHRibC5hcHBlbmRDaGlsZChjZWxsKTsgfSB9CiAgICAgIGV4cGxhaW4uYXBwZW5kQ2hpbGQodGJsKTsKICAgICAgdmFyIGxlZ2VuZCA9IG1rKCdkaXYnLCdnYXYtbGVnZW5kJywn4pyTIGNvdXZlcnQg4oCiIOKIvCBwYXJ0aWVsL3NlbG9uIGNvbnRyYXQg4oCiIOKclyBub24gY291dmVydCcpOyBleHBsYWluLmFwcGVuZENoaWxkKGxlZ2VuZCk7CgogICAgICB2YXIgaDRjID0gbWsoJ2g0JyxudWxsLCdDb21tZW50IGVzdCBjYWxjdWzDqWUgbOKAmUlQID8nKTsgZXhwbGFpbi5hcHBlbmRDaGlsZChoNGMpOwogICAgICB2YXIgcGNhbGMgPSBtaygnZGl2JywnZ2F2LW11dGVkJywnRXhlbXBsZSBpbmRpY2F0aWYgOiBNb250YW50ID0gVmFsZXVyIGR1IHBvaW50IMOXIHRhdXggQUlQUCAoYWp1c3TDqSBzZWxvbiBs4oCZw6JnZSA7ICsgbWFqb3JhdGlvbiBzaSB0aWVyY2UgcGVyc29ubmUpLiBFeC4gM+KArzY4MCDigqwgLyBwb2ludCA7IGFiYXR0ZW1lbnQgYXUtZGVsw6AgZGUgNzAgYW5zIDsgKzUwICUgc2kgYWlkZSBodW1haW5lIGR1cmFibGUuJyk7IGV4cGxhaW4uYXBwZW5kQ2hpbGQocGNhbGMpOwoKICAgICAgZGV0YWlscy5hcHBlbmRDaGlsZChleHBsYWluKTsKICAgICAgYXJ0aWNsZS5hcHBlbmRDaGlsZChkZXRhaWxzKTsKCiAgICAgIC8vIFBhbm5lYXUgZGUgY29waWUgKGZhbGxiYWNrIHNpIENsaXBib2FyZCBBUEkgYmxvcXXDqWUpCiAgICAgIHZhciBjb3B5UGFuZWwgPSBtaygnZGl2JywnZ2F2LWNvcHlwYW5lbCcpOwogICAgICB2YXIgY2ggPSBtaygnaDQnLG51bGwsJ0FyZ3VtZW50YWlyZSDDoCBjb3BpZXInKTsgY29weVBhbmVsLmFwcGVuZENoaWxkKGNoKTsKICAgICAgdmFyIHRhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTsgdGEuY2xhc3NOYW1lID0gJ2dhdi1jb3B5dGV4dGFyZWEnOyB0YS5zZXRBdHRyaWJ1dGUoJ3JlYWRvbmx5JywncmVhZG9ubHknKTsgY29weVBhbmVsLmFwcGVuZENoaWxkKHRhKTsKICAgICAgdmFyIGNwQWN0ID0gbWsoJ2RpdicsJ2dhdi1jb3B5YWN0aW9ucycpOwogICAgICB2YXIgYlNlbCA9IG1rKCdidXR0b24nLCdnYXYtYnRuIHNlYycsJ1PDqWxlY3Rpb25uZXIgbGUgdGV4dGUnKTsKICAgICAgdmFyIGJDbG9zZSA9IG1rKCdidXR0b24nLCdnYXYtYnRuIHNlYycsJ0Zlcm1lcicpOwogICAgICBjcEFjdC5hcHBlbmRDaGlsZChiU2VsKTsgY3BBY3QuYXBwZW5kQ2hpbGQoYkNsb3NlKTsKICAgICAgY29weVBhbmVsLmFwcGVuZENoaWxkKGNwQWN0KTsKICAgICAgYXJ0aWNsZS5hcHBlbmRDaGlsZChjb3B5UGFuZWwpOwoKICAgICAgYlNlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCl7IHRyeXsgdGEuZm9jdXMoKTsgdGEuc2VsZWN0KCk7IH1jYXRjaChlKXt9IH0pOwogICAgICBiQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpeyBjb3B5UGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfSk7CgogICAgICAvLyBCb3V0b24gZOKAmWV4cGxpY2F0aW9uICh0b2dnbGUpIOKAlCBmb3JjZSBs4oCZb3V2ZXJ0dXJlIGRlcyBkw6l0YWlscyBzaSBuw6ljZXNzYWlyZQogICAgICBidG5FeHAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpewogICAgICAgIGlmKGRldGFpbHMuc3R5bGUuZGlzcGxheSAhPT0gJ2Jsb2NrJyl7IGRldGFpbHMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IH0KICAgICAgICB2YXIgb3BlbiA9IChleHBsYWluLnN0eWxlLmRpc3BsYXkgPT09ICdibG9jaycpOwogICAgICAgIGV4cGxhaW4uc3R5bGUuZGlzcGxheSA9IG9wZW4gPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgIGJ0bkV4cC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBvcGVuID8gJ2ZhbHNlJyA6ICd0cnVlJyk7CiAgICAgICAgaWYoIW9wZW4peyB0cnl7IGV4cGxhaW4uc2Nyb2xsSW50b1ZpZXcoe2JlaGF2aW9yOidzbW9vdGgnLCBibG9jazonbmVhcmVzdCd9KTsgfWNhdGNoKGUpe30gfQogICAgICB9KTsKCiAgICAgIC8vIEV2ZW50cwogICAgICBidG5EZXQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpewogICAgICAgIHZhciBpc09wZW4gPSAoZGV0YWlscy5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snKTsKICAgICAgICBkZXRhaWxzLnN0eWxlLmRpc3BsYXkgPSBpc09wZW4gPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgIGlmKGlzT3Blbil7IGV4cGxhaW4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsgYnRuRXhwLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsJ2ZhbHNlJyk7IH0KICAgICAgfSk7CgogICAgICBidG5Db3B5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKXsKICAgICAgICB2YXIgdGV4dCA9IHBpdGNoKGMpOwogICAgICAgIHZhciBvayA9IGZhbHNlOwogICAgICAgIGlmKHdpbmRvdy5pc1NlY3VyZUNvbnRleHQgJiYgbmF2aWdhdG9yICYmIG5hdmlnYXRvci5jbGlwYm9hcmQgJiYgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQpewogICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQodGV4dCkudGhlbihmdW5jdGlvbigpeyBvayA9IHRydWU7IH0pLmNhdGNoKGZ1bmN0aW9uKCl7fSkuZmluYWxseShmdW5jdGlvbigpewogICAgICAgICAgICBpZihvayl7CiAgICAgICAgICAgICAgdHJ5eyB2YXIgdCA9IG1rKCdkaXYnLCdnYXYtdG9hc3QnLCfinIUgQXJndW1lbnRhaXJlIGNvcGnDqScpOyBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHQpOyBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IHQucmVtb3ZlKCk7IH0sMTIwMCk7fWNhdGNoKGUpe30KICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgdGEudmFsdWUgPSB0ZXh0OyBjb3B5UGFuZWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IHRyeXsgdGEuZm9jdXMoKTsgdGEuc2VsZWN0KCk7IH1jYXRjaChlKXt9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0YS52YWx1ZSA9IHRleHQ7IGNvcHlQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgdHJ5eyB0YS5mb2N1cygpOyB0YS5zZWxlY3QoKTsgfWNhdGNoKGUpe30KICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGFydGljbGU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVuZGVyKCl7CiAgICAgIGlmKGVscy5wcm9kdWl0ICYmIGVscy5wcm9kdWl0LnZhbHVlIT09J0dBVicpeyBlbHMucHJvZHVpdC52YWx1ZT0nR0FWJzsgZGJnKCdQcm9kdWl0IHLDqXRhYmxpIMOgIEdBVicpOyB9CiAgICAgIGlmKCFlbHMuZ3JpZCB8fCAhZWxzLmVtcHR5KXsgZGJnKCdDb250ZW5ldXJzIG1hbnF1YW50cywgYWJvcnQgcmVuZGVyJyk7IHJldHVybjsgfQogICAgICB2YXIgbGlzdCA9IGZpbHRlcmVkKCk7CiAgICAgIGRiZygnUmVuZGVyOiAnK2xpc3QubGVuZ3RoKycgY2FydGUocyknKTsKICAgICAgZWxzLmdyaWQuaW5uZXJIVE1MPScnOwogICAgICBpZighbGlzdC5sZW5ndGgpeyBlbHMuZW1wdHkuc3R5bGUuZGlzcGxheT0nYmxvY2snOyBlbHMuZW1wdHkudGV4dENvbnRlbnQ9J0F1Y3VuIGNhcyBuZSBjb3JyZXNwb25kIMOgIHZvcyBmaWx0cmVzLic7IHJldHVybjsgfQogICAgICBlbHMuZW1wdHkuc3R5bGUuZGlzcGxheT0nbm9uZSc7CiAgICAgIGZvcih2YXIgaT0wO2k8bGlzdC5sZW5ndGg7aSsrKXsgZWxzLmdyaWQuYXBwZW5kQ2hpbGQoY2FyZChsaXN0W2ldKSk7IH0KICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlUmVuZGVyKCl7IHRyeXsgcmVuZGVyKCk7IH0gY2F0Y2goZSl7IGNvbnNvbGUuZXJyb3IoJ1tQcmlzZUdBVl0gRXJyZXVyIGRlIHJlbmR1JywgZSk7IGRiZygnRXJyZXVyIGRlIHJlbmR1OiAnKyhlJiZlLm1lc3NhZ2U/ZS5tZXNzYWdlOmUpKTsgaWYoZWxzLmdyaWQpeyBlbHMuZ3JpZC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0iZ2F2LWVtcHR5Ij5FcnJldXIgZFwnaW5pdGlhbGlzYXRpb24gZHUgbW9kdWxlIDogJysoZSYmZS5tZXNzYWdlP2UubWVzc2FnZTplKSsnPC9kaXY+JzsgfSBpZihlbHMuZW1wdHkpeyBlbHMuZW1wdHkuc3R5bGUuZGlzcGxheT0nbm9uZSc7IH0gfSB9CgogICAgLy8gTGlzdGVuZXJzCiAgICBpZihlbHMuY2libGUpIGVscy5jaWJsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzYWZlUmVuZGVyKTsKICAgIGlmKGVscy50eXBlKSBlbHMudHlwZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzYWZlUmVuZGVyKTsKICAgIGlmKGVscy5wcm9kdWl0KSBlbHMucHJvZHVpdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbigpeyBzYWZlUmVuZGVyKCk7IH0pOwogICAgaWYoZWxzLnNlYXJjaCkgZWxzLnNlYXJjaC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uKCl7IGNsZWFyVGltZW91dCh3aW5kb3cuX19nYXZUKTsgd2luZG93Ll9fZ2F2VCA9IHNldFRpbWVvdXQoc2FmZVJlbmRlciwgMTIwKTsgfSk7CgogICAgLy8gQVBJIG9uZ2xldAogICAgd2luZG93LlByaXNlR0FWID0gewogICAgICBzaG93OiBmdW5jdGlvbigpeyB2YXIgc2VjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYi1wcmlzZS1nYXYnKTsgaWYoc2VjKSBzZWMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IGlmKGVscyAmJiBlbHMucHJvZHVpdCkgZWxzLnByb2R1aXQudmFsdWUgPSAnR0FWJzsgZGJnKCdzaG93KCkgYXBwZWzDqScpOyBzYWZlUmVuZGVyKCk7IH0sCiAgICAgIGhpZGU6IGZ1bmN0aW9uKCl7IHZhciBzZWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLXByaXNlLWdhdicpOyBpZihzZWMpIHNlYy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9LAogICAgICBmb3JjZTogZnVuY3Rpb24oKXsgZGJnKCdmb3JjZSgpJyk7IHNhZmVSZW5kZXIoKTsgfQogICAgfTsKCiAgICAvLyBQcmVtaWVyIHJlbmR1CiAgICBzYWZlUmVuZGVyKCk7CiAgfSkoKTsKICA8L3NjcmlwdD4KPC9zZWN0aW9uPgo8IS0tID09PT09IC9Nb2R1bGUgPT09PT0gLS0+Cgo8L2JvZHk+CjwvaHRtbD4K";
  try { 
    frame.src = dataUrl;
  } catch(err) {
    console.error('Impossible d\'initialiser le module GAV inline:', err);
    const note = document.createElement('div');
    note.className = 'small';
    note.style.cssText = 'margin-top:8px;opacity:.8';
    note.textContent = 'Chargement inline impossible.';
    root.appendChild(note);
  }
}
);
      if (!r.ok) throw new Error('HTTP ' + r.status);
      status.textContent = 'Chargement du module…';
      frame.src = gavPath + '?embed=1#v=' + Date.now();
      status.textContent = '';
    } catch (err) {
      status.innerHTML = 'Impossible de charger le module GAV. ' +
        'Vérifie que <code>prise-en-gav-module.html</code> est au <b>même niveau</b> que <code>index.html</code> et que le nom est <b>identique</b>. ' +
        '<br>Erreur : ' + String(err);
    }
  })();
}

/* ===== Tabs bootstrap ===== */

document.querySelectorAll('.tab').forEach(t => {
  t.addEventListener('click', () => {
    const id = t.dataset.tab;
    document.querySelectorAll('.tab').forEach(x => x.classList.toggle('active', x === t));
    document.querySelectorAll('.panel').forEach(p => p.classList.toggle('active', p.id === id));
    if(id==='prev' && !document.getElementById('prev').dataset.ready){ 
/* GAV lazy init */
document.addEventListener('click', (e) => {
  const t = e.target.closest && e.target.closest('.tab');
  if(!t) return;
  if(t.dataset && t.dataset.tab === 'gav'){
    const el = document.getElementById('gav');
    if(el && !el.dataset.ready){
      try { buildGAVPanel(); el.dataset.ready='1'; } catch(e){ console.error(e); }
    }
  }
});

buildPrevPanel(); document.getElementById('prev').dataset.ready='1'; }
    if(id==='calc' && !document.getElementById('calc').dataset.ready){ buildCalcPanel(); document.getElementById('calc').dataset.ready='1'; }
    if(id==='global' && !document.getElementById('global').dataset.ready){ buildGlobalPanel(); document.getElementById('global').dataset.ready='1'; }
    if(id==='plan' && !document.getElementById('plan').dataset.ready){ buildPlanPanel(); document.getElementById('plan').dataset.ready='1'; }

    if(id==='av' && !document.getElementById('av').dataset.ready){ buildAVPanel(); document.getElementById('av').dataset.ready='1'; }
    if(id==='per' && !document.getElementById('per').dataset.ready){ buildPERPanel(); document.getElementById('per').dataset.ready='1'; }
    if(id==='library' && !document.getElementById('library').dataset.ready){ buildLibraryPanel(); document.getElementById('library').dataset.ready='1'; }

          });
});

// Default: build Prévoyance
buildPrevPanel(); document.getElementById('prev').dataset.ready='1';

  function nowISO(){ const d=new Date(); const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),da=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${da}`; }
  function load(){ try{ const j=localStorage.getItem(k()); return j? JSON.parse(j):[]; }catch(e){ return []; } }
  function save(arr){ localStorage.setItem(k(), JSON.stringify(arr)); }

  function rowHtml(o, idx){
    return `<tr data-i="${idx}">
      <td><input value="${o.name||''}" class="i-name" /></td>
      <td>
        <select class="i-prod">
          ${['Santé','GAV','Décès','PER','AV','Autre'].map(v=>`<option ${o.product===v?'selected':''}>${v}</option>`).join('')}
        </select>
      </td>
      <td><input type="number" step="1" min="0" class="i-amount" value="${Math.round(o.amount||0)}" /></td>
      <td><input type="number" min="0" max="100" step="1" class="i-prob" value="${Math.round(o.prob||0)}" /></td>
      <td><input type="date" class="i-next" value="${o.next||''}" /></td>
      <td>
        <select class="i-stat">
        ${['À contacter','En cours','Devis envoyé','À rappeler','Gagné','Perdu'].map(v=>`<option ${o.status===v?'selected':''}>${v}</option>`).join('')}
        </select>
      </td>
      <td>
        <button class="btn btn-ghost up">▲</button>
        <button class="btn btn-ghost down">▼</button>
        <button class="btn btn-danger del">Suppr</button>
      </td>
    </tr>`;
  }

  /* ===== Bibliothèque d'argumentaires (PDF intégré + CRUD) ===== */
function buildLibraryPanel(){
  const root = document.getElementById('library');
  if(!root) return;
  root.innerHTML = `
    <div class="grid">
      <section class="card" style="grid-column: span 12">
        <h3 class="section-title">Argumentaires & Objections — Bibliothèque intégrée</h3>
        <div class="row" style="flex-wrap:wrap; gap:8px">
          <input class="q" placeholder="Rechercher (mot-clé: objection, réponse, punchline…)" style="min-width:320px" />
          <select class="prod"></select>
          <select class="sit"></select>
          <button class="btn btn-ghost add">Ajouter une carte</button>
          <button class="btn btn-ghost import">Importer JSON</button>
          <button class="btn btn-ghost export">Exporter JSON</button>
          <button class="btn btn-danger reset">Réinitialiser (cartes PDF)</button>
        </div>
        <div class="hr"></div>
        <div class="cards" style="display:grid; grid-template-columns: repeat(auto-fill,minmax(320px,1fr)); gap:12px;"></div>
      </section>
    </div>`;

  const DATA_FROM_PDF = [{"product": "Santé", "situation": "Famille", "objection": "C'est trop cher , j'ai déjà trop de dépenses pour la famille.", "response": "Je comprends que le budget soit une contrainte. Justement, nos formules Santé sont modulables : vous pouvez choisir un niveau de garantie adapté pour contrôler le coût tout en couvrant l'essentiel. Mieux vaut une petite cotisation maîtrisée que de faire face à une grosse dépense imprévue en cas de souci de santé.", "punchline": "Mieux vaut investir un peu dans sa santé que de risquer beaucoup à la négliger .", "value": "Couverture personnalisable selon le budget; remboursements élevés sur les postes coûteux (hospitalisation, dentaire, optique); évite les restes à charge importants pour la famille."}, {"product": "Santé", "situation": "Famille", "objection": "On est jeunes et en bonne santé, on n'a pas vraiment besoin d'une mutuelle renforcée.", "response": "Tant mieux si vous êtes en bonne santé ! Mais personne n'est à l'abri d'un accident ou d'un imprévu médical, surtout avec des enfants. Souscrire quand tout va bien permet d'obtenir un bon tarif et d'être serein : si quelque chose arrive, vous aurez les meilleurs soins sans vous soucier du coût.", "punchline": "La santé n'attend pas que les problèmes arrivent pour être protégée.", "value": "Tarifs avantageux pour jeunes assurés; prise en charge des imprévus (urgences, fractures, analyses coûteuses); tranquillité d'esprit pour toute la famille en cas de pépin."}, {"product": "Santé", "situation": "Famille", "objection": "La Sécu et ma mutuelle d'entreprise de base suffisent, je n'ai pas besoin de garanties supplémentaires.", "response": "Votre couverture actuelle protège le minimum. Cependant, de nombreux soins courants (lunettes, prothèses dentaires, spécialistes hors convention) restent mal remboursés. Avec notre complémentaire Santé, vous comblez ces lacunes et évitez de payer de votre poche. C'est l'assurance d'un meilleur confort de soins pour vous et votre famille.", "punchline": "Ne laissez pas un budget serré dicter la qualité de vos soins.", "value": "Complément de remboursement sur les postes mal pris en charge par les régimes de base; accès à un réseau de partenaires santé à tarifs négociés; meilleur confort financier même pour les soins onéreux."}, {"product": "Santé", "situation": "Famille", "objection": "Je préfère payer moi-même les petites dépenses et j'espère ne jamais avoir de gros problème de santé.\"1. 2. 3. 4. 1", "response": "Payer les petites dépenses, c'est faisable, mais un seul gros problème de santé peut coûter des milliers d'euros. L'assurance santé vous évite d'entamer vos économies en cas de coup dur . C'est comme un parapluie : quand la tempête arrive, vous êtes content de l'avoir , même si vous ne l'utilisez pas tous les jours.", "punchline": "", "value": ""}, {"product": "Santé", "situation": "Famille", "objection": "Les assurances santé ne remboursent jamais aussi bien qu'elles le promettent, et c'est compliqué de se faire rembourser .", "response": "Notre assurance santé est au contraire très transparente. Nous remboursons jusqu'à 100 % ou 200 % des tarifs de la Sécurité sociale sur de nombreux soins, et le tiers payant évite même d'avancer les frais chez de nombreux professionnels. De plus, nous simplifions les démarches : tout peut se faire en ligne ou par appli, et vous êtes remboursé en quelques jours.", "punchline": "Simplifiez-vous la santé : on s'occupe de tout, sauf de votre place chez le médecin !", "value": "Remboursements clairs et élevés (y compris en optique/dentaire); tiers payant généralisé pour éviter l'avance de frais; gestion 100 % digitale et rapide des demandes."}, {"product": "Santé", "situation": "Sénior", "objection": "À mon âge, une bonne mutuelle coûte trop cher de toute façon.", "response": "Les besoins de santé augmentent avec l'âge, et nos offres Seniors en tiennent compte avec un tarif ajusté. Pensez au coût d'un appareil auditif ou de soins à domicile : sans mutuelle, c'est un reste à charge énorme. Nous proposons des garanties ciblées sur vos besoins réels (hospitalisation, optique, audioprothèses) pour un tarif optimisé. C'est un investissement pour votre qualité de vie.", "punchline": "Votre santé n'a pas de prix, et pourtant elle peut être bien assurée.", "value": "Formules dédiées aux seniors (soins courants et hospitaliers renforcés); prise en charge des équipements coûteux (audition, dentaire, etc.); maintien du niveau de santé sans sacrifier son budget retraite."}, {"product": "Santé", "situation": "Sénior", "objection": "J'ai déjà une mutuelle depuis des années, je préfère ne pas changer pour éviter les problèmes de carence ou de paperasse.", "response": "Rassurez-vous, en changeant de mutuelle vous conservez vos droits sans interruption si vous enchaînez les contrats. Nous nous occupons de toutes les démarches de résiliation pour vous. L'intérêt de changer , c'est souvent de bénéficier de meilleures garanties ou d'un tarif plus avantageux adapté à votre situation actuelle. Vous pourriez y gagner sur toute la ligne sans effort.", "punchline": "Changer pour mieux, sans tracas : on s'occupe de tout pour vous.", "value": "Pas de délai de carence en reprenant vos garanties acquises; accompagnement personnalisé pour la transition de contrat; souvent des garanties plus élevées ou cotisation réduite à la clé."}, {"product": "Santé", "situation": "Sénior5.", "objection": "Je n'ai pas de gros besoins médicaux, juste le généraliste et quelques médicaments. La Sécu suffit pour moi.", "response": "Aujourd'hui vous avez la chance de ne pas avoir de gros soucis. Mais avec l'âge, un problème peut vite survenir : par exemple, une chute nécessitant de la rééducation ou des lunettes hors de prix. La Sécu rembourse mal ces frais. Avoir une mutuelle, c'est être prêt à faire face sans entamer vos économies, pour continuer à vous soigner correctement en toute circonstance.", "punchline": "En matière de santé, mieux vaut prévenir aujourd'hui que payer le prix fort demain.", "value": "Sécurité financière face aux aléas de santé liés à l'âge; accès sans restriction aux spécialistes et meilleurs soins; préservation du capital et de la qualité de vie."}, {"product": "Santé", "situation": "Sénior", "objection": "Je préfère garder mon argent pour moi que de le donner tous les mois à une assurance.", "response": "Pensez-y comme à une solidarité avec vous-même : vous mettez un peu chaque mois pour éviter de devoir sortir beaucoup d'un coup le jour où un problème de santé arrivera. Sans mutuelle, une seule hospitalisation pourrait vous coûter bien plus que des années de cotisations. Avec notre assurance, vous transformez de grosses dépenses imprévisibles en un budget maîtrisé.", "punchline": "Mieux vaut des petites cotisations régulières qu'une facture ingérable sortie de nulle part.", "value": "Stabilisation du budget santé (plus de mauvaises surprises); accès aux meilleurs traitements sans arbitrer selon le coût; protection de votre patrimoine contre les dépenses médicales lourdes."}, {"product": "Santé", "situation": "Sénior", "objection": "Les paperasses de santé sont trop compliquées pour moi, je ne saurai pas me faire rembourser .", "response": "Notre service client est là pour vous accompagner . Nous proposons même de prendre en charge les formalités administratives à votre place : par exemple, le tiers payant signifie que vous n'avancez rien et nous réglons directement avec le professionnel de santé. Et si vous avez la moindre question, votre conseiller dédié s'occupe de tout. Vous n'avez qu'à vous soigner , on s'occupe du reste.", "punchline": "Profitez de vos soins, on gère les papiers !", "value": "Assistance administrative incluse (tiers payant, aide aux démarches); service client dédié aux seniors; simplicité d'utilisation (relevés clairs, support téléphonique). GAV (Garantie Accidents de la Vie)"}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Famille", "objection": "Je suis très prudent, je fais attention dans tout ce que je fais. Je ne vois pas l'intérêt de payer pour ça.", "response": "Vous avez raison d'être prudent, mais les accidents de la vie courante arrivent même aux plus vigilants. Une mauvaise chute à la maison ou un accident bête arrive sans prévenir . La GAV est là pour vous protéger quand même : elle prévoit une indemnisation importante si un accident grave survient, afin que votre vie continue le plus normalement possible financièrement.", "punchline": "On ne peut pas éviter tous les accidents, mais on peut en éviter les conséquences9. 10. 1. 3 financières.", "value": "Protection 24h/24, tous lieux et pour toute la famille; indemnisation forfaitaire pouvant aller jusqu'à plusieurs centaines de milliers d'euros en cas d'invalidité; aide financière pour aménager votre quotidien après un accident."}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Famille", "objection": "On est déjà assurés pour tout : voiture, habitation… une assurance accidents de la vie en plus, c'est trop.", "response": "En réalité, ni l'assurance auto ni l'assurance habitation ne vous couvrent pour les accidents de la vie courante. La GAV vient en complément : elle intervient pour les accidents domestiques, les accidents de loisirs, les situations du quotidien que les autres assurances n'indemnisent pas. C'est une protection en plus pour des risques bien réels que personne d'autre ne prend en charge.", "punchline": "Ne confondez pas tout risque et tous risques : la GAV couvre ce que les autres n'assurent pas.", "value": "Complément des assurances existantes (protection hors véhicule et travail); couverture des accidents domestiques, sportifs, de loisirs, etc.; garantie valable partout (à la maison, en voyage, en vacances)."}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Famille", "objection": "Franchement, les accidents graves, ça n'arrive qu'aux autres. Je ne veux pas payer pour un cas très improbable.", "response": "Personne ne s'attend à être victime d'un accident grave… jusqu'au jour où ça arrive. Chaque année, des millions de personnes sont touchées par des accidents de la vie courante en France. La GAV coûte seulement quelques euros par mois, mais elle peut sauver votre situation financière si l'improbable se produit. C'est une petite tranquillité d'esprit en plus, au cas où.", "punchline": "Un accident peut changer une vie en une seconde, mais une bonne assurance peut en atténuer les dégâts.", "value": "Cotisation modeste au regard de la protection obtenue; tranquillité d'esprit face aux aléas de la vie; soutien financier immédiat pour faire face aux conséquences (rééducation, incapacité, etc.)."}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Famille", "objection": "Si je deviens invalide après un accident, la Sécurité sociale me versera une pension, non ?", "response": "La Sécurité sociale verse une pension d'invalidité, mais elle est souvent très partielle par rapport à vos revenus, et elle ne couvre pas les frais d'aménagement ou l'aide à domicile dont vous pourriez avoir besoin. La GAV, elle, vous verse un capital important en cas d'invalidité grave. Cet argent vous permettrait par exemple d'aménager votre logement pour rester autonome, ou de compenser la perte de revenus. C'est un vrai filet de sécurité en plus de la pension.", "punchline": "Votre assurance santé vous soigne, la GAV vous aide à reconstruire votre vie.", "value": "Versement d'un capital libre d'utilisation en cas d'invalidité (pas seulement des remboursements médicaux); compensation de la perte de revenus et des frais non couverts; maintien de l'autonomie grâce à un soutien financier adapté."}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Famille2.", "objection": "Franchement, on n'a pas le budget pour encore une assurance. On a d'autres priorités.", "response": "Je comprends que le budget familial soit serré. La bonne nouvelle, c'est que la GAV reste très abordable : pour le prix de deux cafés par mois, vous protégez toute votre famille contre les gros coups durs. Et pensez aux conséquences financières d'un accident grave : un parent qui ne peut plus travailler , des frais médicaux longs… Sans protection, l'impact financier serait bien pire que le coût mensuel de la GAV.", "punchline": "", "value": ""}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Sénior", "objection": "À mon âge, si je me blesse gravement, assurance ou pas, je finirai en maison de retraite.", "response": "Pas forcément. Si un accident vous arrive, disposer d'un capital grâce à la GAV peut justement vous éviter la maison de retraite. Par exemple, cet argent pourrait financer l'aménagement de votre domicile (rampe, lit médicalisé, aide à domicile) pour que vous puissiez continuer à vivre chez vous confortablement. Sans cette aide financière, beaucoup de seniors n'ont pas le choix. La GAV vous donne les moyens de choisir .", "punchline": "Préservez votre indépendance, même après un accident, grâce à un coup de pouce financier .", "value": "Permet de financer des aménagements pour rester à domicile; garantie de recevoir un capital rapidement pour faire face aux conséquences d'une perte d'autonomie; liberté de choix sur l'utilisation des fonds (aide professionnelle, équipement, etc.)."}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Sénior", "objection": "Je ne fais plus rien de risqué, je passe la plupart de mon temps tranquillement à la maison.", "response": "Beaucoup d'accidents graves arrivent à la maison lors des activités quotidiennes : une mauvaise chute dans l'escalier , un faux pas dans le jardin… Même en étant prudent et casanier , le risque zéro n'existe pas. La GAV vous protège justement dans votre vie de tous les jours, à la maison comme à l'extérieur . Ainsi, même pendant vos activités les plus tranquilles, vous savez que vous êtes couvert en cas de coup dur .", "punchline": "Même chez soi, un accident est vite arrivé : mieux vaut être couvert dans son cocon.", "value": "Couverture valable même pour les accidents domestiques courants (chutes, brûlures…); s'applique à toutes vos activités quotidiennes sans exclusion; protège les seniors souvent seuls à domicile."}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Sénior", "objection": "Ma mutuelle santé et l'Assurance Maladie couvriront les frais si je me blesse, je n'ai pas besoin d'une GAV.", "response": "Votre mutuelle santé couvrira les soins, mais pas les conséquences durables d'un accident. Par exemple, si vous gardez des séquelles, que vous avez besoin d'une aide ménagère ou de fauteuils adaptés, ce n'est pas la mutuelle qui paiera, et la Sécurité sociale non plus. La GAV intervient là : elle vous verse une somme pour faire face à ces dépenses et maintenir votre qualité de vie. C'est le complément indispensable pour tout ce que la santé ne prend pas en6. 7. 8. 5 charge.", "punchline": "Soigner l'accident, c'est bien. En réparer les conséquences, c'est mieux.", "value": "Complète la mutuelle en cas de séquelles physiques permanentes; aide au financement des services non médicaux (aide à domicile, équipements spéciaux); évite de puiser dans ses économies pour retrouver un confort de vie."}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Sénior", "objection": "Je vis seul et je n'ai plus de famille à charge. À quoi bon une assurance accidents ?", "response": "Même sans famille à charge, pensez à vous et à votre propre confort. Si un accident vous handicape, qui paiera pour une aide quotidienne ou un bon fauteuil roulant ? La GAV vous aide, vous, directement. C'est une protection pour préserver votre dignité et votre autonomie, sans devoir compter sur d'éventuelles aides externes. Vous cotisez pour vous-même, pour être sûr que quoiqu'il arrive, vous pourrez faire face.", "punchline": "Votre avenir mérite protection, même si vous êtes seul : pensez à vous comme à votre meilleur ami.", "value": "Prise en charge centrée sur l'assuré (pas besoin d'avoir des ayants droit pour en bénéficier); garantie de ressources pour financer sa propre assistance; reste valable quel que soit votre statut familial."}, {"product": "Garantie Accidents de la Vie (GAV)", "situation": "Sénior", "objection": "J'ai déjà une assurance accident avec ma carte bancaire ou une garantie dans un autre contrat.", "response": "Les assurances accident des cartes bancaires sont en général limitées : souvent elles ne couvrent que les accidents en voyage ou avec des conditions particulières, et les montants d'indemnisation sont faibles. Notre GAV est beaucoup plus complète : elle vous couvre en toutes circonstances, avec des plafonds d'indemnisation élevés, et elle prend en charge l'invalidité partielle ou totale, pas seulement le décès. C'est une vraie sécurité beaucoup plus large que les petites garanties annexes de carte.", "punchline": "Ne confondez pas une mini-garantie et une vraie protection : la GAV, c'est l'armure tous risques de votre quotidien.", "value": "Couverture bien plus étendue que les garanties accidents basiques (montants élevés, invalidité incluse); engagement contractuel clair et solide; tranquillité d'esprit en sachant que l'assureur interviendra réellement en cas de besoin. Décès (Assurance Vie Risque Décès)"}, {"product": "Assurance Décès", "situation": "Famille", "objection": "Je suis jeune, ce n'est pas maintenant que je vais mourir . J'ai le temps avant de penser à une assurance décès.", "response": "Personne n'envisage de partir jeune, et je vous le souhaite également. Mais justement, prendre une assurance décès maintenant coûte très peu cher et sécurise l'avenir de vos proches quoi qu'il arrive. Si un accident ou une maladie survenait, le capital versé permettrait à votre famille de garder leur maison, de financer les études des enfants… C'est une protection précoce qui fait toute la différence, au cas où.", "punchline": "On attache sa ceinture sans prévoir d'accident, on assure sa famille sans prévoir de mourir .", "value": "Primes très basses à jeune âge pour un capital élevé; protection immédiate de la famille en cas de coup dur; sérénité d'esprit pour le titulaire qui sait sa famille à l'abri.9. 10. 1. 6"}, {"product": "Assurance Décès", "situation": "Famille", "objection": "J'ai déjà une assurance décès avec mon prêt immobilier / mon travail, ça suffit.", "response": "Ces couvertures existent, mais sont-elles suffisantes ? L'assurance emprunteur rembourse la banque, pas votre famille directement. Et l'assurance décès de votre travail est limitée (généralement un ou deux ans de salaire) et disparaît si vous changez d'employeur . Notre assurance décès personnelle vous garantit un capital que VOUS choisissez, qui ira directement à vos proches pour leurs besoins (factures, éducation des enfants, etc.), et ce quelle que soit votre situation professionnelle.", "punchline": "Ne confiez pas le destin financier de vos proches au hasard des contrats tiers : choisissez le vôtre.", "value": "Capital garanti défini selon vos besoins familiaux; couverture indépendante de l'emploi ou d'un prêt (vous gardez la maîtrise); versement rapide directement aux bénéficiaires désignés."}, {"product": "Assurance Décès", "situation": "Famille", "objection": "Au lieu de payer une prime d'assurance, je préfère économiser cet argent pour ma famille.", "response": "Épargner , c'est bien, mais il vous faudrait des dizaines d'années pour mettre de côté ce que l'assurance verserait en une seule fois si un malheur arrivait. Par exemple, en épargnant 30 € par mois, vous aurez 3 600 € en 10 ans. Une assurance décès pourrait verser 100 000 € du jour au lendemain si besoin. C'est complémentaire à l'épargne : ça offre une protection immédiate que l'épargne seule ne peut atteindre rapidement.", "punchline": "", "value": ""}, {"product": "Assurance Décès", "situation": "Famille", "objection": "Statistiquement j'ai peu de risques de mourir jeune, payer pour ça semble de l'argent jeté par les fenêtres.", "response": "C'est vrai, on l'espère tous : la probabilité est faible. Mais les conséquences seraient si lourdes pour vos proches que cela vaut la peine d'assurer ce risque-là. C'est un peu comme un extincteur à la maison : on souhaite ne jamais s'en servir , mais on est bien content de l'avoir en cas d'incendie. Et vu le faible coût de l'assurance décès quand on est en bonne santé, le jeu en vaut la chandelle pour protéger ceux qu'on aime.", "punchline": "Assurer un risque faible, parce que ses conséquences seraient insupportables à porter pour vos proches.", "value": "Forte tranquillité d'esprit pour un coût modique; prise en charge d'un risque aux conséquences financières majeures; acte de prévoyance responsable qui complète les autres assurances."}, {"product": "Assurance Décès", "situation": "Famille", "objection": "C'est trop morbide votre truc, je n'ai pas envie de penser à ma mort pour souscrire un contrat.", "response": "Je comprends, ce n'est jamais agréable d'envisager le pire. Mais voyez cela plutôt comme un acte d'amour et de responsabilité envers vos proches. Une fois le contrat en place,2. 3. 4. 5. 7 vous n'aurez plus à y penser au quotidien, sauf pour vous dire que quoi qu'il arrive, votre famille sera protégée. Cela permet de vivre encore plus sereinement le présent, justement.", "punchline": "Prévoir l'imprévisible, ce n'est pas être morbide, c'est aimer sa famille intelligemment.", "value": "Démarche simple et faite une fois pour toutes; soulagement mental de savoir sa famille protégée; vos proches sont préservés du stress financier en plus du drame émotionnel."}, {"product": "Assurance Décès", "situation": "Sénior", "objection": "À mon âge c'est trop tard ou bien trop coûteux de prendre une assurance décès.", "response": "Il existe des formules spécialement pensées pour les seniors. Même à 60 ou 65 ans, vous pouvez encore assurer un capital décès modeste, par exemple pour aider votre conjoint ou payer vos frais d'obsèques. Les cotisations sont ajustées à l'âge, mais vous pouvez choisir un capital moins élevé pour maîtriser le budget. Mieux vaut tard que jamais : un petit capital vaut mieux qu'aucune aide du tout pour vos proches.", "punchline": "Il n'est jamais trop tard pour protéger ceux qu'on aime, même modestement.", "value": "Contrats adaptés aux seniors (sans examen médical pour certains montants); possibilité de choisir un capital et une durée de cotisation selon ses moyens; assure au minimum les frais immédiats (obsèques, factures) sans laisser la charge aux proches."}, {"product": "Assurance Décès", "situation": "Sénior", "objection": "Mes enfants sont grands, ils n'ont pas besoin que je leur laisse de l'argent.", "response": "Vos enfants n'en ont peut-être pas besoin pour vivre, mais pensez aux coups durs : ce capital pourrait leur permettre de prendre un nouveau départ, de réaliser un projet que vous voulez soutenir (achat immobilier , création d'entreprise) ou simplement de financer les frais liés à votre succession sans entamer leurs propres économies. C'est un moyen de leur transmettre un dernier coup de pouce, un héritage supplémentaire symbole de votre soutien.", "punchline": "Ce n'est pas d'assistance dont vos enfants adultes ont besoin, mais d'un dernier geste qui fait la différence.", "value": "Liberté de désigner le bénéficiaire de votre choix (enfant, petit-enfant, cause caritative); capital versé hors succession (selon la réglementation, ce qui peut accélérer et faciliter la transmission); geste d'amour final qui peut faire la différence dans leurs projets."}, {"product": "Assurance Décès", "situation": "Sénior", "objection": "J'ai suffisamment d'économies et de patrimoine, je n'ai pas besoin d'assurance pour transmettre quelque chose.", "response": "Votre patrimoine est précieux, mais songez que lors d'un décès, les comptes peuvent être bloqués le temps de la succession et des droits de succession sont dus. L'assurance décès verse un capital liquide et immédiat à vos bénéficiaires, leur évitant d'avoir à vendre un bien en urgence ou de puiser dans leurs poches pour payer les frais. C'est une sécurité en plus, même quand on a du patrimoine : de l'argent disponible tout de suite pour faire face à tout.", "punchline": "Un patrimoine, c'est bien. Du cash disponible immédiatement pour vos proches, c'est encore mieux en moment de crise.", "value": "Capital hors succession versé en quelques semaines sans formalités lourdes; permet de payer les frais (succession, obsèques) sans entamer le patrimoine principal; évite des décisions précipitées (vente de biens) pour régler des urgences financières."}, {"product": "Assurance Décès", "situation": "Sénior6.", "objection": "Mon épouse/époux touchera ma pension de réversion, ça suffira pour vivre.", "response": "La pension de réversion ne représente qu'une partie de votre retraite (souvent 50 à 60%). Cela veut dire que le revenu de votre conjoint va diminuer significativement. Avec une assurance décès, vous compensez cette baisse brutale de ressources : le capital peut être placé pour générer un complément de revenu ou servir de matelas financier le temps que votre conjoint se retourne. C'est assurer le même niveau de vie à votre moitié, sans mauvaises surprises.", "punchline": "Ne laissez pas la moitié de votre retraite devenir la totalité de ses revenus : compensez pour son confort.", "value": "Maintien du niveau de vie du conjoint survivant; capital transformable en rente ou en épargne de secours; protection du conjoint au-delà des régimes de retraite officiels."}, {"product": "Assurance Décès", "situation": "Sénior", "objection": "Franchement, je préfère utiliser mon argent pour profiter de la vie maintenant que payer une assurance pour quand je ne serai plus là.", "response": "Vous avez bien raison de profiter de la vie. Et justement, souscrire une assurance décès n'empêche pas de le faire : le coût peut être très modéré comparé à vos dépenses de loisir , et c'est une manière de profiter l'esprit tranquille. En sachant vos proches protégés, chaque voyage ou petit plaisir est savouré sans arrière-pensée. Quelques dizaines d'euros par mois ne vous priveront pas de vos joies, mais éviteront bien des soucis à votre famille plus tard.", "punchline": "Vivez pleinement aujourd'hui, assurez l'avenir des vôtres en parallèle : l'un n'empêche pas l'autre.", "value": "Cotisation modeste par rapport à vos revenus de retraité actifs; tranquillité d'esprit qui vous permet d'apprécier encore plus vos loisirs; assurance de laisser une empreinte positive et utile sans vous restreindre. PER (Plan Épargne Retraite)"}, {"product": "Plan Épargne Retraite (PER)", "situation": "Famille", "objection": "Je n'ai pas les moyens d'épargner pour la retraite avec toutes mes charges actuelles.", "response": "Le PER est justement très flexible : vous pouvez y mettre de petites sommes, quand vous le pouvez. Même 50 € par mois peuvent suffire pour commencer . Et n'oubliez pas que chaque versement est déductible de vos impôts : si vous payez des impôts, l'État en prend une partie à sa charge, ce qui alège votre effort. C'est une épargne progressive et adaptée à vos capacités, pour ne pas sentir de manque tout en construisant votre futur petit à petit.", "punchline": "Mieux vaut épargner un peu régulièrement que rien du tout : chaque euro compte pour votre futur .", "value": "Versements libres et modulables selon votre budget; avantage fiscal immédiat qui réduit l'effort net; constitution progressive d'un capital sans pression."}, {"product": "Plan Épargne Retraite (PER)", "situation": "Famille", "objection": "L'argent est bloqué jusqu'à la retraite, si j'ai un coup dur je ne pourrai pas y toucher .", "response": "Le PER a pour vocation de sécuriser votre retraite, c'est vrai que l'épargne est bloquée sauf cas exceptionnels. Mais sachez qu'il existe des possibilités de retrait anticipé : achat de votre résidence principale, invalidité, décès de votre conjoint, chômage de longue durée… Dans ces situations, vous pouvez récupérer vos fonds. Et à la retraite, vous aurez le choix de sortir en capital si vous voulez tout récupérer d'un coup. En fait, c'est un coffre-fort pour vos vieux jours,10. 1. 2. 9 avec une clé de secours en cas de gros coup dur .", "punchline": "Bloqué jusqu'à la retraite, sauf en cas de vraie nécessité : votre épargne est en sécurité, pas en prison.", "value": "Épargne sécurisée pour l'objectif retraite (évite les tentations de la puiser); options de déblocage anticipé en cas de situations difficiles; possibilité de sortie flexible à la retraite (capital ou rente)."}, {"product": "Plan Épargne Retraite (PER)", "situation": "Famille", "objection": "Qui me dit que d'ici 20 ans l'État ne va pas changer les règles fiscales ? Je n'ai pas confiance.", "response": "Les règles peuvent évoluer , mais l'objectif du PER est de rester avantageux pour inciter les gens à épargner . Depuis son lancement, déjà 10 millions de Français l'ont adopté , c'est un pilier de la politique retraite actuelle. Et généralement, les avantages acquis sont conservés même en cas d'ajustements. En attendant, vous profitez dès aujourd'hui de la réduction d'impôt et de la croissance de votre épargne. Ne pas agir par crainte de changements hypothétiques, c'est se priver d'avantages bien réels maintenant. Et quoi qu'il arrive, l'argent que vous aurez mis de côté restera à vous.", "punchline": "", "value": ""}, {"product": "Plan Épargne Retraite (PER)", "situation": "Famille", "objection": "Je préfère investir dans l'immobilier ou sur une assurance vie, au moins je peux disposer de mon argent.", "response": "L'immobilier et l'assurance vie sont de très bons placements, complémentaires du PER. Le PER a un atout que les autres n'ont pas : l'économie d'impôt à l'entrée, ce qui booste votre rendement. Et il est spécifiquement conçu pour vous donner un revenu à la retraite. Par exemple, avec un PER vous pouvez choisir de transformer votre capital en rente viagère pour un complément à vie. Rien ne vous empêche d'avoir plusieurs supports d'épargne, au contraire : diversifier , c'est sécuriser . Le PER vient simplement ajouter un avantage fiscal et une discipline pour votre objectif retraite.", "punchline": "", "value": ""}, {"product": "Plan Épargne Retraite (PER)", "situation": "Famille", "objection": "Ma retraite, j'y penserai plus tard. J'ai encore le temps, là j'ai d'autres priorités.", "response": "Plus tard, ce sera plus difficile de rattraper le temps perdu. Chaque année sans épargne retraite est une occasion manquée de faire fructifier votre argent. Si vous commencez maintenant, même modestement, vous profiterez de l'effet cumulé des intérêts. En commençant tard, il faudra cotiser bien plus chaque mois pour compenser . Mieux vaut mettre un peu de côté maintenant que beaucoup dans l'urgence à 5 ans de la retraite. Votre vous du futur vous remerciera d'avoir commencé tôt !", "punchline": "", "value": ""}, {"product": "Plan Épargne Retraite (PER)", "situation": "Sénior", "objection": "Je suis à 10 ans de la retraite à peine, ça ne sert à rien d'ouvrir un PER si tard.", "response": "Il n'est pas trop tard ! À 10 ans de la retraite, vous êtes sans doute à votre pic de revenus. Placer une partie de vos revenus dans un PER va fortement réduire vos impôts chaque année, et cet argent économisé travaille pour vous. En 10 ans, avec des versements réguliers ou ponctuels (prime de fin de carrière, épargne disponible), vous pouvez constituer un beau complément. Et à la sortie, vous pourrez retirer en capital pour réaliser vos projets de retraite. Même sur 10 ans, le PER peut faire une belle différence, surtout fiscalement.", "punchline": "Chaque année compte, même les dix dernières : le PER peut encore booster votre retraite in extremis .", "value": "Réduction fiscale importante en fin de carrière (où l'impôt est souvent élevé); possibilité de versements uniques conséquents (ex : indemnités de départ) pour profiter du cadre PER; constitution rapide d'un capital retraite complémentaire utilisable dès le premier jour de la retraite."}, {"product": "Plan Épargne Retraite (PER)", "situation": "Sénior", "objection": "Je suis déjà à la retraite, ouvrir un PER ne m'apporterait rien.", "response": "Certes, une fois à la retraite, l'avantage de la déduction fiscale est moins pertinent si vos revenus baissent. Mais le PER peut encore servir d'outil patrimonial. Par exemple, si vous souhaitez transmettre un capital à un proche dans un cadre favorable ou vous constituer plus tard une rente viagère (pour vos 80 ans et plus), c'est possible. De plus, si vous avez hérité ou vendu un bien, vous pouvez loger cette somme dans un PER pour la faire fructifier à l'abri de l'impôt jusqu'à sa sortie. Ce n'est pas le premier public visé, mais c'est loin d'être inutile selon vos objectifs.", "punchline": "Même retraité, on peut encore planifier et optimiser : le PER n'a pas d'âge pour servir vos projets.", "value": "Outil souple pour gérer des sommes même une fois retraité (capitalisation à l'abri de l'impôt); possibilité de transmission aux bénéficiaires en cas de décès avec fiscalité avantageuse (similaire à l'assurance vie); option de rente viagère future pour anticiper une possible dépendance."}, {"product": "Plan Épargne Retraite (PER)", "situation": "Sénior", "objection": "Et si je décède avant d'en profiter , tout cet argent sera perdu ?", "response": "Pas du tout, rassurez-vous. L'épargne accumulée sur votre PER ne disparaît pas si vous veniez à décéder . Au contraire, elle est transmise à vos bénéficiaires, un peu comme avec une assurance vie. Vous pouvez désigner la personne de votre choix qui recevra les fonds. Donc soit vous en profitez vous-même à la retraite, soit ce sont vos proches qui en profitent. Dans tous les cas, l'argent que vous placez sur le PER revient à votre foyer d'une manière ou d'une autre.", "punchline": "Sur le PER, rien n'est perdu : si ce n'est pas vous, ce sera vos proches qui récolteront le fruit de votre épargne.", "value": "Clause bénéficiaire pour transmettre le capital épargné; assurance que l'effort d'épargne profite à la famille même en cas d'aléa de la vie; épargne sécurisée juridiquement (hors succession classique selon les cas, accélérant le versement).6. 7. 8. 11"}, {"product": "Plan Épargne Retraite (PER)", "situation": "Sénior", "objection": "Je ne paie presque pas d'impôts, le bénéfice fiscal du PER ne m'intéresse pas.", "response": "Même sans avantage fiscal immédiat, le PER reste intéressant. D'abord, il vous force à sanctuariser une épargne pour la retraite, là où une assurance vie par exemple pourrait être dépensée à tout moment. Ensuite, vos gains accumulés dans le PER ne sont pas imposés tant que vous ne sortez pas l'argent, ce qui veut dire plus de capitalisation. Enfin, vous pouvez aussi choisir de ne pas déduire vos versements : ainsi, à la sortie, vous récupérerez votre épargne avec seulement les gains fiscalisés à taux réduit. En somme, c'est un outil de plus pour préparer l'avenir , même si l'avantage fiscal est moindre pour vous.", "punchline": "Le PER, ce n'est pas que pour les gros impôts : c'est avant tout pour se payer une retraite plus confortable, impôts ou pas.", "value": "Discipline d'épargne dédiée à la retraite (on ne pioche pas dedans facilement); capitalisation à l'abri de l'impôt sur les revenus de placements; flexibilité fiscale (déduire ou non selon l'intérêt, et imposition allégée en sortie si non déduit)."}, {"product": "Plan Épargne Retraite (PER)", "situation": "Sénior", "objection": "C'est trop risqué votre PER, je ne veux pas jouer ma retraite en bourse.", "response": "Le PER n'est pas un produit unique en bourse, c'est vous qui choisissez comment l'investir . Vous pouvez opter pour des placements sécurisés, comme des fonds en euros garantis, ou moduler le risque selon ce qui vous convient. De plus, la gestion pilotée de nombreux PER sécurise automatiquement votre épargne à l'approche de la retraite, pour éviter les mauvaises surprises. En clair , vous pouvez profiter du PER même avec un profil prudent : ce n'est pas du casino, c'est de l'épargne sur-mesure.", "punchline": "", "value": ""}, {"product": "Assurance Vie", "situation": "Famille", "objection": "Le rendement des fonds en euros est trop faible, ça ne rapporte presque rien.", "response": "Il est vrai que le fonds garanti en euros a eu des taux bas ces dernières années, mais il a l'avantage de la sécurité totale. Et rien ne vous oblige à rester sur du 100 % fonds euros : en assurance vie, vous pouvez diversifier sur des fonds plus dynamiques pour chercher du rendement, tout en gardant une partie sécurisée. De plus, les intérêts du fonds euros s'accumulent sans impôts chaque année tant que vous ne retirez pas, ce qui améliore le rendement net à terme. C'est un placement équilibré entre sécurité et performance sur la durée.", "punchline": "Sécurité et performance : en assurance vie, à vous de doser le cocktail pour booster le rendement.", "value": "Capital garanti sur le fonds euros + potentiel de meilleurs rendements via des unités de compte; intérêts capitalisés sans fiscalité annuelle; ajustement possible de la stratégie en cours de route selon le contexte économique."}, {"product": "Assurance Vie", "situation": "Famille9.", "objection": "Il y a trop de frais (entrée, gestion…), au final ça mange tout le profit.", "response": "Notre assurance vie est nouvelle génération : 0 % de frais d'entrée, et des frais de gestion réduits. Les assureurs ont fait des efforts, la concurrence a tiré les prix vers le bas. Par ailleurs, les avantages de l'assurance vie (comme la fiscalité allégée après 8 ans, ou la gestion professionnelle) compensent largement ces petits frais. Pensez-y : pas d'impôts sur vos gains tant que vous ne sortez pas l'argent, ça fait souvent plus d'économie que les frais de gestion annuels. Au final, le rendement net reste très attractif.", "punchline": "Des frais maîtrisés pour un maxi-profit : l'assurance vie moderne sait rester compétitive.", "value": "Contrats sans frais d'entrée et à frais réduits; optimisation fiscale qui compense les coûts; expertise de gestion incluse pour faire fructifier au mieux l'épargne."}, {"product": "Assurance Vie", "situation": "Famille", "objection": "Mon argent est bloqué pendant 8 ans, si j'ai besoin je ne pourrai pas y toucher .", "response": "Contrairement à une idée reçue, l'argent n'est pas bloqué 8 ans. Vous pouvez retirer tout ou partie de votre épargne quand vous voulez. Les 8 ans, c'est seulement pour bénéficier du maximum d'avantages fiscaux sur les gains. Même si vous retirez avant, vous aurez simplement une petite taxation sur les intérêts, rien d'interdit. Et en cas de besoin urgent, un rachat partiel peut se faire en quelques jours, le temps que l'assureur traite l'opération. L'assurance vie, c'est liquide et souple : vous gardez le contrôle de vos fonds.", "punchline": "Disponible à tout moment : votre argent reste le vôtre, avec en bonus des avantages fiscaux au fil du temps.", "value": "Liquidité de l'épargne (rachats possibles à tout moment sans pénalité); fiscalité dégressive avec le temps (après 8 ans, abattement annuel sur les gains); souplesse des versements et retraits selon vos besoins."}, {"product": "Assurance Vie", "situation": "Famille", "objection": "Je préfère investir directement moi-même en bourse ou dans la pierre plutôt que via une assurance vie.", "response": "Investir en direct, c'est bien, mais l'assurance vie offre un cadre vraiment avantageux pour le faire. Vous pouvez investir en unités de compte dans plein de fonds (actions, immobilier papier , etc.) sans vous soucier de la gestion administrative : pas d'imposition à chaque arbitrage, pas de complications de succession sur ces actifs. Tout est regroupé et géré de façon professionnelle. Et si un jour vous voulez changer de stratégie, vous arbitrez sans coût fiscal interne. En plus, avec l'assurance vie vous combinez divers placements dans un seul contrat facile à piloter . C'est la tranquillité d'esprit et l'optimisation fiscale en plus de l'investissement.", "punchline": "", "value": ""}, {"product": "Assurance Vie", "situation": "Famille", "objection": "Moi j'aime les placements sûrs comme le Livret A ou le PEL. L'assurance vie, ça me semble plus risqué ou complexe.", "response": "L'assurance vie peut être aussi sécuritaire que vous le souhaitez. Par exemple, vous pouvez mettre une grande part sur le fonds en euros garanti, qui rapporte en général plus qu'un Livret A sur le long terme tout en étant sans risque en capital. Et contrairement au PEL ou au3. 4. 5. 13 Livret, il n'y a pas de plafond de dépôt, vous pouvez placer de plus grosses sommes. En prime, la fiscalité de l'assurance vie au-delà de 8 ans est très douce, ce qui améliore le rendement net. Donc vous gardez la sécurité, mais avec du rendement et de la liberté en plus.", "punchline": "Aussi sûr qu'un Livret, plus performant sur la durée : l'assurance vie allie sécurité et efficacité.", "value": "Fonds en euros à capital garanti offrant une rémunération attractive sur la durée; aucun plafond de versement (épargnez à votre rythme sans limite); cadre fiscal avantageux après quelques années de détention."}, {"product": "Assurance Vie", "situation": "Famille", "objection": "Je n'y comprends rien à vos unités de compte, arbitrages… C'est trop compliqué pour moi.", "response": "Pas de souci, on est là pour ça ! Vous pouvez tout à fait opter pour une gestion simplifiée : soit 100 % fonds en euros sans vous préoccuper du reste, soit une gestion pilotée où nos experts s'occupent d'investir pour vous en fonction de votre profil. Vous définissez juste vos objectifs (sécuritaire ou plus dynamique) et on fait le travail. L'assurance vie peut être aussi simple qu'un livret une fois mise en place. Et vous recevez des comptes rendus clairs pour suivre l'évolution sans jargon incompréhensible.", "punchline": "", "value": ""}, {"product": "Assurance Vie", "situation": "Sénior", "objection": "J'ai plus de 70 ans, l'avantage fiscal pour la succession de l'assurance vie ne s'applique plus vraiment.", "response": "Il est vrai qu'après 70 ans, les nouveaux versements n'ont plus le gros abattement de 152 500 € par bénéficiaire. Cependant, les intérêts générés par ces versements restent exonérés de droits de succession, ce qui n'est pas négligeable. Et l'assurance vie garde d'autres atouts : vous pouvez toujours désigner précisément qui recevra l'argent et le versement aux bénéficiaires est rapide, sans attendre le règlement de toute la succession. À plus de 70 ans, l'assurance vie reste un excellent outil pour placer vos économies en profitant d'une fiscalité allégée sur les gains et en facilitant la transmission le moment venu.", "punchline": "Même après 70 ans, l'assurance vie vous donne un coup d'avance : moins d'impôts sur les gains et un héritage versé sans délai.", "value": "Gains futurs non taxés aux héritiers (seul le capital versé après 70 ans est compté pour les droits, pas les intérêts); clause bénéficiaire sur-mesure pour répartir votre patrimoine comme vous le souhaitez; versement rapide des fonds aux bénéficiaires (souvent en quelques semaines)."}, {"product": "Assurance Vie", "situation": "Sénior", "objection": "Je ne veux pas prendre de risques, si la bourse s'effondre je peux tout perdre.", "response": "Rien ne vous oblige à prendre des risques inconsidérés. Dans votre assurance vie, vous pouvez tout mettre sur des supports prudents. Par exemple, le fonds en euros garantit votre capital tout en générant des intérêts chaque année. Et même si vous voulez un peu plus de rendement, vous pouvez diversifier modestement sur des fonds très sécurisés (fonds obligataires, immobiliers stables). De plus, vous pouvez ajuster à tout moment si le contexte6. 7. 8. 14 change. En clair , l'assurance vie s'adapte à VOTRE profil : du plus prudent au plus audacieux, c'est vous qui fixez le curseur .", "punchline": "Zéro risque ou un soupçon de risque, c'est vous qui décidez : l'assurance vie s'adapte à votre tranquillité d'esprit.", "value": "Fonds en euros garantis pour une épargne sans risque; large choix de supports pour coller à votre tolérance au risque; possibilité de modifier la répartition à tout moment pour sécuriser si besoin."}, {"product": "Assurance Vie", "situation": "Sénior", "objection": "Je préfère donner de l'argent à mes enfants maintenant de mon vivant, plutôt que de le mettre sur une assurance vie.", "response": "Aider vos enfants de votre vivant, c'est super , mais gardez peut-être une poire pour la soif. L'assurance vie vous permet de rester maître de votre épargne : si vous en avez besoin, elle est là, et si tout va bien, ce sont vos enfants qui en hériteront plus tard. En plus, en passant par l'assurance vie, vous pouvez potentiellement transmettre davantage : par exemple, les sommes transmises via l'assurance vie bénéficient d'abattements fiscaux spécifiques, ce qui peut permettre à vos enfants de recevoir plus que via une donation classique taxée. En bref, vous ne vous privez pas aujourd'hui, et vous optimisez pour eux demain.", "punchline": "Donner oui, mais sans vous démunir : l'assurance vie concilie votre sécurité et leur futur .", "value": "Vous conservez la disponibilité de votre capital en cas de besoin; cadre fiscal transmission avantageux (abattements dédiés assurance vie en plus des donations classiques); possibilité de partager le capital plus équitablement ou progressivement selon vos souhaits."}, {"product": "Assurance Vie", "situation": "Sénior", "objection": "De toute façon, à la fin mes enfants paieront des impôts sur l'assurance vie, alors quel intérêt ?", "response": "En réalité, l'assurance vie est l'un des outils les plus avantageux pour transmettre un capital. Pour les versements effectués avant vos 70 ans, chaque bénéficiaire a droit à 152 500 € exemptés d'impôts, puis une taxation forfaitaire de 20 % (au-delà de montants très élevés) . C'est souvent bien moins que les droits de succession classiques qui peuvent monter à 30-40%. Concrètement, dans la plupart des cas, vos enfants ne paieront rien ou très peu sur l'assurance vie. Et vous pouvez désigner plusieurs bénéficiaires pour multiplier les abattements. L'intérêt, c'est donc que vos proches reçoivent plus, plus rapidement et en toute confidentialité.", "punchline": "Moins d'impôts, plus pour vos proches : l'assurance vie, c'est l'héritage optimisé.", "value": "Fiscalité ultra-avantageuse pour les bénéficiaires (surtout pour les sommes versées avant 70 ans); possibilité de diviser le capital entre plusieurs bénéficiaires pour optimiser les abattements; transmission directe hors notaire sur ces capitaux (versement simplifié et discret). Assurance Emprunteur"}, {"product": "Assurance Emprunteur", "situation": "Famille", "objection": "La banque m'oblige à prendre son assurance de prêt, je n'ai pas le choix.", "response": "Depuis quelques années, la loi vous permet de choisir librement votre assurance emprunteur . La banque n'a pas le droit d'imposer la sienne si vous trouvez moins cher ou mieux ailleurs. En pratique, beaucoup d'emprunteurs changent d'assurance pour économiser , tout en gardant la même protection . Vous avez donc tout à fait le choix de prendre une9. 10. 2 1. 3 3 4 15 assurance indépendante et souvent moins coûteuse.", "punchline": "Votre prêt, votre assurance, votre choix : la loi est de votre côté.", "value": "Liberté de choisir une assurance déléguée grâce à la législation (Loi Lagarde, Hamon, Lemoine); possibilité de réduire considérablement le coût de l'assurance tout en conservant les mêmes garanties; contrat sur-mesure adapté à votre profil plutôt qu'une offre standard de banque."}, {"product": "Assurance Emprunteur", "situation": "Famille", "objection": "Changer d'assurance de prêt, ça a l'air d'être la galère administrative.", "response": "Pas du tout. Nous nous occupons de presque tout pour vous. Concrètement, une fois que vous avez choisi notre contrat, on gère les démarches de résiliation de l'ancienne assurance et la mise en place de la nouvelle. La banque doit juste vérifier que les garanties sont équivalentes, ce qui est le cas avec notre offre. En quelques semaines tout est bouclé, sans interruption de couverture. Pour vous, c'est juste quelques papiers à signer et des économies à la clé.", "punchline": "On s'occupe de la paperasse, vous, vous profitez des économies : changer d'assurance, c'est facile.", "value": "Prise en charge complète du processus de changement (conseil, comparatif, démarches administratives); continuité de garantie assurée sans carence; simplicité et rapidité de la substitution (procédure standardisée avec les banques)."}, {"product": "Assurance Emprunteur", "situation": "Famille", "objection": "Je ne vais pas économiser grand-chose en changeant, ça vaut à peine le coup de s'embêter .", "response": "Ne sous-estimez pas les économies possibles : sur la durée restante de votre prêt, ça peut représenter des milliers d'euros. Par exemple, économiser 20 € par mois, c'est 240 € par an, et 2 400 € sur 10 ans, sans compter les intérêts. Pour un effort minime de changement, c'est de l'argent que vous gardez pour vous ou vos projets. Et même si l'économie était moindre, pourquoi payer plus cher pour la même protection ? Chaque euro gagné compte.", "punchline": "", "value": ""}, {"product": "Assurance Emprunteur", "situation": "Famille", "objection": "J'ai eu des problèmes de santé, j'ai peur qu'en changeant d'assurance on me refuse ou qu'on exclue des garanties.", "response": "On va étudier votre profil médical en toute confidentialité avant de lancer le changement. Il existe de nombreuses assurances emprunteur sur le marché, et certaines sont spécialisées pour couvrir des personnes avec des antécédents de santé, parfois sans surprime selon la situation. De plus, si votre prêt est de moins de 200 000 € et se termine avant vos 60 ans, la loi récente permet même de ne plus remplir de questionnaire de santé du tout ! On trouvera ensemble le meilleur contrat : soit avec des garanties identiques, soit on conclura qu'il vaut mieux garder l'actuel si c'est plus sûr pour vous. Dans tous les cas, vous ne prenez pas de risque à comparer .", "punchline": "Santé fragile ne veut pas dire assurance impossible : on cherche pour vous la couverture adaptée, sans risque pour votre prêt.2. 3. 4. 5 16", "value": "Solutions d'assurance emprunteur inclusives (contrats spécialisés et loi Lemoine supprimant le questionnaire médical sous conditions); analyse préalable gratuite de votre dossier médical; garantie de n'opérer le changement que si les nouvelles conditions sont bénéfiques et conformes."}, {"product": "Assurance Emprunteur", "situation": "Famille", "objection": "Mon assurance actuelle ne me pose pas de problème, j'ai un peu la flemme de changer .", "response": "C'est justement parce qu'elle ne pose pas de problème que c'est le bon moment pour voir si on peut trouver mieux ! Vous n'attendez pas d'avoir un souci pour agir , vous le faites par opportunité. En plus, on a rendu le changement très simple pour vous. Pensez aux économies ou aux garanties supplémentaires que vous pourriez obtenir sans effort. Vous pourriez, par exemple, payer moins cher tout en étant couvert sur une plus longue durée ou avec moins d'exclusions. Ça vaut le coup de regarder , non ?", "punchline": "", "value": ""}, {"product": "Assurance Emprunteur", "situation": "Sénior", "objection": "J'ai passé 60 ans, je pense que c'est trop tard pour changer d'assurance de prêt.", "response": "Il existe des assureurs qui couvrent les emprunteurs jusqu'à un âge avancé, parfois même 85 ans en fin de prêt. Si votre prêt court encore quelques années, on peut tout à fait étudier une reprise par un nouveau contrat. Souvent, la banque applique des tarifs élevés aux seniors, alors qu'en face on peut trouver mieux calibré. Et si votre santé est bonne, il n'y a aucune raison de continuer à payer le tarif fort. On adapte la couverture à votre âge et vos besoins réels, sans payer des garanties inutiles. Vous pourriez être agréablement surpris des économies réalisables même après 60 ans.", "punchline": "Tant que votre prêt court, il n'est jamais trop tard pour assurer moins cher et mieux.", "value": "Contrats disponibles pour emprunteurs seniors (avec couverture décès possible jusqu'à 85 ans); ajustement des garanties (par exemple suppression de l'incapacité de travail si vous êtes retraité, ce qui baisse le coût); économies potentielles importantes sur la fin de prêt où les capitaux restants sont plus faibles."}, {"product": "Assurance Emprunteur", "situation": "Sénior", "objection": "Il ne reste que quelques années sur mon prêt, ce n'est pas la peine de changer d'assurance maintenant.", "response": "Même sur les dernières années, payer moins cher votre assurance, c'est bon à prendre ! Si, par exemple, il vous reste 5 ans de prêt et que vous économisez 15 € par mois, ça fait quand même près de 900 € d'économies au total. Et la démarche de changement ne vous coûte rien. Par ailleurs, en fin de prêt, les garanties peuvent être adaptées : si vous êtes déjà à la retraite, on peut retirer la couverture perte d'emploi par exemple, que vous payez peut-être inutilement. Donc oui, ça vaut le coup de regarder , surtout qu'en quelques semaines c'est réglé.", "punchline": "Il n'y a pas de petite économie : en fin de prêt aussi, allégez vos cotisations et finissez de payer avec le sourire.", "value": "Adaptation des garanties aux dernières années de prêt (arrêt de certaines couvertures non pertinentes, ce qui réduit la prime); calcul transparent des gains potentiels sur5. 6. 7. 17 la période restante; aucune pénalité de changement en cours de contrat (changement désormais possible à tout moment)."}, {"product": "Assurance Emprunteur", "situation": "Sénior", "objection": "J'ai peur qu'en changeant d'assurance, je sois moins bien couvert ou qu'il y ait des clauses cachées.", "response": "Votre vigilance est légitime. C'est pour ça qu'on ne vous proposera un nouveau contrat que si toutes les garanties indispensables sont au moins équivalentes à votre contrat actuel. On passe en revue point par point (décès, invalidité, incapacité) pour s'assurer que vous ne perdez rien. En fait, on cherche souvent à vous faire gagner : par exemple, des exclusions en moins ou des options en plus (prise en charge plus longue, couverture des maladies dorsales, etc.). Et bien sûr , tout est transparent dans les conditions. Vous aurez en main le détail noir sur blanc avant de décider . Pas de mauvaise surprise, juste de bonnes surprises !", "punchline": "", "value": ""}, {"product": "Assurance Emprunteur", "situation": "Famille", "objection": "Si je change d'assurance, la banque risque de mal le prendre et de compliquer les choses.", "response": "La banque n'a pas le droit de modifier les conditions de votre prêt parce que vous changez d'assurance. C'est encadré par la loi : aucune augmentation de taux ou frais additionnels ne peuvent être appliqués du fait du changement. Et aujourd'hui, les banques sont habituées, de nombreux clients le font. Au pire, elles vont vous demander un document ou deux, mais nous vous accompagnons pour fournir tout ce qu'il faut. Votre dossier de prêt reste inchangé, vous faites juste jouer la concurrence sur l'assurance, ce qui est votre droit le plus strict.", "punchline": "", "value": ""}, {"product": "Assurance Emprunteur", "situation": "Famille", "objection": "Cette assurance de prêt coûte cher , j'aimerais m'en passer .", "response": "Je comprends, c'est un coût en plus. Mais il faut la voir comme la protection de votre foyer . Si un coup dur vous arrive (décès ou invalidité), sans assurance, votre famille devrait payer le crédit à votre place ou vendre la maison. Avec l'assurance, le prêt est remboursé et vos proches gardent le toit familial sans dette. C'est une sécurité indispensable pour un investissement aussi important qu'une maison. D'ailleurs, la banque l'exige justement pour se protéger ET vous protéger . Mieux vaut payer une cotisation maîtrisée et être tranquille, plutôt que de prendre le risque de tout perdre en cas de malheur .", "punchline": "On assure bien la maison elle-même, pourquoi pas le crédit qui la finance ? Mieux vaut perdre quelques euros que sa maison.", "value": "Protection totale de la famille en cas de décès/invalidité de l'emprunteur (le bien8. 9. 10. 18 est conservé sans dette); tranquillité d'esprit pendant toute la durée du prêt; contrat ajustable pour optimiser le coût tout en respectant les exigences (choix des garanties adaptées à la situation familiale). Assurance Obsèques"}, {"product": "Assurance Obsèques", "situation": "Famille", "objection": "Je suis trop jeune pour penser à mes obsèques. On verra plus tard quand je serai vieux.", "response": "On espère tous vivre très longtemps ! Mais un accident ou une maladie peuvent malheureusement survenir à tout âge. Souscrire tôt, ce n'est pas être pessimiste, c'est justement profiter de sa jeunesse pour payer de toutes petites cotisations et être tranquille pour des décennies. En plus, plus on s'y prend jeune, plus c'est facile à financer sans s'en apercevoir . Et si, Dieu vous préserve, il arrivait quelque chose, vos proches n'auraient rien à gérer financièrement. Vous gagnez en sérénité et vos proches aussi, quoi qu'il arrive.", "punchline": "La tranquillité d'esprit n'attend pas le nombre des années : prévoir tôt, c'est être serein longtemps.", "value": "Cotisation réduite lorsqu'on souscrit jeune; capital garanti dès le premier jour (même en cas de décès prématuré, le service est assuré); soulagement anticipé pour la famille, sans attendre un âge avancé pour se poser la question."}, {"product": "Assurance Obsèques", "situation": "Famille", "objection": "J'ai le temps, je penserai à tout ça plus tard. Pour l'instant j'ai d'autres priorités.", "response": "C'est normal d'avoir d'autres priorités. Justement, l'assurance obsèques, une fois mise en place, vous n'avez plus à y penser . C'est une chose de réglée, qui ne vous empêchera pas de vivre vos priorités actuelles. Et plus tard arrive plus vite qu'on ne croit : prévoir maintenant, c'est éviter à vos proches de devoir gérer cela dans l'urgence ou dans un moment difficile. En faisant ce petit effort maintenant, vous vous libérez l'esprit pour la suite.", "punchline": "Prévoir l'inévitable aujourd'hui, pour se consacrer pleinement à la vie dès maintenant.", "value": "Démarche ponctuelle (un contrat et on n'en parle plus); évite une organisation précipitée et stressante au dernier moment; assure que tout sera prêt quand le moment viendra, sans perturber la vie actuelle."}, {"product": "Assurance Obsèques", "situation": "Famille", "objection": "Au lieu de payer une assurance, je peux mettre de l'argent de côté sur un livret, ça reviendra au même.", "response": "Mettre de l'argent de côté, c'est bien, mais en cas de décès prématuré, aurez-vous eu le temps d'épargner assez ? L'assurance obsèques, elle, garantit dès la souscription le capital nécessaire, même si vous n'avez payé qu'une partie. De plus, cet argent est spécifiquement réservé aux funérailles et disponible immédiatement pour vos proches, alors que votre livret pourrait être bloqué le temps de la succession. C'est une sécurité en plus : vous épargnez sans risque que l'effort ne serve à rien, et vos proches n'auront aucune démarche financière à faire.", "punchline": "Épargner soi-même prend du temps, l'assurance obsèques protège vos proches tout de suite.", "value": "Protection immédiate (capital versé quels que soient les versements effectués); fonds débloqués rapidement pour payer les frais funéraires; capital dédié qui ne peut pas être utilisé à autre chose ou saisi par l'héritage avant le paiement des obsèques.1. 2. 3. 19"}, {"product": "Assurance Obsèques", "situation": "Famille", "objection": "J'ai déjà une assurance vie (ou décès), ça couvrira les frais d'obsèques.", "response": "C'est bien d'avoir une assurance vie/décès, mais le contrat obsèques a l'avantage d'être spécifiquement conçu pour ce moment-là. D'abord, le capital obsèques est versé très rapidement aux pompes funèbres ou aux bénéficiaires pour régler les frais, souvent en 48h, alors qu'une assurance vie peut prendre un peu plus de temps à se débloquer . Ensuite, avec l'assurance obsèques vous pouvez organiser vos volontés funéraires à l'avance : choix de crémation ou inhumation, type de cérémonie… Ce n'est pas possible avec une assurance vie classique. En somme, votre assurance vie aidera financièrement vos proches, mais l'assurance obsèques les décharge de toute préoccupation liée à l'organisation et au financement de vos funérailles.", "punchline": "Assurance vie pour les leurs, assurance obsèques pour le dernier adieu : deux soutiens complémentaires pour vos proches.", "value": "Versement express du capital au moment du décès (pas d'attente prolongée); services d'assistance et respect des volontés funéraires intégrés; évite d'entamer le capital destiné à la vie courante des proches (l'assurance vie reste pour eux, l'obsèques couvre le rite final)."}, {"product": "Assurance Obsèques", "situation": "Famille", "objection": "Je n'ai pas besoin de planifier ça, ma famille se débrouillera bien le moment venu.", "response": "Votre famille fera certainement de son mieux, mais ce sera un moment très éprouvant pour eux. En planifiant à l'avance, vous leur évitez de prendre des décisions difficiles sous le choc et de porter le poids financier des funérailles. C'est un dernier service que vous leur rendez : ils pourront se consacrer au recueillement sans se demander qui paiera quoi, ni quelles étaient vos volontés. C'est une preuve d'amour de plus que vous leur donnez en facilitant les choses.", "punchline": "Épargner à sa famille des soucis le jour venu, c'est l'ultime preuve d'amour .", "value": "Soulagement du fardeau organisationnel et financier pour la famille; assurance que vos volontés seront respectées (vous pouvez les formuler à l'avance); évite tensions familiales potentielles sur les choix ou les dépenses."}, {"product": "Assurance Obsèques", "situation": "Sénior", "objection": "J'ai déjà mis de l'argent de côté exprès pour mes funérailles, dans un compte épargne.", "response": "C'est une bonne précaution. Toutefois, sachez qu'un compte épargne peut être bloqué au moment du décès, alors que l'assurance obsèques garantit un versement immédiat pour régler les frais. Par ailleurs, avez-vous pu estimer si l'argent mis de côté suffira dans X années, en tenant compte de l'augmentation des coûts funéraires ? Notre contrat peut être indexé pour suivre l'inflation des obsèques. Et surtout, il apporte un service d'assistance : vos proches n'auront pas à courir partout, un conseiller les accompagnera pour tout organiser selon vos souhaits. Votre épargne est utile, mais l'assurance apporte en plus la simplicité et la certitude.", "punchline": "De l'argent de côté, c'est bien. Accompagné d'un contrat obsèques, c'est mieux : vos économies + notre assistance = tranquillité totale.", "value": "Capital revalorisé pour maintenir son pouvoir d'achat face à l'augmentation du coût des obsèques; assistance organisationnelle professionnelle pour les proches; garantie contractuelle que le financement des funérailles est opérationnel immédiatement.4. 5. 6. 20"}, {"product": "Assurance Obsèques", "situation": "Sénior", "objection": "J'ai déjà souscrit un contrat obsèques il y a des années.", "response": "Très bien, vous avez eu raison. Il peut toutefois être utile de le réévaluer : les coûts des funérailles augmentent avec le temps. Le capital prévu il y a 15 ans sera-t-il suffisant aujourd'hui ? Nous proposons de vérifier gratuitement si votre couverture correspond toujours à vos volontés et aux tarifs actuels. Parfois, on conseille de l'ajuster ou de le compléter légèrement pour combler l'écart. Et puis, les contrats ont évolué : les nouveaux incluent par exemple plus de services d'accompagnement administratif pour la famille. En faisant un point, vous vous assurez que tout est toujours optimal.", "punchline": "Un contrat obsèques, ça se garde à jour comme un carnet de santé : vérifiez, ajustez, et restez serein.", "value": "Audit offert de la solution existante (vérification du capital par rapport aux coûts actuels); possibilité d'améliorer la prestation (ajout de services d'assistance modernes, revalorisation du capital); complément souple si nécessaire sans repartir de zéro."}, {"product": "Assurance Obsèques", "situation": "Sénior", "objection": "Si je vis très longtemps, je risque de payer beaucoup plus que le coût de mes obsèques au final.", "response": "Avec nos formules, vous pouvez justement éviter cela. Par exemple, vous pouvez opter pour une cotisation sur 10 ou 15 ans seulement : une fois cette période payée, vous êtes couvert à vie, même si vous vivez jusqu'à 100 ans, sans cotiser au-delà. Et si vous préférez cotiser un peu chaque mois à vie, gardez en tête que votre capital est revalorisé, et que vous payez pour la tranquillité d'esprit. Quoi qu'il en soit, on peut adapter le mode de cotisation pour qu'il soit équitable. Le but n'est pas de payer indéfiniment, c'est de garantir la somme voulue au bon moment, au meilleur coût.", "punchline": "Vivez aussi longtemps que le destin vous le donne : vous aurez payé le juste prix, ni plus ni moins, pour que tout soit réglé.", "value": "Choix du mode de cotisation (viagère ou temporaire) en fonction de l'âge et des préférences; option de primes temporaires pour ne plus rien payer passé un certain âge; revalorisation du capital pour correspondre aux frais réels le moment venu."}, {"product": "Assurance Obsèques", "situation": "Sénior", "objection": "Je préfère prendre un contrat obsèques directement chez un opérateur funéraire, au moins tout sera planifié avec eux.", "response": "Les contrats obsèques en prestations chez les pompes funèbres sont bien, mais ils vous lient à un prestataire unique. Avec notre assurance obsèques, vous pouvez tout planifier aussi (choix de crémation/inhumation, cérémonie...), et au moment venu vos proches auront la liberté de choisir l'entreprise de pompes funèbres qui convient le mieux (proximité, réputation). Le capital sera versé à celle qu'ils choisiront. C'est plus flexible : si l'entreprise funéraire initiale n'existe plus dans 20 ans ou si vous déménagez loin, pas de souci, l'assurance s'adapte. Vous avez la planification ET la liberté.", "punchline": "Planifiez vos obsèques sans vous lier les mains : votre assurance vous suit où que vous soyez, avec qui que ce soit.", "value": "Liberté de choix du prestataire au moment du décès (pas de dépendance à un acteur unique); possibilité d'exprimer ses volontés à l'avance autant qu'avec un contrat en prestations; garantie financière utilisable par n'importe quelle société de pompes funèbres, ce qui protège contre les aléas (changement de région, évolution du marché funéraire).7. 8. 9. 21"}, {"product": "Assurance Obsèques", "situation": "Sénior", "objection": "Franchement, je ne veux même pas penser à tout ça. C'est trop déprimant.", "response": "Je comprends tout à fait. C'est difficile d'aborder ce sujet. Mais dites-vous que faire ce geste maintenant, c'est vous libérer l'esprit ensuite. Une fois l'organisation financière réglée, vous n'aurez plus besoin d'y penser du tout, vous pouvez profiter de la vie en étant soulagé de savoir que ce moment, quand il viendra le plus tard possible, ne causera pas de soucis à vos proches. On fait ça une fois, puis on n'en parle plus. Vous pourrez aborder chaque jour avec la tranquillité d'esprit que tout est prévu.", "punchline": "Prévoir ses obsèques, c'est un peu comme écrire un testament d'amour : on le fait une fois, puis on profite du reste de sa vie l'esprit léger .", "value": "Démarche unique et ensuite plus besoin d'y revenir; allègement du souci moral pour l'assuré (il sait que tout est pris en charge); accompagnement humain et bienveillant lors de la souscription pour rendre le processus aussi doux que possible. Les raisons de ne pas ouvrir un Plan Epargne Retraite - Meilleurtaux Placement https://placement.meilleurtaux.com/retraite/actualites/2024-octobre/objections-per-les-raisons-de-ne-pas-ouvrir-un-plan- epargne-retraite.html Comment fonctionne l’assurance vie en cas de décès du souscripteur ? | CNP Assurances https://www.cnp.fr/particuliers/le-mag/comment-fonctionne-l-assurance-vie-en-cas-de-deces-du-souscripteur Achat immobilier : pouvez-vous changer d’assurance emprunteur ? | Ministère de l’Économie des Finances et de la Souveraineté industrielle et numérique https://www.economie.gouv.fr/particuliers/emprunter-et-sassurer/achat-immobilier-pouvez-vous-changer-dassurance- emprunteur Assurance emprunteur : questionnaire de santé, quand est-ce obligatoire ? | Ministère de l’Économie des Finances et de la Souveraineté industrielle et numérique https://www.economie.gouv.fr/particuliers/emprunter-et-sassurer/assurance-emprunteur-questionnaire-de-sante-quand- est-ce10. 1 2 3 4 5 22"}];

  const $ = sel => root.querySelector(sel);
  const els = {
    q: $('.q'),
    prod: $('.prod'),
    sit: $('.sit'),
    add: $('.add'),
    importBtn: $('.import'),
    exportBtn: $('.export'),
    resetBtn: $('.reset'),
    cards: root.querySelector('.cards')
  };

  const STORAGE_KEY = 'arg.cards.v1';
  function loadCards(){
    try{
      const j = localStorage.getItem(STORAGE_KEY);
      if(j){ const arr = JSON.parse(j); if(Array.isArray(arr)) return arr; }
    }catch(e){}
    localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA_FROM_PDF));
    return DATA_FROM_PDF.slice();
  }
  function saveCards(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

  let cards = loadCards();

  function fillFilters(){
    const products = Array.from(new Set(cards.map(c=>c.product))).filter(Boolean).sort();
    els.prod.innerHTML = ['<option value="">Tous produits</option>'].concat(products.map(p=>`<option>${p}</option>`)).join('');
    const situations = Array.from(new Set(cards.map(c=>c.situation))).filter(Boolean).sort();
    els.sit.innerHTML = ['<option value="">Toutes situations</option>'].concat(situations.map(s=>`<option>${s}</option>`)).join('');
  }

  function esc(s){ return String(s||'').replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]||c)); }

  function render(){
    const q = (els.q.value||'').toLowerCase();
    const prod = els.prod.value||'';
    const sit = els.sit.value||'';
    const filtered = cards.filter(c=>{
      const hay = (c.product+' '+c.situation+' '+c.objection+' '+c.response+' '+c.punchline+' '+c.value).toLowerCase();
      if(q && !hay.includes(q)) return false;
      if(prod && c.product !== prod) return false;
      if(sit && c.situation !== sit) return false;
      return true;
    });
    els.cards.innerHTML = filtered.map((c,idx)=>`
      <article class="card" data-idx="${idx}" style="display:flex; flex-direction:column; gap:8px">
        <div class="row" style="justify-content:space-between; align-items:center">
          <div style="display:flex; gap:6px; flex-wrap:wrap">
            <span class="badge">${esc(c.product)}</span>
            <span class="badge">${esc(c.situation)}</span>
          </div>
          <div class="actions">
            <button class="btn btn-ghost edit" data-idx="${idx}">✏️ Modifier</button>
            <button class="btn btn-danger del" data-idx="${idx}">🗑 Supprimer</button>
          </div>
        </div>
        <div>
          <div class="small" style="opacity:.8; text-transform:uppercase; letter-spacing:.08em">Objection</div>
          <div style="font-weight:700">${esc(c.objection)}</div>
        </div>
        <div>
          <div class="small" style="opacity:.8; text-transform:uppercase; letter-spacing:.08em">Réponse</div>
          <div class="details">${esc(c.response)}</div>
        </div>
        <div>
          <div class="small" style="opacity:.8; text-transform:uppercase; letter-spacing:.08em">Punchline</div>
          <div style="font-style:italic">${esc(c.punchline)}</div>
        </div>
        <div>
          <div class="small" style="opacity:.8; text-transform:uppercase; letter-spacing:.08em">Valeur ajoutée</div>
          <div class="details">${esc(c.value)}</div>
        </div>
      </article>
    `).join('');
  }

  function promptCard(initial){
    const base = Object.assign({product:'', situation:'', objection:'', response:'', punchline:'', value:''}, initial||{});
    const product = prompt('Produit (ex: Santé, GAV, Décès, PER, AV, Obsèques, Emprunteur)', base.product); if(product===null) return null;
    const situation = prompt('Situation (ex: Famille, Sénior, Jeune)', base.situation); if(situation===null) return null;
    const objection = prompt('Objection', base.objection); if(objection===null) return null;
    const response = prompt('Réponse', base.response); if(response===null) return null;
    const punchline = prompt('Punchline', base.punchline||''); if(punchline===null) return null;
    const value = prompt('Valeur ajoutée (points clés)', base.value||''); if(value===null) return null;
    return {product:product.trim(), situation:situation.trim(), objection:objection.trim(), response:response.trim(), punchline:(punchline||'').trim(), value:(value||'').trim()};
  }

  els.cards.addEventListener('click', (e)=>{
    const b = e.target.closest('button'); if(!b) return;
    const idx = Number(b.dataset.idx);
    if(b.classList.contains('del')){
      if(confirm('Supprimer cette carte ?')){ cards.splice(idx,1); saveCards(cards); render(); fillFilters(); }
    }else if(b.classList.contains('edit')){
      const edited = promptCard(cards[idx]);
      if(edited){ cards[idx] = edited; saveCards(cards); render(); fillFilters(); }
    }
  });

  els.add.addEventListener('click', ()=>{
    const c = promptCard({product: els.prod.value||'', situation: els.sit.value||''});
    if(c){ cards.unshift(c); saveCards(cards); render(); fillFilters(); }
  });

  els.exportBtn && els.exportBtn.addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(cards, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'argumentaires_cartes.json'; a.click(); URL.revokeObjectURL(url);
  });

  els.importBtn && els.importBtn.addEventListener('click', ()=>{
    const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
    inp.onchange = async () => {
      const f = inp.files && inp.files[0]; if(!f) return;
      try{ const text = await f.text(); const arr = JSON.parse(text); if(!Array.isArray(arr)) throw new Error('JSON invalide');
        cards = arr.map(x => ({ product:String(x.product||'').trim(), situation:String(x.situation||'').trim(), objection:String(x.objection||'').trim(), response:String(x.response||'').trim(), punchline:String(x.punchline||'').trim(), value:String(x.value||'').trim() }));
        saveCards(cards); fillFilters(); render();
      }catch(err){ alert('Import JSON impossible: ' + err); }
    };
    inp.click();
  });

  els.resetBtn && els.resetBtn.addEventListener('click', ()=>{
    if(confirm('Réinitialiser la bibliothèque avec les cartes PDF d’origine ? Toutes vos modifications locales seront perdues.')){
      cards = DATA_FROM_PDF.slice(); saveCards(cards); fillFilters(); render();
    }
  });

  [els.q, els.prod, els.sit].forEach(el => el && el.addEventListener('input', render));

  fillFilters();
  render();
}


/* ===== Bilan Prévoyance (jeu de plateau) ===== */
function buildBilanPanel(){
  const root = document.getElementById('bilan');
  root.innerHTML = `
  <div class="grid">
    <section class="card" style="grid-column: span 12">
      <h3 class="section-title">Bilan Prévoyance — "château & attaques"</h3>
      <div class="row" style="gap:8px; flex-wrap:wrap">
        <input class="fam" placeholder="Profil famille (ex: marié, 2 enfants, revenus 3k€)" style="min-width:320px" />
        <button class="btn btn-ghost capture">Capturer</button>
        <button class="btn btn-ghost export">Export PDF</button>
        <button class="btn btn-ghost reset">Reset</button>
      </div>
      <div class="hr"></div>

      <div class="board" style="display:grid; grid-template-columns: 1fr 1fr; gap:12px">
        <div class="castle card" style="min-height:320px; border:2px dashed var(--border);">
          <h4>Zone Client (intérieur du château)</h4>
          <div class="drop inside" style="min-height:220px; display:flex; flex-wrap:wrap; gap:8px; align-content:flex-start"></div>
        </div>
        <div class="field card" style="min-height:320px;">
          <h4>Attaques de la vie (extérieur)</h4>
          <div class="threats" style="display:flex; flex-wrap:wrap; gap:8px"></div>
        </div>
      </div>

      <div class="hr"></div>
      <div class="row" style="gap:8px; flex-wrap:wrap">
        <div class="card" style="flex:1">
          <h4>Défenses disponibles</h4>
          <div class="defenses" style="display:flex; flex-wrap:wrap; gap:8px"></div>
        </div>
        <div class="card" style="flex:1">
          <h4>Résumé des gaps</h4>
          <div class="gaps"></div>
        </div>
      </div>
    </section>
  </div>`;

  const threats = [
    {id:'accident', label:'Accident'},
    {id:'maladie', label:'Maladie grave'},
    {id:'deces', label:'Décès'},
    {id:'invalidite', label:'Invalidité'},
    {id:'dependance', label:'Perte d’autonomie'},
    {id:'hospitalisation', label:'Hospitalisation coûteuse'}
  ];

  const defenses = [
    {id:'sante', label:'Complémentaire Santé'},
    {id:'gav', label:'GAV'},
    {id:'deces', label:'Assurance Décès'},
    {id:'obs', label:'Obsèques'},
    {id:'av', label:'Assurance Vie'},
    {id:'per', label:'PER'},
    {id:'epargne', label:'Épargne dispo'},
    {id:'revenu', label:'Revenus du foyer'}
  ];

  const dropInside = root.querySelector('.drop.inside');
  const elThreats = root.querySelector('.threats');
  const elDefs = root.querySelector('.defenses');
  const elGaps = root.querySelector('.gaps');

  function pill(text, cls){
    const d = document.createElement('div');
    d.textContent = text;
    d.className = 'pill ' + (cls||'');
    d.draggable = true;
    d.style.cssText = 'border:1px solid var(--border); border-radius:9999px; padding:6px 10px; cursor:grab; user-select:none;';
    d.addEventListener('dragstart', e => { e.dataTransfer.setData('text/plain', text); e.dataTransfer.setData('type', cls||''); });
    return d;
  }

  // Render threats & defenses
  threats.forEach(t => elThreats.appendChild(pill(t.label, 'threat '+t.id)));
  defenses.forEach(d => elDefs.appendChild(pill(d.label, 'def '+d.id)));

  // Drag & drop support
  ;[dropInside, elDefs, elThreats].forEach(zone => {
    zone.addEventListener('dragover', e => { e.preventDefault(); zone.style.background='rgba(0,0,0,0.03)'; });
    zone.addEventListener('dragleave', ()=> zone.style.background='');
    zone.addEventListener('drop', e => {
      e.preventDefault(); zone.style.background='';
      const txt = e.dataTransfer.getData('text/plain');
      const node = pill(txt, e.dataTransfer.getData('type'));
      zone.appendChild(node);
      updateGaps();
    });
  });

  // Simple coverage rules
  function has(label){
    return Array.from(dropInside.querySelectorAll('.pill')).some(p => p.textContent===label);
  }

  function updateGaps(){
    const cov = {
      accident: has('GAV'),
      maladie: has('Complémentaire Santé'),
      deces: has('Assurance Décès') || has('Assurance Vie'),
      invalidite: has('GAV') || has('Assurance Décès'),
      dependance: has('Assurance Décès') || has('Épargne dispo'),
      hospitalisation: has('Complémentaire Santé') && has('Épargne dispo')
    };
    const items = threats.map(t => {
      const ok = cov[t.id];
      return `<div class="row" style="justify-content:space-between">
        <div>${t.label}</div>
        <div class="badge" style="background:${ok?'var(--ok)':'var(--warn)'}">${ok?'Couvert':'Gap'}</div>
      </div>`;
    }).join('');
    elGaps.innerHTML = items + `<div class="small" style="margin-top:8px;opacity:.7">Règles simplifiées. À affiner avec l’argumentaire.</div>`;
  }

  // Capture & export (via html2canvas + jsPDF si dispo)
  root.querySelector('.capture').addEventListener('click', async ()=>{
    if(window.html2canvas){
      const shotTarget = root.querySelector('.board');
      const canvas = await html2canvas(shotTarget);
      const img = canvas.toDataURL('image/png');
      const w = window.open(''); w.document.write('<img src="'+img+'" style="width:100%">');
    }else{
      alert('html2canvas non chargé (capture non disponible hors-ligne).');
    }
  });

  root.querySelector('.export').addEventListener('click', async ()=>{
    if(window.jspdf && window.html2canvas){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({unit:'pt', format:'a4'});
      const board = root.querySelector('.board');
      const canvas = await html2canvas(board);
      const img = canvas.toDataURL('image/png');
      const pageW = doc.internal.pageSize.getWidth();
      const pageH = doc.internal.pageSize.getHeight();
      const aspect = canvas.width / canvas.height;
      const imgW = pageW - 40, imgH = imgW / aspect;
      doc.text('Bilan Prévoyance — Avant/Après', 40, 40);
      doc.addImage(img, 'PNG', 20, 60, imgW, imgH);
      doc.save('bilan_prevoyance.pdf');
    }else{
      alert('jsPDF/html2canvas non chargés (export indisponible hors connexion CDN).');
    }
  });

  root.querySelector('.reset').addEventListener('click', ()=>{
    dropInside.innerHTML=''; updateGaps();
  });

  updateGaps();
}




/* ===== PER — Simulateur (intégré) ===== */
function buildPERPanel(){
  const root = document.getElementById('per');
  if(!root) return;
  root.innerHTML = `
    <div class="grid">
      <section class="card" style="grid-column: span 12">
        <div class="row" style="justify-content:space-between; align-items:center">
          <h3 class="section-title">Simulateur PER — Pro+</h3>
          <span class="small">Chargé via fichier externe (même dossier) • recommandé pour l'hébergement en ligne</span>
        </div>
        <div class="small" id="per-status" style="opacity:.8;margin-bottom:8px">Vérification du fichier…</div>
        <div style="height:1600px; border:1px solid var(--border); border-radius:12px; overflow:hidden; background:#0b1020">
          <iframe id="per-sim" title="Simulateur PER" style="width:100%; height:100%; border:0; background:#0b1020"></iframe>
        </div>
        <div class="row" style="margin-top:10px">
          <a id="per-direct-link" class="btn" href="#" target="_blank" rel="noopener">Ouvrir le simulateur PER dans un nouvel onglet</a>
        </div>
      </section>
    </div>`;
  const perPath = './Simulateur_PER_ProPlus_v5_4_topoUnder_fixSortie.html';
  const statusEl = document.getElementById('per-status');
  const linkEl = document.getElementById('per-direct-link');
  linkEl.href = perPath;
  const fram = document.getElementById('per-sim');
  (async () => {
    try {
      const r = await fetch(perPath, { method: 'HEAD' });
      if (!r.ok) throw new Error('HTTP ' + r.status);
      statusEl.textContent = 'Chargement du simulateur…';
      fram.src = perPath;
    } catch (err) {
      statusEl.innerHTML = 'Impossible de charger le simulateur PER. ' +
        'Vérifiez que le fichier <code>Simulateur_PER_ProPlus_v5_4_topoUnder_fixSortie.html</code> ' +
        'se trouve au <b>même niveau</b> que <code>index.html</code> et que le nom est <b>exact</b>.' +
        '<br>Erreur : ' + String(err);
      const tips = document.createElement('div');
      tips.className = 'small';
      tips.style.marginTop = '8px';
      tips.innerHTML = '<ul>' +
        '<li>Dans GitHub → Code, vérifiez que vous voyez bien les 2 fichiers côte à côte.</li>' +
        '<li>Sur la page, essayez d’ouvrir le lien ci-dessus “Ouvrir le simulateur PER…” : si 404, le fichier manque ou le nom diffère.</li>' +
        '<li>Si vous venez de l’ajouter, attendez 30–60 s que GitHub Pages se mette à jour.</li>' +
        '</ul>';
      root.querySelector('section.card').appendChild(tips);
      console.error(err);
    }
  })();
}
/* ===== Assurance Vie — Simulateur (intégré) ===== */
function buildAVPanel(){
  const root = document.getElementById('av');
  root.innerHTML = `
    <div class="grid">
      <section class="card" style="grid-column: span 12">
        <h3 class="section-title">Simulateur Assurance Vie — Comparatif & Trajectoire</h3>
        <div class="small" style="opacity:.8;margin-bottom:8px">Chargement du simulateur intégré…</div>
        <div style="height:820px; border:1px solid var(--border); border-radius:12px; overflow:hidden; background:#0b1020">
          <iframe id="av-sim" title="Simulateur AV" style="width:100%; height:100%; border:0; background:#0b1020"></iframe>
        </div>
      </section>
    </div>`;
  try {
    const doc = document.getElementById('av-sim');
    // Use data URL to keep single-file packaging
    doc.src = 'data:text/html;base64,PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImZyIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0iVVRGLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xIiAvPgogIDx0aXRsZT5TaW11bGF0ZXVyIGQnw4lwYXJnbmUg4oCUIFBybys8L3RpdGxlPgoKICA8IS0tIEZvbnRzICYgSWNvbnMgLS0+CiAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1JbnRlcjp3Z2h0QDQwMDs1MDA7NjAwOzcwMCZkaXNwbGF5PXN3YXAiIHJlbD0ic3R5bGVzaGVldCI+CgogIDwhLS0galF1ZXJ5ICYgU2VsZWN0MiAtLT4KICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jb2RlLmpxdWVyeS5jb20vanF1ZXJ5LTMuNi4wLm1pbi5qcyI+PC9zY3JpcHQ+CiAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9zZWxlY3QyQDQuMS4wLXJjLjAvZGlzdC9jc3Mvc2VsZWN0Mi5taW4uY3NzIiByZWw9InN0eWxlc2hlZXQiIC8+CiAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vc2VsZWN0MkA0LjEuMC1yYy4wL2Rpc3QvanMvc2VsZWN0Mi5taW4uanMiPjwvc2NyaXB0PgoKICA8IS0tIENoYXJ0LmpzIC0tPgogIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2NoYXJ0LmpzQDQuNC4wL2Rpc3QvY2hhcnQudW1kLm1pbi5qcyI+PC9zY3JpcHQ+CgogIDwhLS0ganNQREYgJiBodG1sMmNhbnZhcyAtLT4KICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvanNwZGYvMi41LjEvanNwZGYudW1kLm1pbi5qcyI+PC9zY3JpcHQ+CiAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2pzcGRmLWF1dG90YWJsZS8zLjguMi9qc3BkZi5wbHVnaW4uYXV0b3RhYmxlLm1pbi5qcyI+PC9zY3JpcHQ+CiAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2h0bWwyY2FudmFzLzEuNC4xL2h0bWwyY2FudmFzLm1pbi5qcyI+PC9zY3JpcHQ+CgogIDxzdHlsZT4KICAgIDpyb290IHsKICAgICAgLS1iZzogIzBiMTAyMDsKICAgICAgLS1zdXJmYWNlOiAjMTAxNjJiOwogICAgICAtLW11dGVkOiAjNDc1NTY5OwogICAgICAtLXRleHQ6ICNlOGVkZjc7CiAgICAgIC0tYnJhbmQ6ICMyZGQ0YmY7IC8qIHRlYWwtNDAwICovCiAgICAgIC0tYnJhbmQtMjogI2ZiYmYyNDsgLyogYW1iZXItNDAwICovCiAgICAgIC0tb2s6ICMyMmM1NWU7CiAgICAgIC0td2FybjogI2Y1OWUwYjsKICAgICAgLS1kYW5nZXI6ICNlZjQ0NDQ7CiAgICAgIC0tZ3JpZDogcmdiYSgyNTUsMjU1LDI1NSwwLjA2KTsKICAgIH0KICAgICogeyBib3gtc2l6aW5nOiBib3JkZXItYm94OyB9CiAgICBodG1sLCBib2R5IHsgaGVpZ2h0OiAxMDAlOyB9CiAgICBib2R5IHsKICAgICAgbWFyZ2luOiAwOyBwYWRkaW5nOiAyNHB4OwogICAgICBmb250LWZhbWlseTogSW50ZXIsIHN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgU2Vnb2UgVUksIFJvYm90bywgc2Fucy1zZXJpZjsKICAgICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KDEyMDBweCA2MDBweCBhdCA4MCUgLTIwJSwgcmdiYSg0NSwyMTIsMTkxLDAuMDYpLCB0cmFuc3BhcmVudCA2MCUpLAogICAgICAgICAgICAgICAgICByYWRpYWwtZ3JhZGllbnQoODAwcHggNTAwcHggYXQgLTEwJSAxMDAlLCByZ2JhKDI1MSwxOTEsMzYsMC4wOCksIHRyYW5zcGFyZW50IDYwJSksCiAgICAgICAgICAgICAgICAgIHZhcigtLWJnKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQpOwogICAgfQogICAgLnNoZWxsIHsKICAgICAgbWF4LXdpZHRoOiAxMDgwcHg7IG1hcmdpbjogMCBhdXRvOwogICAgfQogICAgaGVhZGVyIHsKICAgICAgZGlzcGxheTpmbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyBnYXA6IDE2cHg7CiAgICAgIG1hcmdpbi1ib3R0b206IDE4cHg7CiAgICB9CiAgICBoMSB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiBjbGFtcCgyMHB4LCAyLjZ2dywgMzBweCk7CiAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgIGxldHRlci1zcGFjaW5nOiAtMC4wMmVtOwogICAgICBkaXNwbGF5OmZsZXg7IGdhcDoxMHB4OyBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICB9CiAgICAuYmFkZ2UgewogICAgICBmb250LXNpemU6IDEycHg7IHBhZGRpbmc6IDRweCA4cHg7IGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDQ1LDIxMiwxOTEsMC4xMik7IGNvbG9yOiB2YXIoLS1icmFuZCk7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNDUsMjEyLDE5MSwwLjM1KTsKICAgIH0KICAgIC50b29sYmFyIHsKICAgICAgZGlzcGxheTpmbGV4OyBnYXA6OHB4OyBmbGV4LXdyYXA6IHdyYXA7CiAgICB9CiAgICBidXR0b24sIC5idG4gewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpLCByZ2JhKDI1NSwyNTUsMjU1LDAuMDMpKTsKICAgICAgYm9yZGVyOjFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMTYpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dCk7IHBhZGRpbmc6IDEwcHggMTRweDsgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsgY3Vyc29yOnBvaW50ZXI7IHRyYW5zaXRpb246IC4xNXMgdHJhbnNmb3JtIGVhc2UsIC4ycyBiYWNrZ3JvdW5kOwogICAgfQogICAgYnV0dG9uOmhvdmVyLCAuYnRuOmhvdmVyIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOyBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LDAuMTApOyB9CiAgICBidXR0b246ZGlzYWJsZWQgeyBvcGFjaXR5Oi41OyBjdXJzb3I6IG5vdC1hbGxvd2VkOyB0cmFuc2Zvcm06bm9uZTsgfQoKICAgIC5ncmlkIHsKICAgICAgZGlzcGxheTpncmlkOyBnYXA6MTRweDsKICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoMTIsIDFmcik7CiAgICB9CiAgICAuY2FyZCB7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsIHJnYmEoMjU1LDI1NSwyNTUsMC4wNiksIHJnYmEoMjU1LDI1NSwyNTUsMC4wMikpOwogICAgICBib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE2cHg7IHBhZGRpbmc6IDE2cHg7CiAgICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cig2cHgpOwogICAgfQogICAgLmNhcmQgaDMgeyBtYXJnaW46IDAgMCAxMHB4OyBmb250LXNpemU6IDE2cHg7IGZvbnQtd2VpZ2h0OiA3MDA7IGNvbG9yOiAjZGJlYWZlOyB9CgogICAgLmlucHV0cyB7IGdyaWQtY29sdW1uOiBzcGFuIDU7IH0KICAgIC5jb21wYXJlIHsgZ3JpZC1jb2x1bW46IHNwYW4gNzsgfQogICAgQG1lZGlhIChtYXgtd2lkdGg6IDk4MHB4KSB7CiAgICAgIC5pbnB1dHMsIC5jb21wYXJlIHsgZ3JpZC1jb2x1bW46IDEgLyAtMTsgfQogICAgfQoKICAgIC5yb3cgeyBkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjEwcHg7IG1hcmdpbjogMTBweCAwOyBmbGV4LXdyYXA6IHdyYXA7IH0KICAgIGxhYmVsIHsgZm9udC1zaXplOiAxM3B4OyBjb2xvcjogI2NiZDVlMTsgd2lkdGg6IDIwMHB4OyBtYXgtd2lkdGg6IDEwMCU7IH0KICAgIGlucHV0W3R5cGU9Im51bWJlciJdLCBzZWxlY3QsIC5zZWxlY3QyLXNlbGVjdGlvbi0tc2luZ2xlIHsKICAgICAgYmFja2dyb3VuZDogIzBmMTUyYTsgY29sb3I6IHZhcigtLXRleHQpOwogICAgICBib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4xNik7CiAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7IHBhZGRpbmc6IDEwcHggMTJweDsgbWluLXdpZHRoOiAxMzBweDsKICAgIH0KICAgIGlucHV0W3R5cGU9InJhbmdlIl17IHdpZHRoOjIwMHB4OyB9CiAgICAubXV0ZWQgeyBjb2xvcjogIzkzYTRiYjsgZm9udC1zaXplOiAxMnB4OyB9CiAgICAua3BpIHsKICAgICAgZGlzcGxheTpncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCg0LDFmcik7IGdhcDoxMHB4OyBtYXJnaW4tdG9wOjhweDsKICAgIH0KICAgIC5rcGkgLml0ZW0gewogICAgICBwYWRkaW5nOiAxMHB4OyBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICBib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4wMyk7CiAgICB9CiAgICAua3BpIC5pdGVtIC5sYWJlbCB7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6IzlmYjBjNjsgfQogICAgLmtwaSAuaXRlbSAudmFsdWUgeyBmb250LXNpemU6IDE4cHg7IGZvbnQtd2VpZ2h0OjgwMDsgbWFyZ2luLXRvcDo2cHg7IGxldHRlci1zcGFjaW5nOiAtMC4wMWVtOyB9CiAgICBAbWVkaWEgKG1heC13aWR0aDo3MDBweCl7IC5rcGl7IGdyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMWZyOyB9IH0KCiAgICB0YWJsZSB7CiAgICAgIHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyBtYXJnaW4tdG9wOiAxMHB4OwogICAgICBib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7IGJvcmRlci1yYWRpdXM6IDEycHg7IG92ZXJmbG93OiBoaWRkZW47CiAgICB9CiAgICB0aCwgdGQgeyBwYWRkaW5nOiAxMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IGZvbnQtc2l6ZTogMTNweDsgfQogICAgdGhlYWQgdGggewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDIsNiwyMywwLjc1KTsgYm9yZGVyLWJvdHRvbToxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjEwKTsKICAgICAgY29sb3I6I2NiZDVlMTsKICAgIH0KICAgIHRib2R5IHRyOm50aC1jaGlsZChvZGQpIHsgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjAzKTsgfQogICAgdGJvZHkgdHI6bnRoLWNoaWxkKGV2ZW4pIHsgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjA1KTsgfQogICAgLnRhZyB7IHBhZGRpbmc6MnB4IDZweDsgYm9yZGVyLXJhZGl1czogOHB4OyBiYWNrZ3JvdW5kOiByZ2JhKDU5LDEzMCwyNDYsMC4xNSk7IGJvcmRlcjoxcHggc29saWQgcmdiYSg1OSwxMzAsMjQ2LDAuMzUpOyBmb250LXNpemU6IDExcHg7IGNvbG9yOiNiZmRiZmU7IH0KCiAgICAuY2hhcnQtY2FyZCB7IHBvc2l0aW9uOiByZWxhdGl2ZTsgfQogICAgLmxlZ2VuZCB7IGRpc3BsYXk6ZmxleDsgZ2FwOjhweDsgZmxleC13cmFwOiB3cmFwOyBtYXJnaW4tdG9wOjEwcHg7IH0KICAgIC5sZWdlbmQgbGFiZWwgeyB3aWR0aDphdXRvOyBkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjZweDsgfQogICAgLmxlZ2VuZCBpbnB1dFt0eXBlPSJjaGVja2JveCJdeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMXB4KTsgfQoKICAgIC5mb290ZXIgewogICAgICBtYXJnaW4tdG9wOiAyMHB4OyBmb250LXNpemU6IDEycHg7IGNvbG9yOiM5ZmIwYzY7IGRpc3BsYXk6ZmxleDsKICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBnYXA6IDEycHg7IGZsZXgtd3JhcDogd3JhcDsKICAgIH0KCiAgICAub2sgeyBjb2xvcjogdmFyKC0tb2spOyB9CiAgICAud2FybiB7IGNvbG9yOiB2YXIoLS13YXJuKTsgfQogICAgLmRhbmdlciB7IGNvbG9yOiB2YXIoLS1kYW5nZXIpOyB9CiAgICAucGlsbCB7IGJvcmRlcjoxcHggZGFzaGVkIHJnYmEoMjU1LDI1NSwyNTUsMC4yKTsgYm9yZGVyLXJhZGl1czogOTk5cHg7IHBhZGRpbmc6IDJweCA4cHg7IGZvbnQtc2l6ZTogMTFweDsgfQogIAovKiBTZWxlY3QyIGRhcmsgdGhlbWUgb3ZlcnJpZGVzICovCi5zZWxlY3QyLWNvbnRhaW5lci0tZGVmYXVsdCAuc2VsZWN0Mi1zZWxlY3Rpb24tLXNpbmdsZSB7CiAgYmFja2dyb3VuZDogIzBmMTUyYSAhaW1wb3J0YW50OwogIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4xNikgIWltcG9ydGFudDsKICBoZWlnaHQ6IDQycHggIWltcG9ydGFudDsKfQouc2VsZWN0Mi1jb250YWluZXItLWRlZmF1bHQgLnNlbGVjdDItc2VsZWN0aW9uLS1zaW5nbGUgLnNlbGVjdDItc2VsZWN0aW9uX19yZW5kZXJlZCB7CiAgY29sb3I6IHZhcigtLXRleHQpICFpbXBvcnRhbnQ7CiAgbGluZS1oZWlnaHQ6IDQycHggIWltcG9ydGFudDsKICBwYWRkaW5nLWxlZnQ6IDEycHggIWltcG9ydGFudDsKfQouc2VsZWN0Mi1jb250YWluZXItLWRlZmF1bHQgLnNlbGVjdDItc2VsZWN0aW9uLS1zaW5nbGUgLnNlbGVjdDItc2VsZWN0aW9uX19hcnJvdyBiIHsKICBib3JkZXItY29sb3I6IHZhcigtLXRleHQpIHRyYW5zcGFyZW50IHRyYW5zcGFyZW50IHRyYW5zcGFyZW50ICFpbXBvcnRhbnQ7Cn0KLnNlbGVjdDItZHJvcGRvd24gewogIGJhY2tncm91bmQ6ICMwYjEwMjAgIWltcG9ydGFudDsKICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMTYpICFpbXBvcnRhbnQ7Cn0KLnNlbGVjdDItcmVzdWx0c19fb3B0aW9ucyB7CiAgYmFja2dyb3VuZDogIzBiMTAyMCAhaW1wb3J0YW50OwogIGNvbG9yOiB2YXIoLS10ZXh0KSAhaW1wb3J0YW50Owp9Ci5zZWxlY3QyLXJlc3VsdHNfX29wdGlvbi0taGlnaGxpZ2h0ZWQuc2VsZWN0Mi1yZXN1bHRzX19vcHRpb24tLXNlbGVjdGFibGUgewogIGJhY2tncm91bmQ6IHJnYmEoNDUsMjEyLDE5MSwwLjE4KSAhaW1wb3J0YW50OwogIGNvbG9yOiB2YXIoLS10ZXh0KSAhaW1wb3J0YW50Owp9Ci5zZWxlY3QyLXNlYXJjaC0tZHJvcGRvd24gLnNlbGVjdDItc2VhcmNoX19maWVsZCB7CiAgYmFja2dyb3VuZDogIzEwMTYyYiAhaW1wb3J0YW50OwogIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4xNikgIWltcG9ydGFudDsKICBjb2xvcjogdmFyKC0tdGV4dCkgIWltcG9ydGFudDsKICBib3JkZXItcmFkaXVzOiA4cHggIWltcG9ydGFudDsKfQoKICAKLyogRml4IGNoYXJ0IGNhbnZhcyBoZWlnaHQgb24gZGFyayBsYXlvdXQgdG8gYXZvaWQgaHVnZSBzY3JvbGwgKi8KI2NoYXJ0IHsKICBkaXNwbGF5OiBibG9jazsKICB3aWR0aDogMTAwJSAhaW1wb3J0YW50OwogIGhlaWdodDogNDIwcHggIWltcG9ydGFudDsgICAvKiBmaXhlZCB2aXN1YWwgaGVpZ2h0ICovCiAgbWF4LWhlaWdodDogNzV2aCAhaW1wb3J0YW50Owp9Ci5jaGFydC1jYXJkIHsKICBvdmVyZmxvdzogaGlkZGVuOyAvKiBhdm9pZCBhY2NpZGVudGFsIGdyb3d0aCAqLwp9CgogIAovKiBDZW50ZXIgdGV4dCB2ZXJ0aWNhbGx5IGluIFNlbGVjdDIgc2luZ2xlIHNlbGVjdGlvbiAqLwouc2VsZWN0Mi1jb250YWluZXItLWRlZmF1bHQgLnNlbGVjdDItc2VsZWN0aW9uLS1zaW5nbGUgLnNlbGVjdDItc2VsZWN0aW9uX19yZW5kZXJlZCB7CiAgZGlzcGxheTogZmxleCAhaW1wb3J0YW50OwogIGFsaWduLWl0ZW1zOiBjZW50ZXIgIWltcG9ydGFudDsKICBoZWlnaHQ6IDEwMCUgIWltcG9ydGFudDsKICBsaW5lLWhlaWdodDogbm9ybWFsICFpbXBvcnRhbnQ7Cn0KCiAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICA8ZGl2IGNsYXNzPSJzaGVsbCI+CiAgICA8aGVhZGVyPgogICAgICA8aDE+U2ltdWxhdGV1ciBkJ8OJcGFyZ25lIDxzcGFuIGNsYXNzPSJiYWRnZSI+UHJvKzwvc3Bhbj48L2gxPgogICAgICA8ZGl2IGNsYXNzPSJ0b29sYmFyIj4KICAgICAgICA8YnV0dG9uIGlkPSJidG4tY2FsYyI+Q2FsY3VsZXI8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJidG4tcmVzZXQiIHRpdGxlPSJSw6lpbml0aWFsaXNlciI+UsOpaW5pdGlhbGlzZXI8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJidG4tcGRmIiBkaXNhYmxlZD5Uw6lsw6ljaGFyZ2VyIGxlIFBERjwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9ImJ0bi1wbmciIGRpc2FibGVkPkV4cG9ydGVyIGxlIGdyYXBoaXF1ZTwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvaGVhZGVyPgoKICAgIDxkaXYgY2xhc3M9ImdyaWQiPgogICAgICA8c2VjdGlvbiBjbGFzcz0iY2FyZCBpbnB1dHMiPgogICAgICAgIDxoMz5QYXJhbcOodHJlczwvaDM+CgogICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICA8bGFiZWwgZm9yPSJpbml0aWFsIj5WZXJzZW1lbnQgaW5pdGlhbCAo4oKsKTwvbGFiZWw+CiAgICAgICAgICA8aW5wdXQgaWQ9ImluaXRpYWwiIHR5cGU9Im51bWJlciIgbWluPSIwIiBzdGVwPSIxMDAiIHZhbHVlPSI4MDAwIiAvPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgPGxhYmVsIGZvcj0ibW9udGhseSI+VmVyc2VtZW50IG1lbnN1ZWwgKOKCrCk8L2xhYmVsPgogICAgICAgICAgPGlucHV0IGlkPSJtb250aGx5IiB0eXBlPSJudW1iZXIiIG1pbj0iMCIgc3RlcD0iMTAiIHZhbHVlPSIwIiAvPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgPGxhYmVsIGZvcj0ieWVhcnMiPkR1csOpZSAoYW5uw6llcyk8L2xhYmVsPgogICAgICAgICAgPGlucHV0IGlkPSJ5ZWFycyIgdHlwZT0icmFuZ2UiIG1pbj0iMSIgbWF4PSI0MCIgdmFsdWU9IjEwIiAvPgogICAgICAgICAgPHNwYW4gaWQ9InllYXJzVmFsdWUiIGNsYXNzPSJwaWxsIj4xMCBhbnM8L3NwYW4+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICA8bGFiZWwgZm9yPSJpbmZsYXRpb24iPkluZmxhdGlvbiBhbm51ZWxsZSAoJSk8L2xhYmVsPgogICAgICAgICAgPGlucHV0IGlkPSJpbmZsYXRpb24iIHR5cGU9Im51bWJlciIgbWluPSIwIiBzdGVwPSIwLjEiIHZhbHVlPSIyLjAiIC8+CiAgICAgICAgICA8c3BhbiBjbGFzcz0ibXV0ZWQiPlBlcm1ldCBkJ2FmZmljaGVyIHVuIGNhcGl0YWwgwqsgZW4gZXVyb3MgY29uc3RhbnRzIMK7Ljwvc3Bhbj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgIDxsYWJlbCBmb3I9ImZpc2NhbGl0ZSI+RmlzY2FsaXTDqSAob3B0aW9uIHDDqWRhZ29naXF1ZSk8L2xhYmVsPgogICAgICAgICAgPHNlbGVjdCBpZD0iZmlzY2FsaXRlIj4KICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ibm9uZSIgc2VsZWN0ZWQ+U2FucyBmaXNjYWxpdMOpIChicnV0IGRlIGZpc2NhbGl0w6kpPC9vcHRpb24+CiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9InBmdSI+UEZVIDMwJSBzdXIgZ2FpbnMgYW5udWVscyAoaHlwb3Row6hzZSBzaW1wbGlmacOpZSk8L29wdGlvbj4KICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgPGxhYmVsIGZvcj0ibW9kZUFmZmljaGFnZSI+TW9kZSBkJ2FmZmljaGFnZTwvbGFiZWw+CiAgICAgICAgICA8c2VsZWN0IGlkPSJtb2RlQWZmaWNoYWdlIj4KICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ibm9taW5hbCIgc2VsZWN0ZWQ+TW9udGFudHMgbm9taW5hdXg8L29wdGlvbj4KICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0icmVlbCI+TW9udGFudHMgcsOpZWxzIChkw6lmbGF0w6lzKTwvb3B0aW9uPgogICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9ImtwaSI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJpdGVtIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibGFiZWwiPlZlcnNlbWVudHMgY3VtdWzDqXM8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0ia3BpLWRlcG9zaXRzIiBjbGFzcz0idmFsdWUiPuKAlDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJpdGVtIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibGFiZWwiPkFubsOpZSBkZSBicmVhay1ldmVuPC9kaXY+CiAgICAgICAgICAgIDxkaXYgaWQ9ImtwaS1icmVha2V2ZW4iIGNsYXNzPSJ2YWx1ZSI+4oCUPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9Iml0ZW0iPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsYWJlbCI+RnJhaXMgY3VtdWzDqXMgKEhhcm1vbmllKTwvZGl2PgogICAgICAgICAgICA8ZGl2IGlkPSJrcGktZmVlcyIgY2xhc3M9InZhbHVlIj7igJQ8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImxhYmVsIj7DiWNhcnQgdnMgTGl2cmV0IEE8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0ia3BpLWdhcCIgY2xhc3M9InZhbHVlIj7igJQ8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L3NlY3Rpb24+CgogICAgICA8c2VjdGlvbiBjbGFzcz0iY2FyZCBjb21wYXJlIj4KICAgICAgICA8aDM+UHJvZHVpdHMgJiBIeXBvdGjDqHNlczwvaDM+CgogICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICA8bGFiZWwgZm9yPSJoYXJtLXJhdGUiPkhhcm1vbmllIOKAlCBSZW5kZW1lbnQgKCUpPC9sYWJlbD4KICAgICAgICAgIDxpbnB1dCBpZD0iaGFybS1yYXRlIiB0eXBlPSJudW1iZXIiIHN0ZXA9IjAuMDEiIG1pbj0iMCIgdmFsdWU9IjQuNSIgLz4KICAgICAgICAgIDxzZWxlY3QgaWQ9Imhhcm0tcHJlc2V0Ij4KICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iY3VzdG9tIj5QZXJzb25uYWxpc8OpPC9vcHRpb24+CiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjQuNSI+SGFybW9uaWUgMzAvNzAgKDQsNSUpPC9vcHRpb24+CiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjUuNSI+SGFybW9uaWUgNTAvNTAgKDUsNSUpPC9vcHRpb24+CiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjYuNSI+SGFybW9uaWUgNzAvMzAgKDYsNSUpPC9vcHRpb24+CiAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgIDxsYWJlbD5IYXJtb25pZSDigJQgRnJhaXM8L2xhYmVsPgogICAgICAgICAgPHNwYW4+RW50csOpZTogPGlucHV0IGlkPSJoYXJtLWVudHJ5IiB0eXBlPSJudW1iZXIiIG1pbj0iMCIgc3RlcD0iMC4wMSIgdmFsdWU9IjIuMDAiIHN0eWxlPSJ3aWR0aDo5MHB4Ij4gJTwvc3Bhbj4KICAgICAgICAgIDxzcGFuPkdlc3Rpb246IDxpbnB1dCBpZD0iaGFybS1tZ210IiB0eXBlPSJudW1iZXIiIG1pbj0iMCIgc3RlcD0iMC4wMSIgdmFsdWU9IjAuNjAiIHN0eWxlPSJ3aWR0aDo5MHB4Ij4gJTwvc3Bhbj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGhyIHN0eWxlPSJib3JkZXI6bm9uZTtib3JkZXItdG9wOjFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMSk7IG1hcmdpbjogMTJweCAwIj4KCiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgIDxsYWJlbCBmb3I9ImNvbXBhcmUtc2VsZWN0Ij5Db250cmF0IGNvbXBhcmF0aWY8L2xhYmVsPgogICAgICAgICAgPHNlbGVjdCBpZD0iY29tcGFyZS1zZWxlY3QiIHN0eWxlPSJtaW4td2lkdGg6MjgwcHgiPjwvc2VsZWN0PgogICAgICAgICAgPHNwYW4gY2xhc3M9Im11dGVkIj4oKyBmaWx0cmUgYXV0bywgdGFwZXIgcXVlbHF1ZXMgbGV0dHJlcyk8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgIDxsYWJlbD5Db21wYXJhdGlmIOKAlCBIeXBvdGjDqHNlczwvbGFiZWw+CiAgICAgICAgICA8c3Bhbj5FbnRyw6llOiA8aW5wdXQgaWQ9ImNtcC1lbnRyeSIgdHlwZT0ibnVtYmVyIiBtaW49IjAiIHN0ZXA9IjAuMDEiIHZhbHVlPSIwLjAwIiBzdHlsZT0id2lkdGg6OTBweCI+ICU8L3NwYW4+CiAgICAgICAgICA8c3Bhbj5HZXN0aW9uOiA8aW5wdXQgaWQ9ImNtcC1tZ210IiB0eXBlPSJudW1iZXIiIG1pbj0iMCIgc3RlcD0iMC4wMSIgdmFsdWU9IjAuMDAiIHN0eWxlPSJ3aWR0aDo5MHB4Ij4gJTwvc3Bhbj4KICAgICAgICAgIDxzcGFuPlJkdDogPGlucHV0IGlkPSJjbXAtcmF0ZSIgdHlwZT0ibnVtYmVyIiBtaW49IjAiIHN0ZXA9IjAuMDEiIHZhbHVlPSIyLjAwIiBzdHlsZT0id2lkdGg6MTEwcHgiPiAlPC9zcGFuPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgPGxhYmVsIGZvcj0ibGl2cmV0YSI+TGl2cmV0IEEg4oCUIFJlbmRlbWVudCAoJSk8L2xhYmVsPgogICAgICAgICAgPGlucHV0IGlkPSJsaXZyZXRhIiB0eXBlPSJudW1iZXIiIG1pbj0iMCIgc3RlcD0iMC4xIiB2YWx1ZT0iMy4wIiAvPgogICAgICAgICAgPHNwYW4gY2xhc3M9Im11dGVkIj5TYW5zIGZyYWlzLjwvc3Bhbj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgIDxsYWJlbD5TdHJlc3MgdGVzdCAoSGFybW9uaWUpPC9sYWJlbD4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJtdXRlZCI+QWZmaWNoZSDCsTEgcHQgZGUgcmVuZGVtZW50PC9zcGFuPgogICAgICAgICAgPGxhYmVsIGNsYXNzPSJwaWxsIj48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzdHJlc3MiIC8+IEFmZmljaGVyPC9sYWJlbD4KICAgICAgICA8L2Rpdj4KICAgICAgPC9zZWN0aW9uPgoKICAgICAgPHNlY3Rpb24gY2xhc3M9ImNhcmQgY2hhcnQtY2FyZCIgc3R5bGU9ImdyaWQtY29sdW1uOiAxIC8gLTE7Ij4KICAgICAgICA8aDM+w4l2b2x1dGlvbiBkdSBjYXBpdGFsPC9oMz4KICAgICAgICA8Y2FudmFzIGlkPSJjaGFydCI+PC9jYW52YXM+CiAgICAgICAgPGRpdiBjbGFzcz0ibGVnZW5kIj4KICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJ0b2dnbGUtbGluZSIgZGF0YS1rZXk9Imhhcm0iIGNoZWNrZWQgLz4gSGFybW9uaWU8L2xhYmVsPgogICAgICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2xhc3M9InRvZ2dsZS1saW5lIiBkYXRhLWtleT0iY21wIiBjaGVja2VkIC8+IENvbXBhcmF0aWY8L2xhYmVsPgogICAgICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2xhc3M9InRvZ2dsZS1saW5lIiBkYXRhLWtleT0ibGEiIGNoZWNrZWQgLz4gTGl2cmV0IEE8L2xhYmVsPgogICAgICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2xhc3M9InRvZ2dsZS1saW5lIiBkYXRhLWtleT0iZGVwIiBjaGVja2VkIC8+IFZlcnNlbWVudHMgY3VtdWzDqXM8L2xhYmVsPgogICAgICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2xhc3M9InRvZ2dsZS1saW5lIiBkYXRhLWtleT0ic3RyZXNzIiAvPiBTdHJlc3MgwrExIHB0PC9sYWJlbD4KICAgICAgICA8L2Rpdj4KICAgICAgPC9zZWN0aW9uPgoKICAgICAgPHNlY3Rpb24gY2xhc3M9ImNhcmQiIHN0eWxlPSJncmlkLWNvbHVtbjogMSAvIC0xOyI+CiAgICAgICAgPGgzPlRhYmxlYXUgcsOpY2FwaXR1bGF0aWY8L2gzPgogICAgICAgIDx0YWJsZSBpZD0icmVzdWx0cyI+CiAgICAgICAgICA8dGhlYWQ+CiAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICA8dGg+PC90aD4KICAgICAgICAgICAgICA8dGg+SGFybW9uaWU8L3RoPgogICAgICAgICAgICAgIDx0aCBpZD0idGgtY21wIj5Db250cmF0IGNvbXBhcmF0aWY8L3RoPgogICAgICAgICAgICAgIDx0aD5MaXZyZXQgQTwvdGg+CiAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgPHRib2R5PgogICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgPHRkPkNhcGl0YWwgZmluYWw8L3RkPgogICAgICAgICAgICAgIDx0ZCBpZD0ici1oYXJtLWNhcCI+4oCUPC90ZD4KICAgICAgICAgICAgICA8dGQgaWQ9InItY21wLWNhcCI+4oCUPC90ZD4KICAgICAgICAgICAgICA8dGQgaWQ9InItbGEtY2FwIj7igJQ8L3RkPgogICAgICAgICAgICA8L3RyPgogICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgPHRkPkludMOpcsOqdHMgY3VtdWzDqXM8L3RkPgogICAgICAgICAgICAgIDx0ZCBpZD0ici1oYXJtLWludCI+4oCUPC90ZD4KICAgICAgICAgICAgICA8dGQgaWQ9InItY21wLWludCI+4oCUPC90ZD4KICAgICAgICAgICAgICA8dGQgaWQ9InItbGEtaW50Ij7igJQ8L3RkPgogICAgICAgICAgICA8L3RyPgogICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgPHRkPkZyYWlzIGQnZW50csOpZSAo4oKsKTwvdGQ+CiAgICAgICAgICAgICAgPHRkIGlkPSJyLWhhcm0tZmUiPuKAlDwvdGQ+CiAgICAgICAgICAgICAgPHRkIGlkPSJyLWNtcC1mZSI+4oCUPC90ZD4KICAgICAgICAgICAgICA8dGQgaWQ9InItbGEtZmUiPuKAlDwvdGQ+CiAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICA8dGQ+RnJhaXMgZGUgZ2VzdGlvbiAo4oKsKTwvdGQ+CiAgICAgICAgICAgICAgPHRkIGlkPSJyLWhhcm0tZmciPuKAlDwvdGQ+CiAgICAgICAgICAgICAgPHRkIGlkPSJyLWNtcC1mZyI+4oCUPC90ZD4KICAgICAgICAgICAgICA8dGQgaWQ9InItbGEtZmciPuKAlDwvdGQ+CiAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICA8dGQ+RGlmZsOpcmVuY2UgdnMgSGFybW9uaWU8L3RkPgogICAgICAgICAgICAgIDx0ZD7igJQ8L3RkPgogICAgICAgICAgICAgIDx0ZCBpZD0ici1kaWZmLWNtcCI+4oCUPC90ZD4KICAgICAgICAgICAgICA8dGQgaWQ9InItZGlmZi1sYSI+4oCUPC90ZD4KICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgIDx0ZD5Bbm7DqWUgZGUgYnJlYWstZXZlbjwvdGQ+CiAgICAgICAgICAgICAgPHRkIGlkPSJyLWhhcm0tYmUiPuKAlDwvdGQ+CiAgICAgICAgICAgICAgPHRkIGlkPSJyLWNtcC1iZSI+4oCUPC90ZD4KICAgICAgICAgICAgICA8dGQgaWQ9InItbGEtYmUiPuKAlDwvdGQ+CiAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICA8L3Rib2R5PgogICAgICAgIDwvdGFibGU+CiAgICAgIDwvc2VjdGlvbj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImZvb3RlciI+CiAgICAgIDxzcGFuPvCfkqEgQXN0dWNlOiB2b3VzIHBvdXZleiB0YXBlciDCqyBsaW54ZWEgwrssIMKrIGF4YSDCuywgwqsgZ2VuZXJhbGkgwrssIGV0Yy4sIHBvdXIgZmlsdHJlciBsZSBjb250cmF0IGNvbXBhcmF0aWYuPC9zcGFuPgogICAgICA8c3BhbiBjbGFzcz0ibXV0ZWQiPlNpbXVsYXRpb24gaW5kaWNhdGl2ZS4gSHlwb3Row6hzZXMgc2ltcGxpZmnDqWVzIChmaXNjYWxpdMOpLCBmcmFpcywgcmVuZGVtZW50KS4gTmUgY29uc3RpdHVlIHBhcyB1biBjb25zZWlsLjwvc3Bhbj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8c2NyaXB0PgogICAgLy8g4oCU4oCU4oCU4oCU4oCUIFV0aWxzIOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlAogICAgY29uc3QgZm10ID0gKHYsIHNpZ249ZmFsc2UpID0+IHsKICAgICAgaWYgKGlzTmFOKHYpKSByZXR1cm4gJ+KAlCc7CiAgICAgIGNvbnN0IGYgPSBuZXcgSW50bC5OdW1iZXJGb3JtYXQoJ2ZyLUZSJywgeyBzdHlsZTonY3VycmVuY3knLCBjdXJyZW5jeTonRVVSJyB9KS5mb3JtYXQoTWF0aC5hYnModikpOwogICAgICByZXR1cm4gc2lnbiA/ICh2Pj0wPycrICc6Jy0gJykgKyBmIDogZjsKICAgIH07CiAgICBjb25zdCBjbGFtcCA9ICh2LCBsbywgaGkpID0+IE1hdGgubWF4KGxvLCBNYXRoLm1pbihoaSwgdikpOwoKICAgIGZ1bmN0aW9uIHllYXJseURlcG9zaXRzKGluaXRpYWwsIG1vbnRobHksIHllYXJzKXsKICAgICAgY29uc3QgYXJyPVtpbml0aWFsXTsKICAgICAgZm9yKGxldCB5PTE7eTw9eWVhcnM7eSsrKXsgYXJyLnB1c2goaW5pdGlhbCArIG1vbnRobHkqMTIqeSk7IH0KICAgICAgcmV0dXJuIGFycjsKICAgIH0KCiAgICBmdW5jdGlvbiBicmVha2V2ZW5ZZWFyKHllYXJseVZhbHVlcywgaW5pdGlhbCwgbW9udGhseSl7CiAgICAgIGZvcihsZXQgeT0wO3k8eWVhcmx5VmFsdWVzLmxlbmd0aDt5KyspewogICAgICAgIGNvbnN0IGRlcHMgPSBpbml0aWFsICsgbW9udGhseSoxMip5OwogICAgICAgIGlmICh5ZWFybHlWYWx1ZXNbeV0gPj0gZGVwcykgcmV0dXJuIHk7CiAgICAgIH0KICAgICAgcmV0dXJuICfigJQnOwogICAgfQoKICAgIC8vIENvcmUgY2FsYzogbW9udGhseSBjb21wb3VuZGluZzsgZW50cnkgZmVlcyBhdCBkZXBvc2l0OyBtZ210IGZlZXMgY2hhcmdlZCB5ZWFybHkgb24gY2FwaXRhbAogICAgZnVuY3Rpb24gc2ltdWxhdGUoe2luaXRpYWwsIG1vbnRobHksIGdyb3NzUmF0ZSwgZW50cnlGZWUsIG1nbXRGZWUsIHllYXJzLCBpbmZsYXRpb24sIHRheH0pewogICAgICBjb25zdCByID0gZ3Jvc3NSYXRlLzEwMDsKICAgICAgY29uc3QgZmVpID0gZW50cnlGZWUvMTAwOwogICAgICBjb25zdCBmbWcgPSBtZ210RmVlLzEwMDsKICAgICAgY29uc3QgaW5mbCA9IGluZmxhdGlvbi8xMDA7CgogICAgICBjb25zdCBpbml0RkUgPSBpbml0aWFsICogZmVpOwogICAgICBjb25zdCBtRkUgPSBtb250aGx5ICogZmVpOwogICAgICBsZXQgdG90YWxFbnRyeSA9IGluaXRGRTsKICAgICAgbGV0IHRvdGFsTWdtdCA9IDA7CgogICAgICBsZXQgY2FwaXRhbCA9IGluaXRpYWwqKDEtZmVpKTsKICAgICAgY29uc3QgbW9udGhseVJhdGUgPSByIC8gMTI7IC8vIG1nbXQgZmVlcyBhcHBsaWVkIGFubnVhbGx5IGJlbG93IChhdm9pZCBkb3VibGUgY2hhcmdlKQoKICAgICAgY29uc3QgeWVhcmx5Tm9taW5hbD1bY2FwaXRhbF0sIHllYXJseUVudHJ5PVtpbml0RkVdLCB5ZWFybHlNZ210PVswXTsKCiAgICAgIGZvcihsZXQgeT0xO3k8PXllYXJzO3krKyl7CiAgICAgICAgbGV0IHlFbnRyeSA9IDA7CiAgICAgICAgbGV0IGludGVyZXN0QWNjcnVlZCA9IDA7CiAgICAgICAgZm9yKGxldCBtPTA7bTwxMjttKyspewogICAgICAgICAgY2FwaXRhbCArPSBtb250aGx5KigxLWZlaSk7CiAgICAgICAgICBjb25zdCBiZWZvcmUgPSBjYXBpdGFsOwogICAgICAgICAgY2FwaXRhbCAqPSAoMSttb250aGx5UmF0ZSk7CiAgICAgICAgICBpbnRlcmVzdEFjY3J1ZWQgKz0gKGNhcGl0YWwgLSBiZWZvcmUpOwogICAgICAgICAgeUVudHJ5ICs9IG1GRTsKICAgICAgICB9CiAgICAgICAgLy8gc2ltcGxpZmllZCB0YXggb24gZ2FpbnMKICAgICAgICBpZiAodGF4PT09J3BmdScgJiYgaW50ZXJlc3RBY2NydWVkPjApewogICAgICAgICAgY29uc3QgZHVlID0gMC4zMCAqIGludGVyZXN0QWNjcnVlZDsKICAgICAgICAgIGNhcGl0YWwgLT0gZHVlOwogICAgICAgICAgdG90YWxNZ210ICs9IGR1ZTsgLy8gZGlzcGxheSBhcyAiZmVlcyIgYnVja2V0IChwZWRhZ29naWMpCiAgICAgICAgfQogICAgICAgIGNvbnN0IHlNZ210RmVlcyA9IGNhcGl0YWwgKiBmbWc7IC8vIGFubnVhbCBtZ210IGZlZXMKICAgICAgICB0b3RhbE1nbXQgKz0geU1nbXRGZWVzOwogICAgICAgIHRvdGFsRW50cnkgKz0geUVudHJ5OwogICAgICAgIGNhcGl0YWwgLT0geU1nbXRGZWVzOwoKICAgICAgICB5ZWFybHlOb21pbmFsLnB1c2goY2FwaXRhbCk7CiAgICAgICAgeWVhcmx5RW50cnkucHVzaCh0b3RhbEVudHJ5KTsKICAgICAgICB5ZWFybHlNZ210LnB1c2godG90YWxNZ210KTsKICAgICAgfQoKICAgICAgY29uc3QgdG90YWxEZXBvc2l0cyA9IGluaXRpYWwgKyBtb250aGx5KjEyKnllYXJzOwogICAgICBjb25zdCBpbnRlcmVzdHMgPSBjYXBpdGFsIC0gdG90YWxEZXBvc2l0czsKCiAgICAgIC8vIHJlYWwgdGVybXMgKGV1cm9zIGNvbnN0YW50cykKICAgICAgY29uc3QgeWVhcmx5UmVhbCA9IHllYXJseU5vbWluYWwubWFwKCh2LCBpKSA9PiB2IC8gTWF0aC5wb3coMStpbmZsLCBpKSk7CgogICAgICByZXR1cm4gewogICAgICAgIHRvdGFsQ2FwaXRhbDogY2FwaXRhbCwKICAgICAgICB0b3RhbERlcG9zaXRzLAogICAgICAgIGludGVyZXN0cywKICAgICAgICBlbnRyeUZlZXNUb3RhbDogdG90YWxFbnRyeSwKICAgICAgICBtZ210RmVlc1RvdGFsOiB0b3RhbE1nbXQsCiAgICAgICAgeWVhcmx5Tm9taW5hbCwKICAgICAgICB5ZWFybHlSZWFsLAogICAgICAgIHllYXJseUVudHJ5LAogICAgICAgIHllYXJseU1nbXQKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb21wdXRlQWxsKCl7CiAgICAgIGNvbnN0IGluaXRpYWwgPSBOdW1iZXIoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luaXRpYWwnKS52YWx1ZXx8MCk7CiAgICAgIGNvbnN0IG1vbnRobHkgPSBOdW1iZXIoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vbnRobHknKS52YWx1ZXx8MCk7CiAgICAgIGNvbnN0IHllYXJzID0gTnVtYmVyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd5ZWFycycpLnZhbHVlfHwxMCk7CiAgICAgIGNvbnN0IGluZmxhdGlvbiA9IGNsYW1wKE51bWJlcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mbGF0aW9uJykudmFsdWV8fDApLDAsNTApOwogICAgICBjb25zdCB0YXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlzY2FsaXRlJykudmFsdWU7CgogICAgICBjb25zdCBoYXJtUmF0ZSA9IGNsYW1wKE51bWJlcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFybS1yYXRlJykudmFsdWV8fDApLDAsMTAwKTsKICAgICAgY29uc3QgaGFybUVudHJ5ID0gY2xhbXAoTnVtYmVyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYXJtLWVudHJ5JykudmFsdWV8fDApLDAsMTAwKTsKICAgICAgY29uc3QgaGFybU1nbXQgPSBjbGFtcChOdW1iZXIoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hhcm0tbWdtdCcpLnZhbHVlfHwwKSwwLDEwMCk7CgogICAgICBjb25zdCBjbXBFbnRyeSA9IGNsYW1wKE51bWJlcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY21wLWVudHJ5JykudmFsdWV8fDApLDAsMTAwKTsKICAgICAgY29uc3QgY21wTWdtdCA9IGNsYW1wKE51bWJlcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY21wLW1nbXQnKS52YWx1ZXx8MCksMCwxMDApOwogICAgICBjb25zdCBjbXBSYXRlID0gY2xhbXAoTnVtYmVyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbXAtcmF0ZScpLnZhbHVlfHwwKSwwLDEwMCk7CiAgICAgIGNvbnN0IGxhUmF0ZSA9IGNsYW1wKE51bWJlcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGl2cmV0YScpLnZhbHVlfHwwKSwwLDEwMCk7CgogICAgICBjb25zdCBoYXJtID0gc2ltdWxhdGUoe2luaXRpYWwsIG1vbnRobHksIGdyb3NzUmF0ZTpoYXJtUmF0ZSwgZW50cnlGZWU6aGFybUVudHJ5LCBtZ210RmVlOmhhcm1NZ210LCB5ZWFycywgaW5mbGF0aW9uLCB0YXh9KTsKICAgICAgY29uc3QgY21wID0gc2ltdWxhdGUoe2luaXRpYWwsIG1vbnRobHksIGdyb3NzUmF0ZTpjbXBSYXRlLCBlbnRyeUZlZTpjbXBFbnRyeSwgbWdtdEZlZTpjbXBNZ210LCB5ZWFycywgaW5mbGF0aW9uLCB0YXh9KTsKICAgICAgY29uc3QgbGEgPSBzaW11bGF0ZSh7aW5pdGlhbCwgbW9udGhseSwgZ3Jvc3NSYXRlOmxhUmF0ZSwgZW50cnlGZWU6MCwgbWdtdEZlZTowLCB5ZWFycywgaW5mbGF0aW9uLCB0YXg6J25vbmUnfSk7CgogICAgICBjb25zdCBkZXBvc2l0cyA9IHllYXJseURlcG9zaXRzKGluaXRpYWwsIG1vbnRobHksIHllYXJzKTsKICAgICAgY29uc3QgbW9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RlQWZmaWNoYWdlJykudmFsdWU7CiAgICAgIGNvbnN0IGhhcm1TZXJpZXMgPSAobW9kZT09PSdyZWVsJykgPyBoYXJtLnllYXJseVJlYWwgOiBoYXJtLnllYXJseU5vbWluYWw7CiAgICAgIGNvbnN0IGNtcFNlcmllcyAgPSAobW9kZT09PSdyZWVsJykgPyBjbXAueWVhcmx5UmVhbCAgOiBjbXAueWVhcmx5Tm9taW5hbDsKICAgICAgY29uc3QgbGFTZXJpZXMgICA9IChtb2RlPT09J3JlZWwnKSA/IGxhLnllYXJseVJlYWwgICA6IGxhLnllYXJseU5vbWluYWw7CgogICAgICAvLyBTdHJlc3MgdGVzdCBiYW5kcyDCsTEgcHQgb24gSGFybW9uaWUKICAgICAgY29uc3Qgc3RyZXNzT04gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZXNzJykuY2hlY2tlZDsKICAgICAgY29uc3QgaGFybUxvdyA9IHNpbXVsYXRlKHtpbml0aWFsLCBtb250aGx5LCBncm9zc1JhdGU6TWF0aC5tYXgoMCxoYXJtUmF0ZS0xKSwgZW50cnlGZWU6aGFybUVudHJ5LCBtZ210RmVlOmhhcm1NZ210LCB5ZWFycywgaW5mbGF0aW9uLCB0YXh9KTsKICAgICAgY29uc3QgaGFybUhpZ2g9IHNpbXVsYXRlKHtpbml0aWFsLCBtb250aGx5LCBncm9zc1JhdGU6aGFybVJhdGUrMSwgZW50cnlGZWU6aGFybUVudHJ5LCBtZ210RmVlOmhhcm1NZ210LCB5ZWFycywgaW5mbGF0aW9uLCB0YXh9KTsKICAgICAgY29uc3QgaGFybUxvd1NlcmllcyAgPSAobW9kZT09PSdyZWVsJykgPyBoYXJtTG93LnllYXJseVJlYWwgIDogaGFybUxvdy55ZWFybHlOb21pbmFsOwogICAgICBjb25zdCBoYXJtSGlnaFNlcmllcyA9IChtb2RlPT09J3JlZWwnKSA/IGhhcm1IaWdoLnllYXJseVJlYWwgOiBoYXJtSGlnaC55ZWFybHlOb21pbmFsOwoKICAgICAgcmV0dXJuIHsKICAgICAgICBpbnB1dHM6IHtpbml0aWFsLCBtb250aGx5LCB5ZWFycywgaW5mbGF0aW9uLCB0YXgsIGhhcm1SYXRlLCBoYXJtRW50cnksIGhhcm1NZ210LCBjbXBFbnRyeSwgY21wTWdtdCwgY21wUmF0ZSwgbGFSYXRlLCBtb2RlfSwKICAgICAgICBoYXJtLCBjbXAsIGxhLCBkZXBvc2l0cywgaGFybVNlcmllcywgY21wU2VyaWVzLCBsYVNlcmllcywgc3RyZXNzT04sIGhhcm1Mb3dTZXJpZXMsIGhhcm1IaWdoU2VyaWVzCiAgICAgIH07CiAgICB9CgogICAgLy8g4oCU4oCU4oCU4oCU4oCUIERhdGEg4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUCiAgICBjb25zdCBjb250cmFjdHNEYXRhID0gewogICAgICAiQUJFSUxMRSBFUEFSR05FIEFDVElWRSI6IHsgZW50cnlGZWVzOiA0LjUsIG1hbmFnZW1lbnRGZWVzOiAxLjAsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkFDVElWRVNFRUQgVklFIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAxLjIsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkFGRVIiOiB7IGVudHJ5RmVlczogMC41LCBtYW5hZ2VtZW50RmVlczogMC40OCwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQUcyUiAvIEVYQ0VMTElFIFZJRSI6IHsgZW50cnlGZWVzOiAxLjUsIG1hbmFnZW1lbnRGZWVzOiAwLjk2LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBRzJSIC8gVEVSUkUgREUgVklFIDIiOiB7IGVudHJ5RmVlczogNC41LCBtYW5hZ2VtZW50RmVlczogMC45NiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQUcyUiAvIFZJVkVQQVJHTkUgSUkiOiB7IGVudHJ5RmVlczogMy4wLCBtYW5hZ2VtZW50RmVlczogMC44LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBR0lQSSAvIEVQQVJHTkUgQ0xFUiI6IHsgZW50cnlGZWVzOiA0Ljg1LCBtYW5hZ2VtZW50RmVlczogMC45NiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQUxUQVBST0ZJVFMgLyBESUdJVEFMIFZJRSBQUklNRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBTFRBUFJPRklUUyAvIFRJVFJFU0BWSUUiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQUxUQVBST0ZJVFMgVklFIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjg0LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBTUVUSVMgLyBDTlAgVFJFU09SIFBST0pFVFMiOiB7IGVudHJ5RmVlczogNC4wLCBtYW5hZ2VtZW50RmVlczogMC45LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBUkVBUyBBU1NVUkFOQ0VTIC8gTVVMVElTVVBQT1JUIDMiOiB7IGVudHJ5RmVlczogNC41LCBtYW5hZ2VtZW50RmVlczogMS4wLCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBU0FDIEZBUEVTIC8gQVNBQyBORU8gVklFIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAyLjAsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkFTQUMgRkFQRVMgLyBFUEFSR05FIFJFVFJBSVRFIDIgUExVUyI6IHsgZW50cnlGZWVzOiAyLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjYsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkFTQUMgRkFQRVMgLyBFUk1HIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjcsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkFTQUMgRkFQRVMgLyBTT0xJRCdSIFZJRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC43LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBU1NVUkFOQ0UgVklFIFJBTUlGWSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMS4wLCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBU1NVUkFOQ0VWSUUuQ09NIC8gRVZPTFVUSU9OIFZJRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBU1NVUkFOQ0VWSUUuQ09NIC8gTFVDWUEgQ0FSRElGIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjcsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkFTU1VSQU5DRVZJRS5DT00gLyBQVUlTU0FOQ0UgQVZFTklSIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjYsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkFTU1VSQU5DRVZJRS5DT00gLyBQVUlTU0FOQ0UgU0VMRUNUSU9OIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjYsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkFUSFlNSVMgR0VTVElPTiI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMS4wLCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJBVVRSRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMCwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQVhBIEFSUEVHRVMiOiB7IGVudHJ5RmVlczogNC44NSwgbWFuYWdlbWVudEZlZXM6IDAuOTYsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkFYQSBFWENFTElVTSI6IHsgZW50cnlGZWVzOiA0Ljg1LCBtYW5hZ2VtZW50RmVlczogMC45NiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQVhBIFBSSVZJTEVHRSI6IHsgZW50cnlGZWVzOiA0Ljg1LCBtYW5hZ2VtZW50RmVlczogMC45NiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQkFOUVVFIFBPUFVMQUlSRSAvIEhPUklaRU8gMiI6IHsgZW50cnlGZWVzOiAzLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjc1LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJCQU5RVUUgUE9QVUxBSVJFIC8gUExBTiBFUEFSR05FIEVORkFOVCI6IHsgZW50cnlGZWVzOiAyLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjk2LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJCQU5RVUUgUE9QVUxBSVJFIC8gUVVJTlRFU1NBIDIiOiB7IGVudHJ5RmVlczogMy4wLCBtYW5hZ2VtZW50RmVlczogMC44LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJCTlAgUEFSSUJBUyBNVUxUSVBMQUNFTUVOVFMgMiI6IHsgZW50cnlGZWVzOiAyLjc1LCBtYW5hZ2VtZW50RmVlczogMC44NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQk5QIFBBUklCQVMgTVVMVElQTEFDRU1FTlRTIEFWRU5JUiI6IHsgZW50cnlGZWVzOiAyLjc1LCBtYW5hZ2VtZW50RmVlczogMC44NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQk9VUlNFIERJUkVDVCBIT1JJWk9OIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjc1LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJCT1VSU0UgRElSRUNUIFZJRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC42NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQk9VUlNPQkFOSyBCT1VSU08gVklFIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjc1LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJCUEUgRU1FUkFVREUiOiB7IGVudHJ5RmVlczogMi4wLCBtYW5hZ2VtZW50RmVlczogMC45NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQlJFRCBCQU5RVUUgUE9QVUxBSVJFIC8gRVZPTFVWSUUgSVYiOiB7IGVudHJ5RmVlczogMi4wLCBtYW5hZ2VtZW50RmVlczogMC44LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJDQUlTU0UgRCfDiVBBUkdORSAvIE1JTExFVklFIEVTU0VOVElFTExFIDIiOiB7IGVudHJ5RmVlczogMy4wLCBtYW5hZ2VtZW50RmVlczogMC44LCBkZWZhdWx0UmF0ZTogMC4wIH0sCiAgICAgICJDQUlTU0UgRCfDiVBBUkdORSAvIE1JTExFVklFIElOSVRJQUxFIDIiOiB7IGVudHJ5RmVlczogMy4wLCBtYW5hZ2VtZW50RmVlczogMC44LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJDQVJBQyBFUEFSR05FIEdFTkVSQVRJT04iOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuOSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQ0FSQUMgRVBBUkdORSBQQVRSSU1PSU5FIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjksIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkNBU0hCRUUgKyI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC43NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQ0lDIC8gQ1JFRElUIE1VVFVFTCAvIFBMQU4gQVNTVVJBTkNFIEpFVU5FIjogeyBlbnRyeUZlZXM6IDEuMCwgbWFuYWdlbWVudEZlZXM6IDAuNjUsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkNJQyAvIENSRURJVCBNVVRVRUwgLyBQTEFOIEFTU1VSQU5DRSBWSUUgLSBFU1NFTlRJRUwiOiB7IGVudHJ5RmVlczogNS4wLCBtYW5hZ2VtZW50RmVlczogMC43NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQ09OU0VSVkFURVVSIEhFTElPUyBQQVRSSU1PSU5FIjogeyBlbnRyeUZlZXM6IDMuMCwgbWFuYWdlbWVudEZlZXM6IDAuOTYsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkNPUlVNIExJRkUiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQ1JFRElUIEFHUklDT0xFIC8gQU5BRSI6IHsgZW50cnlGZWVzOiAyLjUsIG1hbmFnZW1lbnRGZWVzOiAwLjk2LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJDUkVESVQgQUdSSUNPTEUgLyBDQVJJU1NJTUUgUEFSIFRSQU5TRkVSVFMiOiB7IGVudHJ5RmVlczogNC41LCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJDUkVESVQgQUdSSUNPTEUgLyBGTE9SSUFHUkkiOiB7IGVudHJ5RmVlczogMy4wLCBtYW5hZ2VtZW50RmVlczogMC45NiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQ1JFRElUIEFHUklDT0xFIC8gRkxPUklBTkUgMiI6IHsgZW50cnlGZWVzOiAyLjUsIG1hbmFnZW1lbnRGZWVzOiAwLjk2LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJDUkVESVQgQUdSSUNPTEUgLyBQUkVESVNTSU1FIDkgU8OJUklFIDIiOiB7IGVudHJ5RmVlczogMy4wLCBtYW5hZ2VtZW50RmVlczogMC44NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiQ1JFRElUIEFHUklDT0xFIC8gVkVSUyBMJ0FWRU5JUiI6IHsgZW50cnlGZWVzOiAzLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjg1LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJDUsOJRElUIE1VVFVFTCBBUkvDiUEgLyBOQVZJRydPUFRJT05TIjogeyBlbnRyeUZlZXM6IDIuMCwgbWFuYWdlbWVudEZlZXM6IDAuOCwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiRVBBUkdOSVNTSU1PIC8gQ1JPSVNTQU5DRSBBVkVOSVIiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiRVBBUkdOSVNTSU1PIC8gTkVUTElGRSAyIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjcsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkZPUlRVTkVPIFZJRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC43NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiRlJBTkNFIE1VVFVBTElTVEUgLyBBQ1RFUEFSR05FIDIiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNzcsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkdBTiBBU1NVUkFOQ0VTIC8gQ0hST01BVFlTIEVWT0xVVElPTiI6IHsgZW50cnlGZWVzOiAzLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjk2LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJHQU4gUEFUUklNT0lORSBFVk9MVVRJT04iOiB7IGVudHJ5RmVlczogNC41LCBtYW5hZ2VtZW50RmVlczogMC45NiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiR0FOIFBSRVZPWUFOQ0UgUkVUUkFJVEUgQUNUSVZFIjogeyBlbnRyeUZlZXM6IDQuNSwgbWFuYWdlbWVudEZlZXM6IDAuOTYsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkdBUkFOQ0UgLyBDRUxFQkVBIFZJRSI6IHsgZW50cnlGZWVzOiA0LjUsIG1hbmFnZW1lbnRGZWVzOiAxLjAsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkdBUkFOQ0UgRVBBUkdORSI6IHsgZW50cnlGZWVzOiAxLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjYsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkdFTkVSQUxJIFZJRSAvIEVTUEFDRSBJTlZFU1QgNSI6IHsgZW50cnlGZWVzOiA0LjUsIG1hbmFnZW1lbnRGZWVzOiAxLjAsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkdFTkVSQUxJIFZJRSAvIEhJTUFMSUEiOiB7IGVudHJ5RmVlczogNC41LCBtYW5hZ2VtZW50RmVlczogMS4wLCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJHRU5FUkFMSSBWSUUgLyBMJ0VQQVJHTkUgR0VORVJBTEkgUExBVElOSVVNIjogeyBlbnRyeUZlZXM6IDQuNSwgbWFuYWdlbWVudEZlZXM6IDEuMCwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiR01GIC8gTVVMVEVPIjogeyBlbnRyeUZlZXM6IDIuMCwgbWFuYWdlbWVudEZlZXM6IDAuNzUsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkdSRUVOIEdPVCBQTEFORVQiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDEuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiR1JFU0hBTSBCQU5RVUUgUFJJVkVFIC8gQ09OQ09SREFOQ0VTIDQiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDEuMCwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiR1JJU0JFRSBWSUUiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiSEVESU9TIExJRkUiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiSEVMTE8gQkFOSyEgLyBBU1NVUkFOQ0UgVklFIEhFTExPISI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC43NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiSEFSTU9OSUUgTVVUVUVMTEUgMzAvNzAiOiB7IGVudHJ5RmVlczogMi4wLCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC41IH0sCiAgICAgICJIQVJNT05JRSBNVVRVRUxMRSA1MC81MCI6IHsgZW50cnlGZWVzOiAyLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjYsIGRlZmF1bHRSYXRlOiA1LjUgfSwKICAgICAgIkhBUk1PTklFIE1VVFVFTExFIDcwLzMwIjogeyBlbnRyeUZlZXM6IDIuMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDYuNSB9LAogICAgICAiSFNCQyBFU1NFTlRJRUwgMiI6IHsgZW50cnlGZWVzOiAyLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjksIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkhTQkMgRVZPTFVUSU9OIFBBVFJJTU9JTkUgVklFIDIiOiB7IGVudHJ5RmVlczogMi4wLCBtYW5hZ2VtZW50RmVlczogMC45LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJJTlRFTkNJQUwgTElCRVJBTFlTIFZJRSI6IHsgZW50cnlGZWVzOiA0LjUsIG1hbmFnZW1lbnRGZWVzOiAxLjAsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkxBIEJBTlFVRSBQT1NUQUxFIC8gQ0FDSEVNSVJFIDIgU0VSSUUgMiI6IHsgZW50cnlGZWVzOiAzLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjg1LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJMQ0wgQkFOUVVFIFBSSVZFRSAvIEFDVUlUWSBFVk9MVVRJT04iOiB7IGVudHJ5RmVlczogMi41LCBtYW5hZ2VtZW50RmVlczogMC45NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiTENMIFZJRSI6IHsgZW50cnlGZWVzOiAzLjUsIG1hbmFnZW1lbnRGZWVzOiAwLjk1LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJMSU5YRUEgQVZFTklSIDIiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiTElOWEVBIFNQSVJJVCAyIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAyLjAsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkxJTlhFQSBWSUUiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNzUsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIkxJTlhFQSBaRU4iOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiTE9VVlJFIEJBTlFVRSBQUklWRUUgLyBNWVJJQUxJUyBWSUUiOiB7IGVudHJ5RmVlczogMi45LCBtYW5hZ2VtZW50RmVlczogMC45NiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiTUFBRiAvIFdJTkFMVE8iOiB7IGVudHJ5RmVlczogMi4wLCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJNQUNJRiBFUEFSR05FIFZJRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJNQUNTRiI6IHsgZW50cnlGZWVzOiAzLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjUsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIk1BSUYiOiB7IGVudHJ5RmVlczogMC42LCBtYW5hZ2VtZW50RmVlczogMC43LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJNQVRNVVQgLyBDT01QTElDRSBWSUUiOiB7IGVudHJ5RmVlczogMS41LCBtYW5hZ2VtZW50RmVlczogMC44NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiTUVJTExFVVIgVEFVWCBBTExPQ0FUSU9OIFZJRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC43LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJNRUlMTEVVUiBUQVVYIExJQkVSVEUgVklFIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjYsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIk1FSUxMRVVSIFRBVVggUExBQ0VNRU5UIFZJRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJNSUYgLyBDT01QVEUgRVBBUkdORSBMSUJSRSBBVkVOSVIgTVVMVElTVVBQT1JUIjogeyBlbnRyeUZlZXM6IDIuMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiTUlGIEVQQVJHTkUgRU5GQU5UIjogeyBlbnRyeUZlZXM6IDIuMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiTU1BIE1VTFRJU1VQUE9SVFMiOiB7IGVudHJ5RmVlczogNC4wLCBtYW5hZ2VtZW50RmVlczogMC44LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJNT04gUEFSVEVOQUlSRSBBU1NVUkFOQ0UgVklFIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjksIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIk1PTiBQRVRJVCBQTEFDRU1FTlQiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDEuMCwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiTU9OQUJBTlEuVklFIFBSRU1JVU0iOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNzUsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIk1PTklXQU4gVklFIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjg1LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJOQUxPIC8gTkFMTyBQQVRSSU1PSU5FIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAwLjg1LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJQTEFDRU1FTlQgRElSRUNUIEVTU0VOVElFTCI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC43NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiUExBQ0VNRU5UIERJUkVDVCBWSUUiOiB7IGVudHJ5RmVlczogMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiUFJFRk9OIC8gUFJFRk9OIFZJRSBSRVNQT05TQUJMRSI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJQUklNT05JQUwgQVNTVVJBTkNFUyAvIFRBUkdFVCArIjogeyBlbnRyeUZlZXM6IDQuMCwgbWFuYWdlbWVudEZlZXM6IDAuOTgsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIlBSSU1PTklBTCBTRVJFTklQSUVSUkUiOiB7IGVudHJ5RmVlczogNC4wLCBtYW5hZ2VtZW50RmVlczogMC45NSwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiUFJPIEJUUCAvIE1VTFRJU1VQUE9SVCBDT05GSUFOQ0UiOiB7IGVudHJ5RmVlczogMS4wLCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJSQURJQU5DRSBBU1NVUkFOQ0UgVklFIjogeyBlbnRyeUZlZXM6IDQuNSwgbWFuYWdlbWVudEZlZXM6IDEuMCwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiUkFNSUZZIjogeyBlbnRyeUZlZXM6IDAsIG1hbmFnZW1lbnRGZWVzOiAxLjAsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIlJJVENIRUUgTElGRSI6IHsgZW50cnlGZWVzOiA0LjUsIG1hbmFnZW1lbnRGZWVzOiAxLjAsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIlNFTEVOQ0lBIC8gTVlQR0EiOiB7IGVudHJ5RmVlczogNC41LCBtYW5hZ2VtZW50RmVlczogMC44LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJTRUxFTkNJQSAvIFBSSVZJTEVHRSBHRVNUSU9OIEFDVElWRSI6IHsgZW50cnlGZWVzOiA0LjUsIG1hbmFnZW1lbnRGZWVzOiAxLjAsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIlNNQVZJRSAvIEJBVEkgRVBBUkdORSI6IHsgZW50cnlGZWVzOiAyLjUsIG1hbmFnZW1lbnRGZWVzOiAwLjg0LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJTT0NJRVRFIEdFTkVSQUxFIC8gU0VRVU9JQSI6IHsgZW50cnlGZWVzOiAzLjAsIG1hbmFnZW1lbnRGZWVzOiAwLjk2LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJTV0lTU0xJRkUgLyBFWFBFUlQgUFJFTUlVTSBQTFVTIjogeyBlbnRyeUZlZXM6IDQuNzUsIG1hbmFnZW1lbnRGZWVzOiAwLjk2LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJTV0lTU0xJRkUgRVZPTFVUSU9OIFBMVVMiOiB7IGVudHJ5RmVlczogNC43NSwgbWFuYWdlbWVudEZlZXM6IDAuOTYsIGRlZmF1bHRSYXRlOiA0LjAgfSwKICAgICAgIlNXSVNTTElGRSBSRVRSQUlURSI6IHsgZW50cnlGZWVzOiA0Ljc1LCBtYW5hZ2VtZW50RmVlczogMC45NiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiU1dJU1NMSUZFIFNUUkFURUdJQyBQUkVNSVVNIjogeyBlbnRyeUZlZXM6IDQuNzUsIG1hbmFnZW1lbnRGZWVzOiAwLjk2LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJVQUYgTElGRSBQQVRSSU1PSU5FIC8gVkVSU0lPTiBBQlNPTFVFIDIiOiB7IGVudHJ5RmVlczogNC41LCBtYW5hZ2VtZW50RmVlczogMS4wLCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJVTkVQIE1VTFRJU0VMRUNUSU9OIFBMVVMiOiB7IGVudHJ5RmVlczogNS4wLCBtYW5hZ2VtZW50RmVlczogMS4wLCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJWSUUgUExVUyAvIFBBVFJJTU9JTkUgVklFIFBMVVMiOiB7IGVudHJ5RmVlczogNC41LCBtYW5hZ2VtZW50RmVlczogMS4wLCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJWSUUgUExVUyBJTVBBQ1QiOiB7IGVudHJ5RmVlczogNC41LCBtYW5hZ2VtZW50RmVlczogMS45LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJWWVYgKFNJTVBMSUNJVEUgKyBFWFBFUlRJU0UpIjogeyBlbnRyeUZlZXM6IDIuMCwgbWFuYWdlbWVudEZlZXM6IDAuNiwgZGVmYXVsdFJhdGU6IDQuMCB9LAogICAgICAiV0VTQVZFIFBBVFJJTU9JTkUiOiB7IGVudHJ5RmVlczogMi4wLCBtYW5hZ2VtZW50RmVlczogMC45LCBkZWZhdWx0UmF0ZTogNC4wIH0sCiAgICAgICJZT01PTkkgVklFIC8gS0lEUyI6IHsgZW50cnlGZWVzOiAwLCBtYW5hZ2VtZW50RmVlczogMC42LCBkZWZhdWx0UmF0ZTogNC4wIH0KICAgIH07CgogICAgLy8g4oCU4oCU4oCU4oCU4oCUIFVJIGluaXQg4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUCiAgICBjb25zdCAkY21wU2VsZWN0ID0gJCgnI2NvbXBhcmUtc2VsZWN0Jyk7CiAgICBmdW5jdGlvbiBpbml0U2VsZWN0KCl7CiAgICAgICRjbXBTZWxlY3QuZW1wdHkoKTsKICAgICAgJGNtcFNlbGVjdC5hcHBlbmQoYDxvcHRpb24gdmFsdWU9Il9fY3VzdG9tX18iPkNob2lzaXIgdW4gY29udHJhdOKApjwvb3B0aW9uPmApOwogICAgICBPYmplY3Qua2V5cyhjb250cmFjdHNEYXRhKS5zb3J0KCkuZm9yRWFjaChuYW1lID0+IHsKICAgICAgICAkY21wU2VsZWN0LmFwcGVuZChgPG9wdGlvbiB2YWx1ZT0iJHtuYW1lfSI+JHtuYW1lfTwvb3B0aW9uPmApOwogICAgICB9KTsKICAgICAgJGNtcFNlbGVjdC5zZWxlY3QyKHsKICAgICAgICBwbGFjZWhvbGRlcjogIkZpbHRyZXIgbGVzIGNvbnRyYXRz4oCmIiwKICAgICAgICBhbGxvd0NsZWFyOiB0cnVlLAogICAgICAgIG1hdGNoZXI6IChwYXJhbXMsIGRhdGEpID0+IHsKICAgICAgICAgIGlmICghcGFyYW1zLnRlcm0gfHwgcGFyYW1zLnRlcm0udHJpbSgpPT09IiIpIHJldHVybiBkYXRhOwogICAgICAgICAgY29uc3QgdCA9IHBhcmFtcy50ZXJtLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICByZXR1cm4gZGF0YS50ZXh0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModCkgPyBkYXRhIDogbnVsbDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICAkY21wU2VsZWN0Lm9uKCdjaGFuZ2UnLCAoKSA9PiB7CiAgICAgICAgY29uc3QgayA9ICRjbXBTZWxlY3QudmFsKCk7CiAgICAgICAgaWYgKGsgJiYgayAhPT0gJ19fY3VzdG9tX18nICYmIGNvbnRyYWN0c0RhdGFba10pewogICAgICAgICAgY29uc3QgYyA9IGNvbnRyYWN0c0RhdGFba107CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY21wLWVudHJ5JykudmFsdWUgPSBOdW1iZXIoYy5lbnRyeUZlZXMpLnRvRml4ZWQoMik7CiAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY21wLW1nbXQnKS52YWx1ZSAgPSBOdW1iZXIoYy5tYW5hZ2VtZW50RmVlcykudG9GaXhlZCgyKTsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbXAtcmF0ZScpLnZhbHVlICA9IE51bWJlcihjLmRlZmF1bHRSYXRlKS50b0ZpeGVkKDIpOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RoLWNtcCcpLnRleHRDb250ZW50ID0gazsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RoLWNtcCcpLnRleHRDb250ZW50ID0gIkNvbnRyYXQgY29tcGFyYXRpZiI7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFybS1wcmVzZXQnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSk9PnsKICAgICAgY29uc3QgdiA9IGUudGFyZ2V0LnZhbHVlOwogICAgICBpZiAodiAhPT0gJ2N1c3RvbScpIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYXJtLXJhdGUnKS52YWx1ZSA9IE51bWJlcih2KS50b0ZpeGVkKDIpOwogICAgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgneWVhcnMnKS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIChlKT0+ewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgneWVhcnNWYWx1ZScpLnRleHRDb250ZW50ID0gZS50YXJnZXQudmFsdWUgKyAnIGFucyc7CiAgICB9KTsKCiAgICAvLyDigJTigJTigJTigJTigJQgQ2hhcnQg4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUCiAgICBsZXQgY2hhcnQ7CiAgICBmdW5jdGlvbiBidWlsZENoYXJ0KHBheWxvYWQpewogICAgICBjb25zdCB7aW5wdXRzLCBoYXJtU2VyaWVzLCBjbXBTZXJpZXMsIGxhU2VyaWVzLCBkZXBvc2l0cywgc3RyZXNzT04sIGhhcm1Mb3dTZXJpZXMsIGhhcm1IaWdoU2VyaWVzfSA9IHBheWxvYWQ7CiAgICAgIGNvbnN0IGxhYmVscyA9IEFycmF5LmZyb20oe2xlbmd0aDogaW5wdXRzLnllYXJzKzF9LCAoXyxpKT0+IGkpOwogICAgICBjb25zdCBzaG93U3RyZXNzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRvZ2dsZS1saW5lW2RhdGEta2V5PSJzdHJlc3MiXScpLmNoZWNrZWQgJiYgc3RyZXNzT047CgogICAgICBjb25zdCBkYXRhc2V0cyA9IFsKICAgICAgICB7IGxhYmVsOiAnSGFybW9uaWUnLCBkYXRhOiBoYXJtU2VyaWVzLCBib3JkZXJXaWR0aDoyLCB0ZW5zaW9uOi4zNSwgcG9pbnRSYWRpdXM6MCwgYm9yZGVyQ29sb3I6JyNmNTllMGInIH0sICAgLy8gb3JhbmdlCiAgICAgICAgeyBsYWJlbDogJ0NvbXBhcmF0aWYnLCBkYXRhOiBjbXBTZXJpZXMsIGJvcmRlcldpZHRoOjIsIHRlbnNpb246LjM1LCBwb2ludFJhZGl1czowLCBib3JkZXJDb2xvcjonIzYwYTVmYScgfSwgIC8vIGJsdWUKICAgICAgICB7IGxhYmVsOiAnTGl2cmV0IEEnLCBkYXRhOiBsYVNlcmllcywgYm9yZGVyV2lkdGg6MiwgdGVuc2lvbjouMzUsIHBvaW50UmFkaXVzOjAsIGJvcmRlckNvbG9yOicjZmRlMDQ3JyB9LCAgICAgLy8geWVsbG93CiAgICAgICAgeyBsYWJlbDogJ1ZlcnNlbWVudHMgY3VtdWzDqXMnLCBkYXRhOiBkZXBvc2l0cywgYm9yZGVyV2lkdGg6MSwgYm9yZGVyRGFzaDpbNSw1XSwgdGVuc2lvbjowLCBwb2ludFJhZGl1czowLCBib3JkZXJDb2xvcjoncmdiYSgxNDgsMTYzLDE4NCwxKScgfQogICAgICBdOwogICAgICAvLyBhc3NpZ24gY29sb3JzIHdpdGhvdXQgc3BlY2lmeWluZyBleHBsaWNpdCBoZXg/IFdlJ2xsIGxldCBDaGFydC5qcyBhdXRvLCBidXQgc2V0IGFscGhhIGZpbGwgb2ZmCiAgICAgIGlmIChzaG93U3RyZXNzKXsKICAgICAgICBkYXRhc2V0cy5wdXNoKHsgbGFiZWw6ICdIYXJtb25pZSAtMSBwdCcsIGRhdGE6IGhhcm1Mb3dTZXJpZXMsIGJvcmRlcldpZHRoOjEsIGJvcmRlckRhc2g6WzYsNF0sIHBvaW50UmFkaXVzOjAsIHRlbnNpb246LjM1LCBib3JkZXJDb2xvcjoncmdiYSgyNDUsMTU4LDExLDAuNCknIH0pOwogICAgICAgIGRhdGFzZXRzLnB1c2goeyBsYWJlbDogJ0hhcm1vbmllICsxIHB0JywgZGF0YTogaGFybUhpZ2hTZXJpZXMsIGJvcmRlcldpZHRoOjEsIGJvcmRlckRhc2g6WzYsNF0sIHBvaW50UmFkaXVzOjAsIHRlbnNpb246LjM1LCBib3JkZXJDb2xvcjoncmdiYSgyNDUsMTU4LDExLDAuNCknIH0pOwogICAgICB9CgogICAgICAvLyBWaXNpYmlsaXR5IGZyb20gdG9nZ2xlcwogICAgICBjb25zdCB0b2dnbGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvZ2dsZS1saW5lJyk7CiAgICAgIGNvbnN0IHZpcyA9IHsgaGFybTp0cnVlLCBjbXA6dHJ1ZSwgbGE6dHJ1ZSwgZGVwOnRydWUsIHN0cmVzczogc2hvd1N0cmVzcyB9OwogICAgICB0b2dnbGVzLmZvckVhY2godCA9PiB7IHZpc1t0LmRhdGFzZXQua2V5XSA9IHQuY2hlY2tlZDsgfSk7CgogICAgICBjb25zdCBpbmRleGVkID0gewogICAgICAgICdIYXJtb25pZSc6IHZpcy5oYXJtLAogICAgICAgICdDb21wYXJhdGlmJzogdmlzLmNtcCwKICAgICAgICAnTGl2cmV0IEEnOiB2aXMubGEsCiAgICAgICAgJ1ZlcnNlbWVudHMgY3VtdWzDqXMnOiB2aXMuZGVwLAogICAgICAgICdIYXJtb25pZSAtMSBwdCc6IHZpcy5zdHJlc3MsCiAgICAgICAgJ0hhcm1vbmllICsxIHB0JzogdmlzLnN0cmVzcwogICAgICB9OwoKICAgICAgaWYgKGNoYXJ0KSBjaGFydC5kZXN0cm95KCk7CiAgICAgIGNvbnN0IGNoYXJ0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhcnQnKTsKICAgICAgY2hhcnRFbC5zdHlsZS5oZWlnaHQgPSAnNDIwcHgnOwogICAgICBjaGFydEVsLnN0eWxlLndpZHRoID0gJzEwMCUnOwogICAgICBjb25zdCBjdHggPSBjaGFydEVsLmdldENvbnRleHQoJzJkJyk7CiAgICAgIGNoYXJ0ID0gbmV3IENoYXJ0KGN0eCwgewogICAgICAgIHR5cGU6ICdsaW5lJywKICAgICAgICBkYXRhOiB7IGxhYmVscywgZGF0YXNldHMgfSwKICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsCiAgICAgICAgICBpbnRlcmFjdGlvbjogeyBtb2RlOidpbmRleCcsIGludGVyc2VjdDpmYWxzZSB9LAogICAgICAgICAgcGx1Z2luczogewogICAgICAgICAgICBsZWdlbmQ6IHsKICAgICAgICAgICAgICBsYWJlbHM6IHsgYm94V2lkdGg6IDEyIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgdG9vbHRpcDogewogICAgICAgICAgICAgIGNhbGxiYWNrczogewogICAgICAgICAgICAgICAgdGl0bGU6IChpdGVtcyk9PiAnQW5uw6llICcgKyBpdGVtc1swXS5sYWJlbCwKICAgICAgICAgICAgICAgIGxhYmVsOiAoY3R4KT0+IGAke2N0eC5kYXRhc2V0LmxhYmVsfTogJHtmbXQoY3R4LnBhcnNlZC55KX1gCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgc2NhbGVzOiB7CiAgICAgICAgICAgIHg6IHsgZ3JpZDp7IGNvbG9yOidyZ2JhKDI1NSwyNTUsMjU1LDAuMDgpJyB9LCB0aWNrczp7IGNvbG9yOicjZThlZGY3JyB9LCB0aXRsZTp7IGRpc3BsYXk6dHJ1ZSwgdGV4dDonQW5uw6llcycsIGNvbG9yOicjY2JkNWUxJyB9IH0sCiAgICAgICAgICAgIHk6IHsgZ3JpZDp7IGNvbG9yOidyZ2JhKDI1NSwyNTUsMjU1LDAuMDgpJyB9LCB0aWNrczp7IGNvbG9yOicjZThlZGY3JywgY2FsbGJhY2s6ICh2KT0+IG5ldyBJbnRsLk51bWJlckZvcm1hdCgnZnItRlInKS5mb3JtYXQodikgfSwgdGl0bGU6eyBkaXNwbGF5OnRydWUsIHRleHQ6J0NhcGl0YWwgKOKCrCknLCBjb2xvcjonI2NiZDVlMSd9IH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8gYXBwbHkgdmlzaWJpbGl0eQogICAgICBjaGFydC5kYXRhLmRhdGFzZXRzLmZvckVhY2goZHMgPT4gewogICAgICAgIGRzLmhpZGRlbiA9ICFpbmRleGVkW2RzLmxhYmVsXTsKICAgICAgfSk7CiAgICAgIGNoYXJ0LnVwZGF0ZSgpOwogICAgfQoKICAgIC8vIOKAlOKAlOKAlOKAlOKAlCBSZXN1bHRzIGJpbmRpbmcg4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUCiAgICBmdW5jdGlvbiB1cGRhdGVVSShwKXsKICAgICAgY29uc3Qge2lucHV0cywgaGFybSwgY21wLCBsYSwgZGVwb3NpdHN9ID0gcDsKCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdrcGktZGVwb3NpdHMnKS50ZXh0Q29udGVudCA9IGZtdChkZXBvc2l0c1tkZXBvc2l0cy5sZW5ndGgtMV0pOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna3BpLWZlZXMnKS50ZXh0Q29udGVudCA9IGZtdChoYXJtLmVudHJ5RmVlc1RvdGFsICsgaGFybS5tZ210RmVlc1RvdGFsKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2twaS1nYXAnKS50ZXh0Q29udGVudCA9IGZtdChsYS50b3RhbENhcGl0YWwgLSBoYXJtLnRvdGFsQ2FwaXRhbCwgdHJ1ZSk7CgogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnci1oYXJtLWNhcCcpLnRleHRDb250ZW50ID0gZm10KGhhcm0udG90YWxDYXBpdGFsKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ItY21wLWNhcCcpLnRleHRDb250ZW50ICA9IGZtdChjbXAudG90YWxDYXBpdGFsKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ItbGEtY2FwJykudGV4dENvbnRlbnQgICA9IGZtdChsYS50b3RhbENhcGl0YWwpOwoKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ItaGFybS1pbnQnKS50ZXh0Q29udGVudCA9IGZtdChoYXJtLmludGVyZXN0cyk7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyLWNtcC1pbnQnKS50ZXh0Q29udGVudCAgPSBmbXQoY21wLmludGVyZXN0cyk7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyLWxhLWludCcpLnRleHRDb250ZW50ICAgPSBmbXQobGEuaW50ZXJlc3RzKTsKCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyLWhhcm0tZmUnKS50ZXh0Q29udGVudCAgPSBmbXQoaGFybS5lbnRyeUZlZXNUb3RhbCk7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyLWNtcC1mZScpLnRleHRDb250ZW50ICAgPSBmbXQoY21wLmVudHJ5RmVlc1RvdGFsKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ItbGEtZmUnKS50ZXh0Q29udGVudCAgICA9IGZtdCgwKTsKCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyLWhhcm0tZmcnKS50ZXh0Q29udGVudCAgPSBmbXQoaGFybS5tZ210RmVlc1RvdGFsKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ItY21wLWZnJykudGV4dENvbnRlbnQgICA9IGZtdChjbXAubWdtdEZlZXNUb3RhbCk7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyLWxhLWZnJykudGV4dENvbnRlbnQgICAgPSBmbXQoMCk7CgogICAgICBjb25zdCBiZUggPSBicmVha2V2ZW5ZZWFyKChpbnB1dHMubW9kZT09PSdyZWVsJz8gaGFybS55ZWFybHlSZWFsOiBoYXJtLnllYXJseU5vbWluYWwpLCBpbnB1dHMuaW5pdGlhbCwgaW5wdXRzLm1vbnRobHkpOwogICAgICBjb25zdCBiZUMgPSBicmVha2V2ZW5ZZWFyKChpbnB1dHMubW9kZT09PSdyZWVsJz8gY21wLnllYXJseVJlYWwgOiBjbXAueWVhcmx5Tm9taW5hbCApLCBpbnB1dHMuaW5pdGlhbCwgaW5wdXRzLm1vbnRobHkpOwogICAgICBjb25zdCBiZUwgPSBicmVha2V2ZW5ZZWFyKChpbnB1dHMubW9kZT09PSdyZWVsJz8gbGEueWVhcmx5UmVhbCAgOiBsYS55ZWFybHlOb21pbmFsICApLCBpbnB1dHMuaW5pdGlhbCwgaW5wdXRzLm1vbnRobHkpOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna3BpLWJyZWFrZXZlbicpLnRleHRDb250ZW50ID0gYmVIPT09J+KAlCc/J+KAlCc6IChiZUggKyAnIGFucycpOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnci1oYXJtLWJlJykudGV4dENvbnRlbnQgPSBiZUg9PT0n4oCUJz8n4oCUJzogKGJlSCArICcgYW5zJyk7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyLWNtcC1iZScpLnRleHRDb250ZW50ICA9IGJlQz09PSfigJQnPyfigJQnOiAoYmVDICsgJyBhbnMnKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ItbGEtYmUnKS50ZXh0Q29udGVudCAgID0gYmVMPT09J+KAlCc/J+KAlCc6IChiZUwgKyAnIGFucycpOwoKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ItZGlmZi1jbXAnKS50ZXh0Q29udGVudCA9IGZtdChjbXAudG90YWxDYXBpdGFsIC0gaGFybS50b3RhbENhcGl0YWwsIHRydWUpOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnci1kaWZmLWxhJykudGV4dENvbnRlbnQgID0gZm10KGxhLnRvdGFsQ2FwaXRhbCAtIGhhcm0udG90YWxDYXBpdGFsLCB0cnVlKTsKCiAgICAgIC8vIGVuYWJsZSBleHBvcnRzCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tcGRmJykuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bi1wbmcnKS5kaXNhYmxlZCA9IGZhbHNlOwogICAgfQoKICAgIC8vIOKAlOKAlOKAlOKAlOKAlCBQREYg4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUCiAgICAKCmFzeW5jIGZ1bmN0aW9uIGV4cG9ydFBERihwYXlsb2FkKXsKICB0cnkgewogICAgY29uc3QganNQREYgPSAod2luZG93LmpzcGRmICYmIHdpbmRvdy5qc3BkZi5qc1BERikgPyB3aW5kb3cuanNwZGYuanNQREYgOiB3aW5kb3cuanNQREY7CiAgICBpZiAoIWpzUERGKSB7IGFsZXJ0KCJFcnJldXIgUERGIDoganNQREYgbidlc3QgcGFzIGNoYXJnw6kuIik7IHJldHVybjsgfQogICAgY29uc3QgZG9jID0gbmV3IGpzUERGKHsgb3JpZW50YXRpb246ICdwb3J0cmFpdCcsIHVuaXQ6ICdtbScsIGZvcm1hdDogJ2E0JyB9KTsKICAgIGNvbnN0IHBhZ2VXID0gZG9jLmludGVybmFsLnBhZ2VTaXplLmdldFdpZHRoKCk7CiAgICBjb25zdCBwYWdlSCA9IGRvYy5pbnRlcm5hbC5wYWdlU2l6ZS5nZXRIZWlnaHQoKTsKICAgIGNvbnN0IE0gPSA4OyAvLyBjb21wYWN0IG1hcmdpbnMKICAgIGxldCB5ID0gTTsKCiAgICAvLyBIZWxwZXJzIChzYW5pdGl6ZSBzcGFjaW5nKQogICAgY29uc3QgbW9uZXkgPSAodikgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHMgPSBuZXcgSW50bC5OdW1iZXJGb3JtYXQoJ2ZyLUZSJywgeyBzdHlsZTonY3VycmVuY3knLCBjdXJyZW5jeTonRVVSJyB9KS5mb3JtYXQoTnVtYmVyKHYpfHwwKTsKICAgICAgICByZXR1cm4gcy5yZXBsYWNlKC9cdTAwQTB8XHUyMDJGL2csICcgJyk7CiAgICAgIH0gY2F0Y2goXykgeyByZXR1cm4gKE51bWJlcih2KXx8MCkudG9GaXhlZCgyKSArICcg4oKsJzsgfQogICAgfTsKICAgIGNvbnN0IHNpZ25lZCA9ICh2KSA9PiAodj49MD8nKyAnOictICcpICsgbW9uZXkoTWF0aC5hYnModikpOwoKICAgIC8vIEhlYWRlciBjb21wYWN0CiAgICBkb2Muc2V0Rm9udCgnaGVsdmV0aWNhJywgJ2JvbGQnKTsgZG9jLnNldEZvbnRTaXplKDE0KTsKICAgIGRvYy50ZXh0KCdTaW11bGF0ZXVyIGTigJnDiXBhcmduZSDigJQgUHJvKycsIE0sIHkpOyB5ICs9IDUuNTsKICAgIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCAnbm9ybWFsJyk7IGRvYy5zZXRGb250U2l6ZSg5KTsKICAgIGRvYy50ZXh0KCdSYXBwb3J0IGRlIHNpbXVsYXRpb24g4oCUICcgKyBuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInKSwgTSwgeSk7IHkgKz0gNC41OwoKICAgIGNvbnN0IHAgPSBwYXlsb2FkOwoKICAgIC8vIEh5cG90aMOoc2VzIChjb21wYWN0IHRhYmxlKQogICAgaWYgKGRvYy5hdXRvVGFibGUpIHsKICAgICAgY29uc3Qgcm93cyA9IFsKICAgICAgICBbJ1ZlcnNlbWVudCBpbml0aWFsJywgbW9uZXkocC5pbnB1dHMuaW5pdGlhbCldLAogICAgICAgIFsnVmVyc2VtZW50IG1lbnN1ZWwnLCBtb25leShwLmlucHV0cy5tb250aGx5KV0sCiAgICAgICAgWydEdXLDqWUgKGFubsOpZXMpJywgU3RyaW5nKHAuaW5wdXRzLnllYXJzKV0sCiAgICAgICAgWydJbmZsYXRpb24nLCBwLmlucHV0cy5pbmZsYXRpb24udG9GaXhlZCgxKSArICcgJSddLAogICAgICAgIFsnRmlzY2FsaXTDqScsIHAuaW5wdXRzLnRheD09PSdwZnUnID8gJ1BGVSAzMCUgKHNpbXBsaWZpw6kpJyA6ICdBdWN1bmUgKGJydXQpJ10sCiAgICAgICAgWydIYXJtb25pZSAocmR0IC8gZW50csOpZSAvIGdlc3Rpb24pJywgcC5pbnB1dHMuaGFybVJhdGUudG9GaXhlZCgyKSsnICUgLyAnK3AuaW5wdXRzLmhhcm1FbnRyeS50b0ZpeGVkKDIpKycgJSAvICcrcC5pbnB1dHMuaGFybU1nbXQudG9GaXhlZCgyKSsnICUnXSwKICAgICAgICBbJ0NvbXBhcmF0aWYgKHJkdCAvIGVudHLDqWUgLyBnZXN0aW9uKScsIHAuaW5wdXRzLmNtcFJhdGUudG9GaXhlZCgyKSsnICUgLyAnK3AuaW5wdXRzLmNtcEVudHJ5LnRvRml4ZWQoMikrJyAlIC8gJytwLmlucHV0cy5jbXBNZ210LnRvRml4ZWQoMikrJyAlJ10sCiAgICAgICAgWydMaXZyZXQgQSAocmR0KScsIHAuaW5wdXRzLmxhUmF0ZS50b0ZpeGVkKDIpKycgJSddCiAgICAgIF07CiAgICAgIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCdib2xkJyk7IGRvYy5zZXRGb250U2l6ZSgxMCk7CiAgICAgIGRvYy50ZXh0KCdIeXBvdGjDqHNlcycsIE0sIHkpOyB5ICs9IDIuNTsKICAgICAgZG9jLmF1dG9UYWJsZSh7CiAgICAgICAgc3RhcnRZOiB5LAogICAgICAgIGhlYWQ6IFtbJ1BhcmFtw6h0cmUnLCdWYWxldXInXV0sCiAgICAgICAgYm9keTogcm93cywKICAgICAgICB0aGVtZTogJ2dyaWQnLAogICAgICAgIGhlYWRTdHlsZXM6IHsgZmlsbENvbG9yOiBbMTYsMjIsNDNdLCB0ZXh0Q29sb3I6IFsyMzAsMjM1LDI0NV0sIGZvbnRTaXplOiA4IH0sCiAgICAgICAgc3R5bGVzOiB7IGZvbnQ6ICdoZWx2ZXRpY2EnLCBmb250U3R5bGU6ICdub3JtYWwnLCBmb250U2l6ZTogOCwgbGluZUNvbG9yOiBbMjEwLDIxMCwyMTBdLCBjZWxsUGFkZGluZzogMS41IH0sCiAgICAgICAgYWx0ZXJuYXRlUm93U3R5bGVzOiB7IGZpbGxDb2xvcjogWzI0NSwyNDUsMjQ1XSB9LAogICAgICAgIGNvbHVtblN0eWxlczogeyAxOiB7IGhhbGlnbjogJ3JpZ2h0JyB9IH0sCiAgICAgICAgbWFyZ2luOiB7IGxlZnQ6IE0sIHJpZ2h0OiBNIH0KICAgICAgfSk7CiAgICAgIHkgPSBkb2MubGFzdEF1dG9UYWJsZS5maW5hbFkgKyA0OwogICAgfQoKICAgIC8vIEdyYXBoIChjb21wYWN0KQogICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXJ0Jyk7CiAgICBpZiAoY2FudmFzICYmIGNhbnZhcy50b0RhdGFVUkwpIHsKICAgICAgY29uc3QgaW1nRGF0YSA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycsIDEuMCk7CiAgICAgIGNvbnN0IGltZ1cgPSBwYWdlVyAtIDIqTTsKICAgICAgY29uc3QgaW1nSCA9IE1hdGgubWluKDcwLCBpbWdXICogMC40NSk7IC8vIDw9IDcwbW0KICAgICAgaWYgKHkgKyBpbWdIID4gcGFnZUggLSAzMCkgeyBkb2MuYWRkUGFnZSgpOyB5ID0gTTsgfSAvLyByYXJlLCBidXQgc2FmZQogICAgICBkb2Muc2V0Rm9udCgnaGVsdmV0aWNhJywnYm9sZCcpOyBkb2Muc2V0Rm9udFNpemUoMTApOwogICAgICBkb2MudGV4dCgnw4l2b2x1dGlvbiBkdSBjYXBpdGFsJywgTSwgeSk7IHkgKz0gMzsKICAgICAgZG9jLmFkZEltYWdlKGltZ0RhdGEsICdQTkcnLCBNLCB5LCBpbWdXLCBpbWdIKTsKICAgICAgeSArPSBpbWdIICsgNDsKICAgIH0KCiAgICAvLyBSw6ljYXBpdHVsYXRpZiAoY29tcGFjdCB0YWJsZSkKICAgIGlmIChkb2MuYXV0b1RhYmxlKSB7CiAgICAgIGNvbnN0IGJvZHkgPSBbCiAgICAgICAgWydDYXBpdGFsIGZpbmFsJywgbW9uZXkocC5oYXJtLnRvdGFsQ2FwaXRhbCksIG1vbmV5KHAuY21wLnRvdGFsQ2FwaXRhbCksIG1vbmV5KHAubGEudG90YWxDYXBpdGFsKV0sCiAgICAgICAgWydJbnTDqXLDqnRzIGN1bXVsw6lzJywgbW9uZXkocC5oYXJtLmludGVyZXN0cyksIG1vbmV5KHAuY21wLmludGVyZXN0cyksIG1vbmV5KHAubGEuaW50ZXJlc3RzKV0sCiAgICAgICAgWydGcmFpcyBlbnRyw6llICjigqwpJywgbW9uZXkocC5oYXJtLmVudHJ5RmVlc1RvdGFsKSwgbW9uZXkocC5jbXAuZW50cnlGZWVzVG90YWwpLCBtb25leSgwKV0sCiAgICAgICAgWydGcmFpcyBnZXN0aW9uICjigqwpJywgbW9uZXkocC5oYXJtLm1nbXRGZWVzVG90YWwpLCBtb25leShwLmNtcC5tZ210RmVlc1RvdGFsKSwgbW9uZXkoMCldLAogICAgICAgIFsnRGlmZi4gdnMgSGFybW9uaWUnLCAn4oCUJywgc2lnbmVkKHAuY21wLnRvdGFsQ2FwaXRhbCAtIHAuaGFybS50b3RhbENhcGl0YWwpLCBzaWduZWQocC5sYS50b3RhbENhcGl0YWwgLSBwLmhhcm0udG90YWxDYXBpdGFsKV0KICAgICAgXTsKICAgICAgaWYgKHkgKyA1NSA+IHBhZ2VIIC0gMjApIHsgZG9jLmFkZFBhZ2UoKTsgeSA9IE07IH0KICAgICAgZG9jLnNldEZvbnQoJ2hlbHZldGljYScsJ2JvbGQnKTsgZG9jLnNldEZvbnRTaXplKDEwKTsKICAgICAgZG9jLnRleHQoJ0NvbXBhcmF0aWYgcsOpY2FwaXR1bGF0aWYnLCBNLCB5KTsgeSArPSAyLjU7CiAgICAgIGRvYy5hdXRvVGFibGUoewogICAgICAgIHN0YXJ0WTogeSwKICAgICAgICBoZWFkOiBbWycnLCAnSGFybW9uaWUnLCAnQ29tcGFyYXRpZicsICdMaXZyZXQgQSddXSwKICAgICAgICBib2R5LAogICAgICAgIHRoZW1lOidncmlkJywKICAgICAgICBoZWFkU3R5bGVzOiB7IGZpbGxDb2xvcjogWzE2LDIyLDQzXSwgdGV4dENvbG9yOiBbMjMwLDIzNSwyNDVdLCBmb250U2l6ZTogOCB9LAogICAgICAgIHN0eWxlczp7IGZvbnQ6ICdoZWx2ZXRpY2EnLCBmb250U3R5bGU6ICdub3JtYWwnLCBmb250U2l6ZTogOCwgbGluZUNvbG9yOiBbMjEwLDIxMCwyMTBdLCBjZWxsUGFkZGluZzogMS41IH0sCiAgICAgICAgYWx0ZXJuYXRlUm93U3R5bGVzOiB7IGZpbGxDb2xvcjogWzI0NSwyNDUsMjQ1XSB9LAogICAgICAgIGNvbHVtblN0eWxlczogeyAxOntoYWxpZ246J3JpZ2h0J30sIDI6e2hhbGlnbjoncmlnaHQnfSwgMzp7aGFsaWduOidyaWdodCd9IH0sCiAgICAgICAgbWFyZ2luOiB7IGxlZnQ6IE0sIHJpZ2h0OiBNIH0KICAgICAgfSk7CiAgICAgIHkgPSBkb2MubGFzdEF1dG9UYWJsZS5maW5hbFkgKyAzOwogICAgfQoKICAgIC8vIEZvb3RlciAoY29tcGFjdCkKICAgIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCdub3JtYWwnKTsgZG9jLnNldEZvbnRTaXplKDcpOwogICAgY29uc3QgZGlzY2xhaW1lciA9ICdTaW11bGF0aW9uIGluZGljYXRpdmUuIEh5cG90aMOoc2VzIHNpbXBsaWZpw6llcyAocmVuZGVtZW50cywgZnJhaXMsIGZpc2NhbGl0w6kpLiBMZXMgcGVyZm9ybWFuY2VzIHBhc3PDqWVzIG5lIHByw6lqdWdlbnQgcGFzIGRlcyBwZXJmb3JtYW5jZXMgZnV0dXJlcy4nOwogICAgY29uc3QgdHh0ID0gZG9jLnNwbGl0VGV4dFRvU2l6ZShkaXNjbGFpbWVyLCBwYWdlVyAtIDIqTSk7CiAgICBkb2MudGV4dCh0eHQsIE0sIHBhZ2VIIC0gOCk7CgogICAgLy8gUGFnZSBudW1iZXJzCiAgICBjb25zdCBwYWdlcyA9IGRvYy5nZXROdW1iZXJPZlBhZ2VzKCk7CiAgICBmb3IgKGxldCBpPTE7aTw9cGFnZXM7aSsrKXsKICAgICAgZG9jLnNldFBhZ2UoaSk7CiAgICAgIGRvYy5zZXRGb250U2l6ZSg3KTsKICAgICAgZG9jLnRleHQoYFBhZ2UgJHtpfS8ke3BhZ2VzfWAsIHBhZ2VXIC0gTSAtIDIwLCBwYWdlSCAtIDQuNSk7CiAgICB9CgogICAgZG9jLnNhdmUoJ1NpbXVsYXRpb25fRXBhcmduZV9Qcm8rLnBkZicpOwogIH0gY2F0Y2goZSl7CiAgICBjb25zb2xlLmVycm9yKGUpOwogICAgYWxlcnQoJ8OJY2hlYyBleHBvcnQgUERGIDogJyArIChlICYmIGUubWVzc2FnZSA/IGUubWVzc2FnZSA6IGUpKTsKICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGV4cG9ydFBORygpewogICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhcnQnKTsKICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgbGluay5kb3dubG9hZCA9ICdncmFwaGlxdWVfc2ltdWxhdGlvbi5wbmcnOwogICAgICBsaW5rLmhyZWYgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnLCAxLjApOwogICAgICBsaW5rLmNsaWNrKCk7CiAgICB9CgogICAgLy8g4oCU4oCU4oCU4oCU4oCUIEV2ZW50cyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJQKICAgIGZ1bmN0aW9uIHJlY2FsY0FuZFJlbmRlcigpewogICAgICBjb25zdCBwYXlsb2FkID0gY29tcHV0ZUFsbCgpOwogICAgICBidWlsZENoYXJ0KHBheWxvYWQpOwogICAgICB1cGRhdGVVSShwYXlsb2FkKTsKICAgICAgLy8gcGVyc2lzdAogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc2ltdV9wcm9fcGx1cycsIEpTT04uc3RyaW5naWZ5KHBheWxvYWQuaW5wdXRzKSk7CiAgICAgIHJldHVybiBwYXlsb2FkOwogICAgfQoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tY2FsYycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVjYWxjQW5kUmVuZGVyKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tcmVzZXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdzaW11X3Byb19wbHVzJyk7IGxvY2F0aW9uLnJlbG9hZCgpOwogICAgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuLXBkZicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PiBleHBvcnRQREYoY29tcHV0ZUFsbCgpKSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuLXBuZycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXhwb3J0UE5HKTsKCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9nZ2xlLWxpbmUnKS5mb3JFYWNoKGNiID0+IGNiLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpPT4gYnVpbGRDaGFydChjb21wdXRlQWxsKCkpKSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kZUFmZmljaGFnZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHJlY2FsY0FuZFJlbmRlcik7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZXNzJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgcmVjYWxjQW5kUmVuZGVyKTsKCiAgICAvLyBUcnkgbGl2ZSB1cGRhdGVzIGZvciBpbnB1dHMKICAgIFsnaW5pdGlhbCcsJ21vbnRobHknLCd5ZWFycycsJ2luZmxhdGlvbicsJ2Zpc2NhbGl0ZScsJ2hhcm0tcmF0ZScsJ2hhcm0tcHJlc2V0JywnaGFybS1lbnRyeScsJ2hhcm0tbWdtdCcsJ2NtcC1lbnRyeScsJ2NtcC1tZ210JywnY21wLXJhdGUnLCdsaXZyZXRhJ10KICAgICAgLmZvckVhY2goaWQgPT4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCk9PnsKICAgICAgICBpZiAoaWQ9PT0naGFybS1wcmVzZXQnKSByZXR1cm47CiAgICAgICAgcmVjYWxjQW5kUmVuZGVyKCk7CiAgICAgIH0pKTsKCiAgICAvLyBoeWRyYXRlIGZyb20gbG9jYWxTdG9yYWdlCiAgICBmdW5jdGlvbiBoeWRyYXRlKCl7CiAgICAgIGluaXRTZWxlY3QoKTsKICAgICAgY29uc3Qgc2F2ZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2ltdV9wcm9fcGx1cycpOwogICAgICBpZiAoc2F2ZWQpewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCBzID0gSlNPTi5wYXJzZShzYXZlZCk7CiAgICAgICAgICBmb3IgKGNvbnN0IFtrLHZdIG9mIE9iamVjdC5lbnRyaWVzKHMpKXsKICAgICAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh7CiAgICAgICAgICAgICAgaW5pdGlhbDonaW5pdGlhbCcsIG1vbnRobHk6J21vbnRobHknLCB5ZWFyczoneWVhcnMnLCBpbmZsYXRpb246J2luZmxhdGlvbicsIHRheDonZmlzY2FsaXRlJywKICAgICAgICAgICAgICBoYXJtUmF0ZTonaGFybS1yYXRlJywgaGFybUVudHJ5OidoYXJtLWVudHJ5JywgaGFybU1nbXQ6J2hhcm0tbWdtdCcsCiAgICAgICAgICAgICAgY21wRW50cnk6J2NtcC1lbnRyeScsIGNtcE1nbXQ6J2NtcC1tZ210JywgY21wUmF0ZTonY21wLXJhdGUnLCBsYVJhdGU6J2xpdnJldGEnLCBtb2RlOidtb2RlQWZmaWNoYWdlJwogICAgICAgICAgICB9W2tdIHx8ICcnKTsKICAgICAgICAgICAgaWYgKGVsKXsKICAgICAgICAgICAgICBpZiAoZWwudGFnTmFtZT09PSdTRUxFQ1QnKSBlbC52YWx1ZSA9IHY7CiAgICAgICAgICAgICAgZWxzZSBlbC52YWx1ZSA9IHY7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd5ZWFyc1ZhbHVlJykudGV4dENvbnRlbnQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3llYXJzJykudmFsdWUgfHwgJzEwJykgKyAnIGFucyc7CiAgICAgICAgfSBjYXRjaChlKXsgLyogaWdub3JlICovIH0KICAgICAgfQogICAgICByZWNhbGNBbmRSZW5kZXIoKTsKICAgIH0KCiAgICAvLyBraWNrCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgaHlkcmF0ZSk7CiAgPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==';
  } catch(e) {
    root.querySelector('.small').textContent = 'Échec du chargement : ' + (e && e.message ? e.message : e);
  }
}

window.addEventListener('beforeunload', ()=>{
  try {
    const per = document.getElementById('per');
    if(per && per.__perCleanup) per.__perCleanup();
  } catch(e){}
});
</script>
</body>
</html>